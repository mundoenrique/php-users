Listen 80
Listen 443
ServerName localhost

# Main location
<Directory "/var/www/html">
	Options +SymLinksIfOwnerMatch
	AllowOverride All
	Require all granted
</Directory>

# Prevent server software to return sensitive technology information
ServerSignature Off
ServerTokens Prod

# Logs
LogFormat "%t %h %l %u \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" access
LogFormat "\"%r\" %b (%{ratio}n) \"%{User-agent}i\"" deflate

# Non-secure host
<VirtualHost *>
	# Basic server definition
	ServerAdmin desarrolloweb@novopayment.com
	DocumentRoot "/var/www/html/"
	DirectoryIndex index.php index.html

	<Directory "/var/www/html/">
		# Root location permissions
		Options -Indexes -Includes -MultiViews -ExecCGI
		AllowOverride All

		# Set environment variables received from OS
		PassEnv CI_ENV
		PassEnv BASE_URL
		PassEnv BASE_CDN_URL
		PassEnv BASE_CDN_PATH
		PassEnv WS_URL
		PassEnv WS_KEY
		PassEnv ENCRYPTION_KEY
		PassEnv SESS_COOKIE_NAME
		PassEnv SESS_EXPIRATION
		PassEnv SESS_SAVE_PATH
		PassEnv SESS_MATCH_IP
		PassEnv COOKIE_PREFIX
		PassEnv COOKIE_DOMAIN
		PassEnv COOKIE_PATH
		PassEnv COOKIE_SECURE

		# Serve resources with the proper media types (MIME types)
		<IfModule mod_mime>
			# Data interchange
			AddType application/atom+xml atom
			AddType application/json json map topojson
			AddType application/ld+json jsonld
			AddType application/rss+xml rss
			AddType application/vnd.geo+json geojson
			AddType application/xml rdf xml

			# JavaScript
			AddType application/javascript js

			# Manifest files
			AddType application/manifest+json webmanifest
			AddType application/x-web-app-manifest+json webapp
			AddType text/cache-manifest appcache

			# Media files
			AddType audio/mp4 f4a f4b m4a
			AddType audio/ogg oga ogg opus
			AddType image/bmp bmp
			AddType image/svg+xml svg svgz
			AddType image/webp webp
			AddType image/x-icon cur ico
			AddType video/mp4 f4v f4p m4v mp4
			AddType video/ogg ogv
			AddType video/webm webm
			AddType video/x-flv flv

			# Web fonts
			AddType application/font-woff woff
			AddType application/font-woff2 woff2
			AddType application/vnd.ms-fontobject eot
			AddType application/x-font-ttf ttc ttf
			AddType font/opentype otf

			# Other
			AddType application/octet-stream safariextz
			AddType application/x-bb-appworld bbaw
			AddType application/x-chrome-extension crx
			AddType application/x-opera-extension oex
			AddType application/x-xpinstall xpi
			AddType text/vcard vcard vcf
			AddType text/vnd.rim.location.xloc xloc
			AddType text/vtt vtt
			AddType text/x-component htc
		</IfModule>

		# Serve certain resources with UTF-8 character encoding
		AddDefaultCharset utf-8

		<IfModule mod_mime>
			AddCharset utf-8 \
				.atom \
				.bbaw \
				.css \
				.geojson \
				.js \
				.json \
				.jsonld \
				.manifest \
				.rdf \
				.rss \
				.topojson \
				.vtt \
				.webapp \
				.webmanifest \
				.xloc \
				.xml
		</IfModule>

		# Set header metadata
		<IfModule mod_headers>
			# Force IE 8-10 to render pages in highest compatibily mode available
			Header set X-UA-Compatible "IE=edge"

			# Mitigate Reflected Cross-Site Scripting (XSS) attacks
			Header set X-XSS-Protection "1; mode=block"

			# Remove some headers not meant for responses different from HTML files
			<FilesMatch "\.(appcache|atom|bbaw|bmp|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|htc|ico|jpe?g|js|json(ld)?|m4[av]|manifest|map|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
				Header unset X-UA-Compatible
				Header unset X-XSS-Protection
			</FilesMatch>

			# Cross-origin images
			<IfModule mod_setenvif>
				<FilesMatch "\.(bmp|cur|gif|ico|jpe?g|json|png|svgz?|webp)$">
					SetEnvIf Origin ":" IS_CORS
					Header set Access-Control-Allow-Origin "*" env=IS_CORS
				</FilesMatch>
			</IfModule>

			# Cross-origin web fonts
			<FilesMatch "\.(eot|otf|tt[cf]|woff2?)$">
				Header set Access-Control-Allow-Origin "*"
			</FilesMatch>

			# Prevent some browsers from MIME-sniffing response
			Header set X-Content-Type-Options "nosniff"

			# Prevent intermediate caches or proxies from modifying content
			Header merge Cache-Control "no-transform"

			# Remove sensitive server-side technology information on any response
			Header unset X-Powered-By
		</IfModule>

		# Block access to files that can expose sensitive information
		<FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$">
			Require all denied
		</FilesMatch>

		# Block access to all hidden files and directories
		<IfModule mod_rewrite>
			RewriteEngine On
			RewriteCond %{SCRIPT_FILENAME} -d [OR]
			RewriteCond %{SCRIPT_FILENAME} -f
			RewriteRule "(^|/)\." - [F]
		</IfModule>

		# PHP7 configuration
		<IfModule mod_php7>
			php_admin_flag engine On
			php_admin_flag display_errors Off
			php_admin_flag expose_php Off
			php_admin_flag allow_url_fopen On
			php_admin_flag safe_mode Off
			php_admin_value register_globals 0
			php_admin_value open_basedir "/"
			php_value allow_call_time_pass_reference 0
			php_value date.timezone "America/New_York"
			php_value magic_quotes_gpc 0
			php_value magic_quotes_runtime 0
			php_value SMTP "mail.novopayment.com"
			php_value smtp_port 25
			php_value output_buffering 4096
		</IfModule>

		# Compress all resources labeled with certain media types
		<IfModule mod_filter>
			AddOutputFilterByType DEFLATE \
				"application/atom+xml" \
				"application/javascript" \
				"application/json" \
				"application/ld+json" \
				"application/manifest+json" \
				"application/rdf+xml" \
				"application/rss+xml" \
				"application/schema+json" \
				"application/vnd.geo+json" \
				"application/vnd.ms-fontobject" \
				"application/x-font-ttf" \
				"application/x-javascript" \
				"application/x-web-app-manifest+json" \
				"application/xhtml+xml" \
				"application/xml" \
				"font/eot" \
				"font/opentype" \
				"image/bmp" \
				"image/svg+xml" \
				"image/vnd.microsoft.icon" \
				"image/x-icon" \
				"text/cache-manifest" \
				"text/css" \
				"text/html" \
				"text/javascript" \
				"text/plain" \
				"text/vcard" \
				"text/vnd.rim.location.xloc" \
				"text/vtt" \
				"text/x-component" \
				"text/x-cross-domain-policy" \
				"text/xml"
		</IfModule>

		<IfModule mod_mime>
			AddEncoding gzip svgz
		</IfModule>

		# Remove ETags
		<IfModule mod_headers>
			Header unset ETag
		</IfModule>

		FileETag None

		# Far-future cache definition for resources
		<IfModule mod_expires>
			# Initialize expires module properly
			ExpiresActive On
			ExpiresDefault "access plus 1 month"

			# CSS
			ExpiresByType text/css "access plus 1 year"

			# Data interchange
			ExpiresByType application/atom+xml "access plus 1 hour"
			ExpiresByType application/rdf+xml "access plus 1 hour"
			ExpiresByType application/rss+xml "access plus 1 hour"
			ExpiresByType application/json "access plus 0 seconds"
			ExpiresByType application/ld+json "access plus 0 seconds"
			ExpiresByType application/schema+json "access plus 0 seconds"
			ExpiresByType application/vnd.geo+json "access plus 0 seconds"
			ExpiresByType application/xml "access plus 0 seconds"
			ExpiresByType text/xml "access plus 0 seconds"
			ExpiresByType image/vnd.microsoft.icon "access plus 1 week"
			ExpiresByType image/x-icon "access plus 1 week"

			# HTML
			ExpiresByType text/html "access plus 0 seconds"

			# JavaScript
			ExpiresByType application/javascript "access plus 1 year"
			ExpiresByType application/x-javascript "access plus 1 year"
			ExpiresByType text/javascript "access plus 1 year"

			# Manifest files
			ExpiresByType application/manifest+json "access plus 1 week"
			ExpiresByType application/x-web-app-manifest+json "access plus 0 seconds"
			ExpiresByType text/cache-manifest "access plus 0 seconds"

			# Media files
			ExpiresByType audio/ogg "access plus 1 month"
			ExpiresByType image/bmp "access plus 1 month"
			ExpiresByType image/gif "access plus 1 month"
			ExpiresByType image/jpeg "access plus 1 month"
			ExpiresByType image/png "access plus 1 month"
			ExpiresByType image/svg+xml "access plus 1 month"
			ExpiresByType image/webp "access plus 1 month"
			ExpiresByType video/mp4 "access plus 1 month"
			ExpiresByType video/ogg "access plus 1 month"
			ExpiresByType video/webm "access plus 1 month"

			# Web fonts
			ExpiresByType application/vnd.ms-fontobject "access plus 1 month"
			ExpiresByType font/eot "access plus 1 month"
			ExpiresByType font/opentype "access plus 1 month"
			ExpiresByType application/x-font-ttf "access plus 1 month"
			ExpiresByType application/font-woff "access plus 1 month"
			ExpiresByType application/x-font-woff "access plus 1 month"
			ExpiresByType font/woff "access plus 1 month"
			ExpiresByType application/font-woff2 "access plus 1 month"

			# Other
			ExpiresByType text/x-cross-domain-policy "access plus 1 week"
		</IfModule>
	</Directory>
</VirtualHost>
