var path,base_cdn;path=window.location.href.split("/");base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1"));base_url=path[0]+"//"+path[2]+"/"+path[3];$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(h,i){$(".ui-dialog-titlebar-close",i.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});var f=$("#dashboard-donor");f.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var e=$("#filters-stack .option-set"),g=e.find("a");g.click(function(){var l=$(this);if(l.hasClass("selected")){return false}var j=l.parents(".option-set");j.find(".selected").removeClass("selected");l.addClass("selected");var h={},i=j.attr("data-option-key"),k=l.attr("data-option-value");k=k==="false"?false:k;h[i]=k;if(i==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(l,h)}else{f.isotope(h)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$(".dashboard-item").click(function(){var p,l,h,g,q,m,i,o;p=$(this).find("img").attr("src");l=$(this).attr("card");h=$(this).attr("marca");g=$(this).attr("mascara");q=$(this).attr("producto1");m=$(this).attr("empresa");o=$(this).attr("nombre");$("#donor").children().remove();i='<div class="product-presentation" producto="'+q+'">';i+='<img src="'+p+'" width="200" height="130" alt="" />';i+='<div class="product-network '+h.toLowerCase()+'"></div>';i+='<input id="donor-cardnumber-origen" name="donor-cardnumber" producto="'+q+'" type="hidden" nombreOrigen="'+o+'" cardOrigen="'+l+'" masCtaOrigen="'+k+'" marcaCtaOrigen="'+h+'"  />';i+="</div>";i+='<div class="product-info-full">';i+='<p class="product-cardholder" id="nombreCtaOrigen">'+o+"</p>";i+='<p class="product-cardnumber" id="mascara">'+g+"</p>";i+='<p class="product-metadata" id="marca">'+q+"</p>";i+='<nav class="product-stack" id="selCtaOrigen">';i+='<ul class="stack">';i+='<li class="stack-item">';i+='<a dialog button product-button rel="section" id="buscarCta" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';i+="</li>";i+="</ul>";i+="</nav>";i+="</div>";$("#donor").append(i);$(".product-button").removeClass("disabled-button");$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");var e=$("#donor-cardnumber-origen").attr("cardorigen");var k=$("#donor-cardnumber-origen").attr("masCtaOrigen");var n=$("#donor-cardnumber-origen").attr("marcaCtaOrigen");var f=$("#donor-cardnumber-origen").attr("nombreOrigen");var q=$("#donor-cardnumber-origen").attr("producto");var j=$(this).attr("prefix");mes=$("#filter-month").val();anio=$("#filter-year").val();$("#buscar").removeClass("disabled-button");$("#list-detail").children().remove();d(e,j,k,n,f,q);$(".stack-item").click(function(){$("#dashboard").children().remove();$("#botonContinuar").attr("disabled",true);$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(r,s){$(".ui-dialog-titlebar-close",s.dialog).hide()}})})});function d(g,k,j,i,f,e){var l,h;$.post(base_url+"/transferencia/ctaDestino",{nroTarjeta:g,prefijo:k,operacion:"P2C"},function(n){if(n.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}if(n.rc==0){$("#empty-state").remove();$.each(n.tarjetaDestinoTercero,function(s,r){var p=Math.floor(Math.random()*5)+1;var q="card-"+p;var o;o="<li class='dashboard-item "+r.beneficiario+" muestraDestino' card='"+r.noCuenta+"' banco='"+r.banco+"' codBanco='"+r.codBanco+"' id_ext_per='"+r.id_ext_per+"' nombre='"+r.beneficiario+"' emailCliente='"+r.email+"' id_afiliacion='"+r.id_afiliacion+"' marca='"+r.marca+"' mascara='"+r.noCuentaConMascara+"'>";o+="<div class='dashboard-item-box'>";o+="<img src='"+base_cdn+"/img/products/default/"+q+".png' width='200' height='130' alt='' />";o+="<div class='dashboard-item-info'>";o+="<p class='dashboard-item-cardholder'>"+r.beneficiario+"</p>";o+="<ul class='dashboard-item-actions'>";o+="<li class='actions-item'>";o+="<a title='Modificar' id='modificar'><span aria-hidden='true' class='icon-edit'></span></a>";o+="</li>";o+="<li class='actions-item' id='eliminar'>";o+="<a title='Remover'><span aria-hidden='true' class='icon-remove'></span></a>";o+="</li>";o+="</ul>";o+="<p class='dashboard-item-cardnumber'>"+r.noCuentaConMascara+"</p>";o+="<p class='dashboard-item-category'>"+r.banco+"</p>";o+="</div>";o+="</div>";o+="</li>";$("#dashboard").append(o)});$(".muestraDestino").on("click","#modificar",function(){var A,t,p,o,u,q,z,y,v,C,B,s,r,w=[];v=new Date();C=v.getFullYear();B=C-5;s=C+5;for(r=B;r<=s;r++){w.push(r)}t=$(this).parents(".dashboard-item").attr("card");id_ext_per_1=$(this).parents(".dashboard-item").attr("id_ext_per");tipo_doc=id_ext_per_1.substr(0,1);id_ext_per=id_ext_per_1.substr(1,14);z=$(this).parents(".dashboard-item").attr("nombre");emailCliente=$(this).parents(".dashboard-item").attr("emailCliente");id_afiliacion=$(this).parents(".dashboard-item").attr("id_afiliacion");banco=$(this).parents(".dashboard-item").attr("banco");codBanco=$(this).parents(".dashboard-item").attr("codBanco");$("#content-holder").children().remove();$("#selCtaOrigen").attr("style","display:none");var x;x="<div id='progress'>";x+="<ul class='steps'>";x+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";x+="<li class='step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";x+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";x+="</ul>";x+="</div>";x+="<div id='content-holder'>";x+="<form id='datos'>";x+="<ul class='field-group'>";x+="<li class='field-group-item'>";x+="<label for='dayExp'>Fecha de Vencimiento</label>";x+="<select id='MonthExp' name='MonthExp'>";x+="<option value=''>Mes</option>";x+="<option value='01'>01</option>";x+="<option value='02'>02</option>";x+="<option value='03'>03</option>";x+="<option value='04'>04</option>";x+="<option value='05'>05</option>";x+="<option value='06'>06</option>";x+="<option value='07'>07</option>";x+="<option value='08'>08</option>";x+="<option value='09'>09</option>";x+="<option value='10'>10</option>";x+="<option value='11'>11</option>";x+="<option value='12'>12</option>";x+="</select>";x+="<select id='yearExp' name='yearExp'>";x+="<option value=''>Año</option>";x+="</select>";x+="</li>";x+="<li class='field-group-item'>";x+="<label for='bank-name'>Banco</label>";x+="<select id='bank-name' name='bank-name'>";x+="<option selected value=''>"+banco+"</option>";x+="</select>";x+="</li>";x+="</ul>";x+="<ul class='field-group'>";x+="<li class='field-group-item'>";x+="<label for='card-number'>N° de Cuenta Destino</label>";x+="<input class='field-medium' id='card-number' name='card-number' maxlength='16' value='"+t+"'/>";x+="</li>";x+=" <li class='field-group-item'>";x+="<label for='card-holder'>Beneficiario</label>";x+="<input class='field-large' id='card-holder' name='card-holder' maxlength='35' type='text' value='"+z+"' />";x+="</li>";x+="</ul>";x+="<ul class='field-group'>";x+="<li class='field-group-item'>";x+="<label for='bank-account-holder-id'>Documento de Identidad</label>";x+="<select id='doc-name' name='doc-name'>";x+="<option selected value='"+tipo_doc+"'>"+tipo_doc+"</option>";x+="<option value='V'>V</option>";x+="<option value='E'>E</option>";x+="<option value='J'>J</option>";x+="<option value='G'>G</option>";x+="</select>";x+="<input class='field-medium' id='bank-account-holder-id' name='bank-account-holder-id' maxlength='14' minlength='5' type='text' value="+id_ext_per+" />";x+="</li>";x+="<li class='field-group-item'>";x+="<label for='card-holder-email'>Correo Electrónico</label>";x+="<input class='field-large' id='card-holder-email' name='card-holder-email' maxlength='30'  type='text' value="+emailCliente+" />";x+="</li>";x+="</ul>";x+="</form>";x+="<div id='msg' banco='"+codBanco+"''></div>";x+="<div class='form-actions'>";x+="<button id='cancelar1' type='reset'>Cancelar</button>";x+="<button id='cambiar'>Modificar</button>";x+="</div>";x+="</div>";$("#content-holder").append(x);$.each(w,function(D,F){var E=F.toString().substring(2,4);var G="<option value='"+E+"'>"+F+"</option>";$("#yearExp").append(G)});c();$("#cancelar1").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")});$("#cambiar").click(function(){b();$("#datos").submit();setTimeout(function(){$("#msg").fadeOut()},5000);var E,N,I;E=$("#datos");var K=$("#card-number").val();cod_ban=K.substr(0,1);banc=true;if((cod_ban!="5")&&cod_ban!="4"){banc=false;$("#dialog-banco").dialog({title:"Tarjeta inválida",modal:"true",width:"440px",open:function(P,Q){$(".ui-dialog-titlebar-close",Q.dialog).hide()}});$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")});$(this).val("")}if((E.valid()==true)&&(banc==true)){var H;var K=$("#card-number").val();var G=$("#card-holder").val();var F=$("#bank-account-holder-id").val();var M=$("#doc-name option:selected").val();var O=M+F;var D=$("#card-holder-email").val();var L=$("#bank-name").val();var J=$("#msg").attr("banco");$("#selCtaOrigen").attr("style","display:none");$("#content-holder").children().remove();o=$("#donor").find(".product-cardnumber").html();H="<div id='progress'>";H+="<ul class='steps'>";H+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";H+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";H+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";H+="</ul>";H+="</div>";H+="<div id='content-holder'>";H+="<h2>Confirmación</h2>";H+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>";H+="<tbody>";H+="<tr>";H+="<td class='data-label'><label>Cuenta de Origen</label></td>";H+="<td class='data-reference'>"+f+"<br /><span class='highlight'>"+o+"</span><br /><span class='lighten'>"+e+"</span></td>";H+="</tr>";H+="<tr>";H+="<td class='data-label'><label>Cuenta Destino a Afiliar</label;></td>";H+="<td class='data-reference'>"+G+"<span class='lighten'>( "+D+" )</span><br /> "+O+" <br /><span class='highlight'>"+K+"</span><br /><span class='lighten'>"+banco+"</span></td>";H+="</tr>";H+="</tbody>";H+="</table>";H+="<div class='form-actions'>";H+="<button id='cancelar' type='reset'>Cancelar</button>";H+="<button id='continuar'>Continuar</button>";H+="</div>";H+="</div>";$("#content-holder").append(H);$("#continuar").click(function(){$.post(base_url+"/adm/modificar",{id_afiliacion:id_afiliacion,nroPlasticoOrigen:g,nroCuentaDestino:K,id_ext_per:O," beneficiario":G,tipoOperacion:"P2C",email:D,banco:J},function(Q){if(Q.rc==0){var P;$("#progress").attr("style","display:none");$("#content-holder").children().remove();P="<div id='progress'>";P+="<ul class='steps'>";P+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";P+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";P+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";P+="</ul>";P+="</div>";P+="<div class='alert-success' id='message'>";P+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación modificada satisfactoriamente";P+="</div>";P+="<div class='form-actions'>";P+="<button id='exit'>Finalizar</button>";P+="</div>";$("#content-holder").append(P)}else{var P;$("#progress").attr("style","display:none");$("#content-holder").children().remove();P="<div class='alert-error' id='message'>";P+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no modificada";P+="</div>";P+="<div class='form-actions'>";P+="<button id='exit'>Finalizar</button>";P+="</div>";$("#content-holder").append(P)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})})}$("#cancelar").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})});$(".muestraDestino").on("click","#eliminar",function(){tarjeta=$(this).parents(".dashboard-item").attr("card");id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per");nombre=$(this).parents(".dashboard-item").attr("nombre");emailCliente=$(this).parents(".dashboard-item").attr("emailCliente");banco=$(this).parents(".dashboard-item").attr("banco");codBanco=$(this).parents(".dashboard-item").attr("codBanco");mascara=$("#donor").find(".product-cardnumber").html();$("#selCtaOrigen").attr("style","display:none");var o;$("#content-holder").children().remove();o="<div id='progress'>";o+="<ul class='steps two-steps'>";o+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>";o+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";o+="</ul>";o+="</div>";o+="<div id='content-holder'>";o+="<h2>Eliminación de Afiliación</h2>";o+="<p>Por favor, verifique los datos de la afiliación que Ud. está a punto de remover.</p>";o+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>";o+="<tbody>";o+="<tr>";o+="<td class='data-label'><label>Cuenta de Origen</label></td>";o+="<td class='data-reference'>"+f+"<br /><span class='highlight'>"+mascara+"</span><br /><span class='lighten'>"+i+"</span></td>";o+="</tr>";o+="<tr>";o+="<td class='data-label'><label>Cuenta Destino Afiliada</label></td>";o+="<td class='data-reference'>"+nombre+"<span class='lighten'>("+emailCliente+" )</span><br />"+id_ext_per+"<br /><span class='highlight'>"+tarjeta+"</span><br /><span class='lighten'>"+banco+"</span></td>";o+="</tr>";o+="</tbody>";o+="</table>";o+="<div class='form-actions'>";o+="<button id='cancel' type='reset'>Cancelar</button>";o+="<button id='cont'>Continuar</button>";o+="</div>";o+="</div>";$("#content-holder").append(o);$("#cont").click(function(){$.post(base_url+"/adm/eliminar",{noTarjeta:g,noCuentaDestino:tarjeta,tipoOperacion:"P2C"},function(q){if(q.rc==0){$("#progress").attr("style","display:none");$("#content-holder").children().remove();p="<div id='progress'>";p+="<ul class='steps two-steps'>";p+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>";p+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";p+="</ul>";p+="</div>";p+="<div class='alert-success' id='message'>";p+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación eliminada satisfactoriamente";p+="</div>";p+="<div class='form-actions'>";p+="<button id='exit'>Finalizar</button>";p+="</div>";$("#content-holder").append(p)}else{var p;$("#progress").attr("style","display:none");$("#content-holder").children().remove();p="<div class='alert-error' id='message'>";p+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no eliminada";p+="</div>";p+="<div class='form-actions'>";p+="<button id='exit'>Finalizar</button>";p+="</div>";$("#content-holder").append(p)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})});$("#cancel").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})}else{$("#empty-state").children().remove();var m='<div id="empty-state" style="position: static;">';m+="<h2>No se encontraron tarjetas asociadas</h2>";m+="<p>Vuelva a realizar la búsqueda con una tarjeta distinta.</p>";m+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -415px;"></span>';m+="</div>";$("#empty-state").append(m)}})}function b(){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("numOnly",function(h,g){var i=/^[a-zA-Z0-9]+$/,f=g.value;if(i.test(f)){return true}else{return false}});var e=/^[a-zA-Z_áéíóúñ\s]*$/;$("#datos").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:true,number:true},"card-holder":{required:true,pattern:e},"doc-name":{required:true},"bank-account-holder-id":{number:true,required:true,maxlength:14,minlength:5,numOnly:true},"card-holder-email":{required:true,email:true},MonthExp:{required:true},yearExp:{required:true}},messages:{"card-number":"El n° de cuenta destino no puede estar vacío y debe contener solo números.","card-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com).",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}function c(){$.ajaxSetup({async:false});$.post(base_url+"/affiliation/bancos",function(e){$.each(e.lista,function(h,f){var g;g="<option value="+f.codBcv+"> "+f.nomBanco+" </option>";$("#bank-name").append(g)})})}function a(h){var g="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç";var f="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc";for(var e=0;e<g.length;e++){h=h.replace(g.charAt(e),f.charAt(e))}return h}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(e,f){$(".ui-dialog-titlebar-close",f.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});