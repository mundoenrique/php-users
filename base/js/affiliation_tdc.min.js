var path,base_cdn;path=window.location.href.split("/"),base_cdn=path[0]+"//"+path[2].replace("online","cdn")+"/"+path[3],base_url=path[0]+"//"+path[2]+"/"+path[3],$(function(){function a(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("numOnly",function(a,e){var n=/^[a-zA-Z0-9]+$/,r=e.value;return!!n.test(r)});$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"bank-name":"required","bank-account-holder":{required:!0,pattern:/^[a-zA-Z_áéíóúñ\s]*$/},"doc-name":{required:!0},"card-number":{required:!0,number:!0,minlength:16,maxlength:16},"bank-account-holder-id":{number:!0,required:!0,maxlength:14,minlength:5,numOnly:!0},"bank-account-holder-email":{required:!0,email:!0}},messages:{"bank-name":"Debe seleccionar un banco","bank-account-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"card-number":"El número de cuenta no puede estar vacío y debe contener solo números y debe contener 16 números","doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"bank-account-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)"}})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var a=$("#dashboard-donor");a.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}}),$("#filters-stack .option-set").find("a").click(function(){var e=$(this);if(e.hasClass("selected"))return!1;var n=e.parents(".option-set");n.find(".selected").removeClass("selected"),e.addClass("selected");var r={},t=n.attr("data-option-key"),i=e.attr("data-option-value");return i="false"!==i&&i,r[t]=i,"layoutMode"===t&&"function"==typeof changeLayoutMode?changeLayoutMode(e,r):a.isotope(r),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var a,e,n,r,t,i,o;a=$(this).find("img").attr("src"),e=$(this).attr("card"),n=$(this).attr("marca"),r=$(this).attr("mascara"),t=$(this).attr("producto1"),$(this).attr("empresa"),o=$(this).attr("nombre"),prefix=$(this).attr("prefix"),$("#donor").children().remove(),i='<div class="product-presentation" producto="'+t+'">',i+='<img src="'+a+'" width="200" height="130" alt="" />',i+='<div class="product-network '+n.toLowerCase()+'"></div>',i+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" prefix="'+prefix+'" producto="'+t+'" cardOrigen="'+e+'" />',i+="</div>",i+='<div class="product-info">',i+='<p class="product-cardholder" id="nombreCtaOrigen">'+o+"</p>",i+='<p class="product-cardnumber" id="mascara">'+r+"</p>",i+='<p class="product-metadata" id="marca">'+t+"</p>",i+='<nav class="product-stack">',i+='<ul class="stack">',i+='<li class="stack-item">',i+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',i+="</li>",i+="</ul>",i+="</nav>",i+="</div>",$("#donor").append(i),$(".product-button").removeClass("disabled-button"),$("#card-number").attr("disabled",!1),$("#bank-account-holder").attr("disabled",!1),$("#bank-account-holder-id").attr("disabled",!1),$("#bank-account-holder-email").attr("disabled",!1),$("#afiliar").attr("disabled",!1),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close"),$(".stack-item").click(function(){$("#tdestino").children().remove(),$("#tdestino").append($("#removerDestino").html()),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}})})}),function(){$.ajaxSetup({async:!1}),$.post(base_url+"/affiliation/bancos",function(a){$.each(a.lista,function(a,e){var n;n="<option value="+e.codBcv+" nombre="+e.nomBanco+"> "+e.nomBanco+" </option>",$("#bank-name").append(n)})})}(),$("#afiliar").click(function(){a(),$("#validate_afiliacion").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3);var e,n,r,t,i,o=$("#validate_afiliacion");nombre=$("#donor").find(".product-cardholder").html(),mascara=$("#donor").find(".product-cardnumber").html(),numeroCtaOrigen=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen"),nombreCtaOrigen=$("#donor").find("#nombreCtaOrigen").html(),marca=$("#donor").find("#donor-cardnumber-origen").attr("producto"),e=$("#content-holder").find(".nrocta").val(),n=$("#content-holder").find("#bank-account-holder").val(),r=$("#content-holder").find("#bank-account-holder-id").val(),t=$("#content-holder").find("#bank-account-holder-email").val(),banco=$("#bank-name option:selected").val(),nombre_banco=$("#bank-name option:selected").text(),prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix");var c=$("#doc-name option:selected").val(),l=c+r;i="<tr>",i+='<td class="data-label"><label>Cuenta Origen</label></td>',i+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" nombreCtaOrigen="'+nombreCtaOrigen+'" numeroCtaOrigen="'+numeroCtaOrigen+'" prefix="'+prefix+'" mascara="'+mascara+'" marca="'+marca+'">'+nombre+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+mascara+'</span><br /><span class="lighten"> '+marca+" </span></td>",i+="</tr>",i+="<tr>",i+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>',i+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+n+'" email="'+t+'" cedula="'+l+'" numeroCta="'+e+'" nombre_banco="'+nombre_banco+'" banco="'+banco+'">"'+n+'" <span class="lighten">("'+t+'")</span><br />'+l+'<br /><span class="highlight">'+e+'</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>',i+="</tr><tr>",cod_ban=e.substr(0,1),banc=!0,"5"!=cod_ban&&"4"!=cod_ban&&(banc=!1,$("#dialog-banco").dialog({title:"Tarjeta inválida",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")}),$(this).val("")),1==o.valid()&&1==banc&&($("#content").children().remove(),$("#content").append($("#content-confirmacion").html()),$("#cargarConfirmacion").append(i),$(".continuar").click(function(){var a,i=new Date;hora=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds();var o=i.getDate(),c=i.getMonth()+1,l=i.getFullYear();o<10&&(o="0"+o),c<10&&(c="0"+c);var d=o+"/"+c+"/"+l;numeroCtaOrigen=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("numeroCtaOrigen"),nombreCtaOrigen=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("nombreCtaOrigen"),prefix=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("prefix"),marca=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("marca"),mascara=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("mascara"),n=$("#cargarConfirmacion").find("#ctaAfiliar").attr("beneficiario"),e=$("#cargarConfirmacion").find("#ctaAfiliar").attr("numeroCta"),t=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email"),r=$("#cargarConfirmacion").find("#ctaAfiliar").attr("cedula"),banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("banco"),nombre_banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("nombre_banco"),$.post(base_url+"/affiliation/affiliation_P2T",{nroPlasticoOrigen:numeroCtaOrigen,beneficiario:n,nroCuentaDestino:e,tipoOperacion:"P2C",email:t,cedula:r,banco:banco,prefix:prefix},function(i){i.rc==-61&&$(location).attr("href",base_url+"/users/error_gral"),0==i.rc||i.rc==-188?(a="<tr>",a+='<td class="data-label"><label>Fecha de Operación</label></td>',a+='<td class="data-reference"> <span class="lighten"> '+d+"  "+hora+" </span></td>",a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta de Origen</label></td>',a+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>',a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>',a+='<td class="data-reference">"'+n+'"<span class="lighten">("'+t+'")</span><br />"'+r+'"<br /><span class="highlight">"'+e+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>',a+="</tr>",$("#content").children().remove(),$("#cargarFinalizacion").append(a),0==i.rc?$("#content").append($("#content-finalizar").html()):($("#content").append($("#content-finalizar2").html()),$("#cargarFinalizacion3").append(a))):i.rc==-178?($("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido3").click(function(){$("#dialog-error-afil2").dialog("close"),$(location).attr("href",base_url+"/affiliation/affiliation_bank")})):i.rc==-210?($("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close"),$(location).attr("href",base_url+"/affiliation/affiliation_tdc")})):(a="<tr>",a+='<td class="data-label"><label>Fecha de Operación: </label></td>',a+='<td class="data-reference"><span class="lighten"> '+d+" "+hora+" </span> </td>",a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta de Origen</label></td>',a+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>',a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Tarjeta de Crédito Destino</label></td>',a+='<td class="data-reference">"'+n+'"<span class="lighten">("'+t+'")</span><br />"'+r+'"<br /><span class="highlight">"'+e+'"</span><br /><span class="lighten">"'+banco+'"</span></td>',a+="</tr>",$("#content").children().remove(),$("#content").append($("#content-finalizar3").html()),$("#cargarFinalizacion2").append(a))})}))}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});