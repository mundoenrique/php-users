var path,base_cdn;path=window.location.href.split("/");base_cdn=path[0]+"//"+path[2].replace("online","cdn")+"/"+path[3];base_url=path[0]+"//"+path[2]+"/"+path[3];$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(f,g){$(".ui-dialog-titlebar-close",g.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});var d=$("#dashboard-donor");d.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var c=$("#filters-stack .option-set"),e=c.find("a");e.click(function(){var j=$(this);if(j.hasClass("selected")){return false}var h=j.parents(".option-set");h.find(".selected").removeClass("selected");j.addClass("selected");var f={},g=h.attr("data-option-key"),i=j.attr("data-option-value");i=i==="false"?false:i;f[g]=i;if(g==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(j,f)}else{d.isotope(f)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$(".dashboard-item").click(function(){var e,j,h,g,c,f,d,i;e=$(this).find("img").attr("src");j=$(this).attr("card");h=$(this).attr("marca");g=$(this).attr("mascara");c=$(this).attr("producto1");f=$(this).attr("empresa");i=$(this).attr("nombre");prefix=$(this).attr("prefix");$("#donor").children().remove();d='<div class="product-presentation" producto="'+c+'">';d+='<img src="'+e+'" width="200" height="130" alt="" />';d+='<div class="product-network '+h.toLowerCase()+'"></div>';d+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" prefix="'+prefix+'" producto="'+c+'" cardOrigen="'+j+'" />';d+="</div>";d+='<div class="product-info">';d+='<p class="product-cardholder" id="nombreCtaOrigen">'+i+"</p>";d+='<p class="product-cardnumber" id="mascara">'+g+"</p>";d+='<p class="product-metadata" id="marca">'+c+"</p>";d+='<nav class="product-stack">';d+='<ul class="stack">';d+='<li class="stack-item">';d+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';d+="</li>";d+="</ul>";d+="</nav>";d+="</div>";$("#donor").append(d);$(".product-button").removeClass("disabled-button");$("#card-number").attr("disabled",false);$("#yearExp").attr("disabled",false);$("#MonthExp").attr("disabled",false);$("#bank-account-holder").attr("disabled",false);$("#bank-account-holder-id").attr("disabled",false);$("#bank-account-holder-email").attr("disabled",false);$("#afiliar").attr("disabled",false);$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");$(".stack-item").click(function(){$("#tdestino").children().remove();$("#tdestino").append($("#removerDestino").html());$("#botonContinuar").attr("disabled",true);$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(k,l){$(".ui-dialog-titlebar-close",l.dialog).hide()}})})});b();$("#afiliar").click(function(){a();$("#validate_afiliacion").submit();setTimeout(function(){$("#msg").fadeOut()},5000);var i=$("#validate_afiliacion");var j,d,e,g,c;nombre=$("#donor").find(".product-cardholder").html();mascara=$("#donor").find(".product-cardnumber").html();numeroCtaOrigen=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen");nombreCtaOrigen=$("#donor").find("#nombreCtaOrigen").html();marca=$("#donor").find("#donor-cardnumber-origen").attr("producto");j=$("#content-holder").find(".nrocta").val();d=$("#content-holder").find("#bank-account-holder").val();e=$("#content-holder").find("#bank-account-holder-id").val();g=$("#content-holder").find("#bank-account-holder-email").val();banco=$("#bank-name option:selected").val();nombre_banco=$("#bank-name option:selected").text();prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix");var h=$("#doc-name option:selected").val();var f=h+e;c="<tr>";c+='<td class="data-label"><label>Cuenta Origen</label></td>';c+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" nombreCtaOrigen="'+nombreCtaOrigen+'" numeroCtaOrigen="'+numeroCtaOrigen+'" prefix="'+prefix+'" mascara="'+mascara+'" marca="'+marca+'">'+nombre+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+mascara+'</span><br /><span class="lighten"> '+marca+" </span></td>";c+="</tr>";c+="<tr>";c+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>';c+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+d+'" email="'+g+'" cedula="'+f+'" numeroCta="'+j+'" nombre_banco="'+nombre_banco+'" banco="'+banco+'">"'+d+'" <span class="lighten">("'+g+'")</span><br />'+f+'<br /><span class="highlight">'+j+'</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>';c+="</tr><tr>";cod_ban=j.substr(0,1);banc=true;if((cod_ban!="5")&&cod_ban!="4"){banc=false;$("#dialog-banco").dialog({title:"Tarjeta inválida",modal:"true",width:"440px",open:function(k,l){$(".ui-dialog-titlebar-close",l.dialog).hide()}});$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")});$(this).val("")}if((i.valid()==true)&&(banc==true)){$("#content").children().remove();$("#content").append($("#content-confirmacion").html());$("#cargarConfirmacion").append(c);$(".continuar").click(function(){var m;var n=new Date();hora=(n.getHours())+":"+n.getMinutes()+":"+n.getSeconds();var k=n.getDate();var o=n.getMonth()+1;var p=n.getFullYear();if(k<10){k="0"+k}if(o<10){o="0"+o}var l=k+"/"+o+"/"+p;numeroCtaOrigen=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("numeroCtaOrigen");nombreCtaOrigen=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("nombreCtaOrigen");prefix=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("prefix");marca=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("marca");mascara=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("mascara");d=$("#cargarConfirmacion").find("#ctaAfiliar").attr("beneficiario");j=$("#cargarConfirmacion").find("#ctaAfiliar").attr("numeroCta");g=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email");e=$("#cargarConfirmacion").find("#ctaAfiliar").attr("cedula");banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("banco");nombre_banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("nombre_banco");$.post(base_url+"/affiliation/affiliation_P2T",{nroPlasticoOrigen:numeroCtaOrigen,beneficiario:d,nroCuentaDestino:j,tipoOperacion:"P2C",email:g,cedula:e,banco:banco,prefix:prefix},function(q){if(q.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}if(q.rc==0||q.rc==-188){m="<tr>";m+='<td class="data-label"><label>Fecha de Operación</label></td>';m+='<td class="data-reference"> <span class="lighten"> '+l+"  "+hora+" </span></td>";m+="</tr>";m+="<tr>";m+='<td class="data-label"><label>Cuenta de Origen</label></td>';m+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>';m+="</tr>";m+="<tr>";m+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>';m+='<td class="data-reference">"'+d+'"<span class="lighten">("'+g+'")</span><br />"'+e+'"<br /><span class="highlight">"'+j+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>';m+="</tr>";$("#content").children().remove();$("#cargarFinalizacion").append(m);if(q.rc==0){$("#content").append($("#content-finalizar").html())}else{$("#content").append($("#content-finalizar2").html());$("#cargarFinalizacion3").append(m)}}else{if(q.rc==-178){$("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(r,s){$(".ui-dialog-titlebar-close",s.dialog).hide()}});$("#invalido3").click(function(){$("#dialog-error-afil2").dialog("close");$(location).attr("href",base_url+"/affiliation/affiliation_bank")})}else{if(q.rc==-210){$("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(r,s){$(".ui-dialog-titlebar-close",s.dialog).hide()}});$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close");$(location).attr("href",base_url+"/affiliation/affiliation_tdc")})}else{m="<tr>";m+='<td class="data-label"><label>Fecha de Operación: </label></td>';m+='<td class="data-reference"><span class="lighten"> '+l+" "+hora+" </span> </td>";m+="</tr>";m+="<tr>";m+='<td class="data-label"><label>Cuenta de Origen</label></td>';m+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>';m+="</tr>";m+="<tr>";m+='<td class="data-label"><label>Tarjeta de Crédito Destino</label></td>';m+='<td class="data-reference">"'+d+'"<span class="lighten">("'+g+'")</span><br />"'+e+'"<br /><span class="highlight">"'+j+'"</span><br /><span class="lighten">"'+banco+'"</span></td>';m+="</tr>";$("#content").children().remove();$("#content").append($("#content-finalizar3").html());$("#cargarFinalizacion2").append(m)}}}})})}});function a(){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("numOnly",function(f,e){var g=/^[a-zA-Z0-9]+$/,d=e.value;if(g.test(d)){return true}else{return false}});var c=/^[a-zA-Z_áéíóúñ\s]*$/;$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"bank-name":"required","bank-account-holder":{required:true,pattern:c},"doc-name":{required:true},"card-number":{required:true,number:true,minlength:16,maxlength:16},"bank-account-holder-id":{number:true,required:true,maxlength:14,minlength:5,numOnly:true},"bank-account-holder-email":{required:true,email:true},MonthExp:{required:true},yearExp:{required:true}},messages:{"bank-name":"Debe seleccionar un banco","bank-account-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"card-number":"El número de cuenta no puede estar vacío y debe contener solo números y debe contener 16 números","doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"bank-account-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}function b(){$.ajaxSetup({async:false});$.post(base_url+"/affiliation/bancos",function(c){$.each(c.lista,function(f,d){var e;e="<option value="+d.codBcv+" nombre="+d.nomBanco+"> "+d.nomBanco+" </option>";$("#bank-name").append(e)})})}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(c,d){$(".ui-dialog-titlebar-close",d.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});