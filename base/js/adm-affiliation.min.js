var path,base_cdn;path=window.location.href.split("/"),base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1")),base_url=path[0]+"//"+path[2]+"/"+path[3];var pais;$(function(){function e(e,t,n,r,o){$.post("transferencia/ctaDestino",{nroTarjeta:e,prefijo:t,operacion:"P2P"},function(t){if(t.rc==-61&&$(location).attr("href",base_url+"/users/error_gral"),0==t.rc)$("#empty-state").remove(),$.each(t.cuentaDestinoPlata,function(e,a){imagen1=a.nombre_producto.toLowerCase(),imagen2=i(imagen1),imagen3=imagen2.replace(" ","-"),imagen4=imagen3.replace(" ","-"),imagen=imagen4.replace("/","-");var t;t="<li class='dashboard-item "+a.nomEmp+" muestraDestino' card='"+a.noTarjeta+"' id_ext_per='"+a.id_ext_per+"' nombre='"+a.NombreCliente+"' emailCliente='"+a.emailCliente+"' id_afiliacion='"+a.id_afiliacion+"' marca='"+a.marca+"' mascara='"+a.noTarjetaConMascara+"' empresa='"+a.nomEmp+"' producto='"+a.nombre_producto.replace(" ","-")+"'>",t+="<div class='dashboard-item-box'>",t+="<img src='"+base_cdn+"/img/products/"+pais+"/"+imagen+".png' width='200' height='130' alt='' />",t+="<div class='dashboard-item-network "+a.marca.toLowerCase()+"'>"+a.marca+"</div>",t+="<div class='dashboard-item-info'>",t+="<p class='dashboard-item-cardholder'>"+a.NombreCliente+"</p>",t+="<ul class='dashboard-item-actions'>",t+="<li class='actions-item'>",t+="<a title='Modificar' id='modificar'><span aria-hidden='true' class='icon-edit'></span></a>",t+="</li>",t+="<li class='actions-item' id='eliminar'>",t+="<a title='Remover'><span aria-hidden='true' class='icon-remove'></span></a>",t+="</li>",t+="</ul>",t+="<p class='dashboard-item-cardnumber'>"+a.noTarjetaConMascara+"</p>",t+="<p class='dashboard-item-category'>"+a.nombre_producto+"</p>",t+="</div>",t+="</div>",t+="</li>",$("#dashboard").append(t)}),$(".muestraDestino").on("click","#modificar",function(){var i,t;i=$(this).parents(".dashboard-item").attr("card"),id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per"),t=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),id_afiliacion=$(this).parents(".dashboard-item").attr("id_afiliacion"),$("#selCtaOrigen").attr("style","display:none"),$("#content-holder").children().remove();var n,s,l,c,d,p,u=[];for(s=new Date,l=s.getFullYear(),c=l-5,d=l+5,p=c;p<=d;p++)u.push(p);n="<div id='progress'>",n+="<ul class='steps'>",n+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",n+="<li class='step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",n+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",n+="</ul>",n+="</div>",n+="<div id='content-holder'>",n+="<form id='datos'>",n+="<ul class='field-group'>",n+="<li class='field-group-item'>",n+="<label for='dayExp'>Fecha de Vencimiento</label>",n+="<select id='MonthExp' name='MonthExp' style='margin-right: 5px;'>",n+="<option value=''>Mes</option>",n+="<option value='01'>01</option>",n+="<option value='02'>02</option>",n+="<option value='03'>03</option>",n+="<option value='04'>04</option>",n+="<option value='05'>05</option>",n+="<option value='06'>06</option>",n+="<option value='07'>07</option>",n+="<option value='08'>08</option>",n+="<option value='09'>09</option>",n+="<option value='10'>10</option>",n+="<option value='11'>11</option>",n+="<option value='12'>12</option>",n+="</select>",n+="<select id='yearExp' name='yearExp'>",n+="<option value=''>Año</option>",n+="</select>",n+="</li>",n+="<li class='field-group-item'>",n+="<label for='card-number'>N° de Cuenta Destino</label>",n+="<input class='field-medium' id='card-number' name='card-number' maxlength='16' type='text' value="+i+" />",n+="</li>",n+=" <li class='field-group-item'>",n+="<label for='card-holder'>Beneficiario</label>",n+="<input class='field-large' id='card-holder' name='card-holder' maxlength='30' type='text' value='"+t+"' />",n+="</li>",n+="</ul>",n+="<ul class='field-group'>",n+="<li class='field-group-item'>",n+="<label for='bank-account-holder-id'>Documento de Identidad</label>",n+="<input class='field-medium' id='bank-account-holder-id' name='bank-account-holder-id' maxlength='9' type='text' value="+id_ext_per+" />",n+="</li>",n+="<li class='field-group-item'>",n+="<label for='card-holder-email'>Correo Electrónico</label>",n+="<input class='field-large' id='card-holder-email' name='card-holder-email' maxlength='30'  type='text' value="+emailCliente+" />",n+="</li>",n+="</ul>",n+="</form>",n+="<div class='form-actions'>",n+="<button id='cancelar1' type='reset'>Cancelar</button>",n+="<button id='cambiar'>Modificar</button>",n+="</div>",n+="</div>",n+="<div id='msg'></div>",$("#content-holder").append(n),$.each(u,function(e,a){var i=a.toString().substring(2,4),t="<option value='"+i+"'>"+a+"</option>";$("#yearExp").append(t)}),$("#cancelar1").click(function(){$(location).attr("href",base_url+"/adm")}),$("#cambiar").click(function(){a(),$("#datos").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3);var i;if(i=$("#datos"),1==i.valid()){var t,n=$("#card-number").val(),s=$("#card-holder").val(),l=$("#bank-account-holder-id").val(),c=$("#card-holder-email").val(),d=$("#MonthExp").val()+$("#yearExp").val();$("#selCtaOrigen").attr("style","display:none"),$("#content-holder").children().remove(),t="<div id='progress'>",t+="<ul class='steps'>",t+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",t+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",t+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",t+="</ul>",t+="</div>",t+="<div id='content-holder'>",t+="<h2>Confirmación</h2>",t+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",t+="<tbody>",t+="<tr>",t+="<td class='data-label'><label>Cuenta de Origen</label></td>",t+="<td class='data-reference'>"+o+"<br /><span class='highlight'>"+e+"</span><br /><span class='lighten'>"+r+"</span></td>",t+="</tr>",t+="<tr>",t+="<td class='data-label'><label>Cuenta Destino a Afiliar</label></td>",t+="<td class='data-reference'>"+s+"<span class='lighten'>( "+c+" )</span><br /> "+l+" <br /><span class='highlight'>"+n+"</span></td>",t+="</tr>",t+="</tbody>",t+="</table>",t+="<div class='form-actions'>",t+="<button id='cancelar2' type='reset'>Cancelar</button>",t+="<button id='continuar'>Continuar</button>",t+="</div>",t+="</div>",$("#content-holder").append(t),$("#cancelar2").click(function(){$(location).attr("href",base_url+"/adm")}),$("#continuar").click(function(){$.post("adm/modificar",{id_afiliacion:id_afiliacion,nroPlasticoOrigen:e,nroCuentaDestino:n,id_ext_per:l," beneficiario":s,tipoOperacion:"P2P",email:c,banco:"",expDate:d},function(e){if(0==e.rc){var a;$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps'>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div class='alert-success' id='message'>",a+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación modificada satisfactoriamente",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)}else{var a,i=e.rc===-344?"la fecha de expiracion indicada es incorrecta":"";$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div class='alert-error' id='message'>",a+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no modificada, "+i,a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm")})})})}$("#cancelar").click(function(){$(location).attr("href",base_url+"/adm")})})}),$(".muestraDestino").on("click","#eliminar",function(){tarjeta=$(this).parents(".dashboard-item").attr("card"),id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per"),nombre=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),$("#selCtaOrigen").attr("style","display:none");var a;$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps two-steps'>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",a+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div id='content-holder'>",a+="<h2>Eliminación de Afiliación</h2>",a+="<p>Por favor, verifique los datos de la afiliación que Ud. está a punto de remover.</p>",a+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",a+="<tbody>",a+="<tr>",a+="<td class='data-label'><label>Cuenta de Origen</label></td>",a+="<td class='data-reference'>"+o+"<br /><span class='highlight'>"+e+"</span><br /><span class='lighten'>"+r+"</span></td>",a+="</tr>",a+="<tr>",a+="<td class='data-label'><label>Cuenta Destino Afiliada</label></td>",a+="<td class='data-reference'>"+nombre+"<span class='lighten'>( "+emailCliente+" )</span><br />"+id_ext_per+"<br /><span class='highlight'>"+tarjeta+"</span></td>",a+="</tr>",a+="</tbody>",a+="</table>",a+="<div class='form-actions'>",a+="<button id='cancel' type='reset'>Cancelar</button>",a+="<button id='cont'>Continuar</button>",a+="</div>",a+="</div>",$("#content-holder").append(a),$("#cont").click(function(){$.ajaxSetup({async:!1});var a={noTarjeta:e,noCuentaDestino:tarjeta,tipoOperacion:"P2P"};$.ajax({url:base_url+"/adm/eliminar",data:a,type:"post",dataType:"json",success:function(e){if(0==e.rc)$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps two-steps'>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div class='alert-success' id='message'>",a+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación eliminada satisfactoriamente",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a);else{var a;$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div class='alert-error' id='message'>",a+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no eliminada",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm")})}}),$.ajaxSetup({async:!0})}),$("#cancel").click(function(){$(location).attr("href",base_url+"/adm")})});else{$("#empty-state").children().remove();var n='<div id="empty-state" style="position: static;">';n+="<h2>No se encontraron tarjetas asociadas</h2>",n+="<p>Vuelva a realizar la búsqueda con una tarjeta distinta.</p>",n+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -415px;"></span>',n+="</div>",$("#empty-state").append(n)}})}function a(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#datos").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:!0,number:!0,minlength:16},"card-holder":{required:!0},"bank-account-holder-id":{required:!0,number:!0},"card-holder-email":{required:!0,email:!0},MonthExp:{required:!0},yearExp:{required:!0}},messages:{"card-number":"El n° de cuenta destino no puede estar vacío y debe contener solo números.","card-holder":"El beneficiario no puede estar vacío.","bank-account-holder-id":"El documento de identidad no puede estar vacío y debe contener solo números.","card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com).",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}function i(e){for(var a="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",i="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",t=0;t<a.length;t++)e=e.replace(a.charAt(t),i.charAt(t));return e}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var e=$("#dashboard-donor");e.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var a=$("#filters-stack .option-set"),i=a.find("a");i.click(function(){var a=$(this);if(a.hasClass("selected"))return!1;var i=a.parents(".option-set");i.find(".selected").removeClass("selected"),a.addClass("selected");var t={},n=i.attr("data-option-key"),r=a.attr("data-option-value");return r="false"!==r&&r,t[n]=r,"layoutMode"===n&&"function"==typeof changeLayoutMode?changeLayoutMode(a,t):e.isotope(t),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var a,i,t,n,r,o,s,l;a=$(this).find("img").attr("src"),i=$(this).attr("card"),t=$(this).attr("marca"),n=$(this).attr("mascara"),r=$(this).attr("producto1"),o=$(this).attr("empresa"),l=$(this).attr("nombre"),pais=$(this).attr("pais"),$("#donor").children().remove(),s='<div class="product-presentation" producto="'+r+'">',s+='<img src="'+a+'" width="200" height="130" alt="" />',s+='<div class="product-network '+t.toLowerCase()+'"></div>',s+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" nombreOrigen="'+l+'" cardOrigen="'+i+'" masCtaOrigen="'+d+'" marcaCtaOrigen="'+t+'"  />',s+="</div>",s+='<div class="product-info-full">',s+='<p class="product-cardholder" id="nombreCtaOrigen">'+l+"</p>",s+='<p class="product-cardnumber" id="mascara">'+n+"</p>",s+='<p class="product-metadata" id="marca">'+r+"</p>",s+='<nav class="product-stack" id="selCtaOrigen">',s+='<ul class="stack">',s+='<li class="stack-item">',s+='<a dialog button product-button rel="section" id="buscarCta" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',s+="</li>",s+="</ul>",s+="</nav>",s+="</div>",$("#donor").append(s),$(".product-button").removeClass("disabled-button"),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close");var c=$("#donor-cardnumber-origen").attr("cardorigen"),d=$("#donor-cardnumber-origen").attr("masCtaOrigen"),p=$("#donor-cardnumber-origen").attr("marcaCtaOrigen"),u=$("#donor-cardnumber-origen").attr("nombreOrigen"),m=$(this).attr("prefix");mes=$("#filter-month").val(),anio=$("#filter-year").val(),$("#buscar").removeClass("disabled-button"),$("#list-detail").children().remove(),e(c,m,d,p,u),$(".stack-item").click(function(){$("#dashboard").children().remove(),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}})})}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});