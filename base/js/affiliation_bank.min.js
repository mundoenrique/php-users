var path,base_cdn;path=window.location.href.split("/");base_cdn=path[0]+"//"+path[2].replace("online","cdn")+"/"+path[3];base_url=path[0]+"//"+path[2]+"/"+path[3];$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(f,g){$(".ui-dialog-titlebar-close",g.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});var d=$("#dashboard-donor");d.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var c=$("#filters-stack .option-set"),e=c.find("a");e.click(function(){var j=$(this);if(j.hasClass("selected")){return false}var h=j.parents(".option-set");h.find(".selected").removeClass("selected");j.addClass("selected");var f={},g=h.attr("data-option-key"),i=j.attr("data-option-value");i=i==="false"?false:i;f[g]=i;if(g==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(j,f)}else{d.isotope(f)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$(".dashboard-item").click(function(){var j,g,d,c,k,h,e,i,f;j=$(this).find("img").attr("src");g=$(this).attr("card");d=$(this).attr("marca");c=$(this).attr("mascara");k=$(this).attr("producto1");h=$(this).attr("empresa");i=$(this).attr("nombre");f=$(this).attr("prefix");$("#donor").children().remove();e='<div class="product-presentation" producto="'+k+'">';e+='<img src="'+j+'" width="200" height="130" alt="" />';e+='<div class="product-network '+d.toLowerCase()+'"></div>';e+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+k+'"  prefix="'+f+'"  cardOrigen="'+g+'" />';e+="</div>";e+='<div class="product-info">';e+='<p class="product-cardholder" id="nombreCtaOrigen">'+i+"</p>";e+='<p class="product-cardnumber" id="mascara">'+c+"</p>";e+='<p class="product-metadata" id="marca">'+k+"</p>";e+='<nav class="product-stack">';e+='<ul class="stack">';e+='<li class="stack-item">';e+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';e+="</li>";e+="</ul>";e+="</nav>";e+="</div>";$("#donor").append(e);$(".product-button").removeClass("disabled-button");$("#card-number").attr("disabled",false);$("#bank-account-holder").attr("disabled",false);$("#bank-account-holder-id").attr("disabled",false);$("#bank-account-holder-email").attr("disabled",false);$("#afiliarBank").attr("disabled",false);$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$.each($(".dashboard-item"),function(m,l){if($(this).hasClass("current-dashboard-item")){$(this).removeClass("current-dashboard-item")}});$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");$(".stack-item").click(function(){$("#tdestino").children().remove();$("#tdestino").append($("#removerDestino").html());$("#botonContinuar").attr("disabled",true);$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(l,m){$(".ui-dialog-titlebar-close",m.dialog).hide()}})});$("#afiliarBank").removeClass("disabled-button")});b();$("#content-holder").on("click","#afiliarBank",function(){a();$("#validate_afiliacion").submit();setTimeout(function(){$("#msg").fadeOut()},5000);var c,n,d,m,f,k,o,i,h,e,j,g;c=$("#validate_afiliacion");banco=$("#bank-name option:selected").text();codBanco=$("#bank-name option:selected").val();d=$("#content-holder").find("#bank-account-holder").val();m=$("#content-holder").find("#card-number").val();var p=$("#doc-name option:selected").val();f=$("#content-holder").find("#bank-account-holder-id").val();k=$("#content-holder").find("#bank-account-holder-email").val();var l=p+f;o=$("#donor").find(".product-cardholder").html();i=$("#donor").find(".product-cardnumber").html();h=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen");e=$("#donor").find("#nombreCtaOrigen").html();j=$("#donor").find("#donor-cardnumber-origen").attr("producto");prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix");g="<tr>";g+='<td class="data-label"><label>Cuenta Origen</label></td>';g+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" numeroCtaOrigen="'+h+'" nombreCtaOrigen="'+e+'" prefix="'+prefix+'" mascara="'+i+'" marca="'+j+'">'+o+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+i+'</span><br /><span class="lighten"> '+j+" </span></td>";g+="</tr>";g+="<tr>";g+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>';g+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+d+'" email="'+k+'" cedula="'+l+'" numeroCta="'+m+'" banco="'+banco+'" codBanco="'+codBanco+'">"'+d+'" <span class="lighten">("'+k+'")</span><br />'+l+'<br /><span class="highlight">'+m+'</span><br /><span class="lighten">'+banco+"</span></td>";g+="</tr>";cod_ban=m.substr(0,4);banc=true;if(cod_ban!=codBanco){banc=false;$("#dialog-banco").dialog({title:"Cuenta inválida",modal:"true",width:"440px",open:function(q,r){$(".ui-dialog-titlebar-close",r.dialog).hide()}});$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")});$(this).val("")}if((c.valid()==true)&&(banc==true)){$("#content").children().remove();$("#content").append($("#content-confirmacion").html());$("#cargarConfirmacion").append(g)}$(".continuar").click(function(){var s;var t=new Date();hora=(t.getHours())+":"+t.getMinutes()+":"+t.getSeconds();var q=t.getDate();var u=t.getMonth()+1;var v=t.getFullYear();if(q<10){q="0"+q}if(u<10){u="0"+u}var r=q+"/"+u+"/"+v;h=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("numeroCtaOrigen");e=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("nombreCtaOrigen");prefix=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("prefix");i=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("mascara");d=$("#cargarConfirmacion").find("#ctaAfiliar").attr("beneficiario");m=$("#cargarConfirmacion").find("#ctaAfiliar").attr("numeroCta");k=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email");f=$("#cargarConfirmacion").find("#ctaAfiliar").attr("cedula");banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("codBanco");nombre_banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("banco");j=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("marca");$.post(base_url+"/affiliation/affiliation_P2T",{nroPlasticoOrigen:h,beneficiario:d,nroCuentaDestino:m,tipoOperacion:"P2T",email:k,cedula:f,banco:banco,prefix:prefix},function(y){if(y.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}else{if(y.rc==0||y.rc==-188){s="<tr>";s+='<td class="data-label"><label>Fecha de Operación:</label></td>';s+='<td class="data-reference"><span class="lighten"> '+r+" "+hora+" </span></td>";s+="</tr>";s+="<tr>";s+='<td class="data-label"><label>Cuenta de Origen</label></td>';s+='<td class="data-reference">"'+e+'"<br /><span class="highlight">"'+i+'"</span><br /> <span class="lighten"> "'+j+'" </span> </td>';s+="</tr>";s+="<tr>";s+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>';s+='<td class="data-reference">"'+d+'"<span class="lighten">("'+k+'")</span><br />"'+f+'"<br /><span class="highlight">"'+m+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>';s+="</tr>";$("#content").children().remove();$("#cargarFinalizacion").append(s);if(y.rc==0){$("#content").append($("#content-finalizar").html())}else{$("#content").append($("#content-finalizar2").html());$("#cargarFinalizacion3").append(s)}}else{if(y.rc==-195){$("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(z,A){$(".ui-dialog-titlebar-close",A.dialog).hide()}});$("#invalido3").click(function(){$("#dialog-error-afil2").dialog("close");$(location).attr("href",base_url+"/affiliation/affiliation_bank")})}else{if(y.rc==-210){$("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(z,A){$(".ui-dialog-titlebar-close",A.dialog).hide()}});$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close");$(location).attr("href",base_url+"/affiliation/affiliation_bank")})}else{var w="",x="(15)";switch(y.rc){case -340:w="Cantidad de dígitos de la cuenta es invalida.";break;case -341:w="El número de cuenta no corresponde al banco.";break;case -342:w="Número de cuenta invalido";break;case -343:w="Su tarjeta se encuentra bloqueada, código de bloqueo: ("+x.substr(1,2)+")";break;default:}s="<tr>";s+='<td class="data-label"><label>Fecha de Operación:</label></td>';s+='<td class="data-reference"><span class="lighten"> '+r+" "+hora+" </span></td>";s+="</tr>";s+="<tr>";s+='<td class="data-label"><label>Cuenta de Origen</label></td>';s+='<td class="data-reference">"'+e+'"<br /><span class="highlight">"'+i+'"</span><br /> <span class="lighten"> "'+j+'" </span> </td>';s+="</tr>";s+="<tr>";s+='<td class="data-label"><label>Cuenta Destino</label></td>';s+='<td class="data-reference">"'+d+'"<span class="lighten">("'+k+'")</span><br />"'+f+'"<br /><span class="highlight">"'+m+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>';s+="</tr>";$("#content").children().remove();$("#content").append($("#content-finalizar3").html());$("#nonAfiliation").text(w);$("#cargarFinalizacion2").append(s)}}}}})})});function b(){$.ajaxSetup({async:false});$.post(base_url+"/affiliation/bancos",function(c){$.each(c.lista,function(f,d){var e;e="<option value="+d.codBcv+"> "+d.nomBanco+" </option>";$("#bank-name").append(e)})})}function a(){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("numOnly",function(f,e){var g=/^[a-zA-Z0-9]+$/,d=e.value;if(g.test(d)){return true}else{return false}});var c=/^[a-zA-Z_áéíóúñ\s]*$/;$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"bank-name":"required","card-number":{required:true,number:true,minlength:20,maxlength:20},"doc-name":{required:true},"bank-account-holder-id":{number:true,required:true,maxlength:14,minlength:5,numOnly:true},"bank-account-holder":{required:true,pattern:c},"bank-account-holder-email":{required:true,email:true},MonthExp:{required:true},yearExp:{required:true}},messages:{"bank-name":"Debe seleccionar el banco","card-number":"El número de cuenta no puede estar vacío y debe contener 20 dígitos","doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"bank-account-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"bank-account-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(c,d){$(".ui-dialog-titlebar-close",d.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});