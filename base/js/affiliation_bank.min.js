var path,base_cdn,expDate;path=window.location.href.split("/"),base_cdn=path[0]+"//"+path[2].replace("online","cdn")+"/"+path[3],base_url=path[0]+"//"+path[2]+"/"+path[3],$(function(){function a(){$.ajaxSetup({async:!1}),$.post(base_url+"/affiliation/bancos",function(a){$.each(a.lista,function(a,e){var n;n="<option value="+e.codBcv+"> "+e.nomBanco+" </option>",$("#bank-name").append(n)})})}function e(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("numOnly",function(a,e){var n=/^[a-zA-Z0-9]+$/,t=e.value;return!!n.test(t)});var a=/^[a-zA-Z_áéíóúñ\s]*$/;$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"bank-name":"required","card-number":{required:!0,number:!0,minlength:20,maxlength:20},"doc-name":{required:!0},"bank-account-holder-id":{number:!0,required:!0,maxlength:14,minlength:5,numOnly:!0},"bank-account-holder":{required:!0,pattern:a},"bank-account-holder-email":{required:!0,email:!0},"month-exp":{required:!0},"year-exp":{required:!0}},messages:{"bank-name":"Debe seleccionar el banco","card-number":"El número de cuenta no puede estar vacío y debe contener 20 dígitos","doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"bank-account-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"bank-account-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)","month-exp":"Seleccione el mes de vencimiento de su tarjeta","year-exp":"Seleccione el año de vencimiento de su tarjeta"}})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var a=$("#dashboard-donor");a.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var e=$("#filters-stack .option-set"),n=e.find("a");n.click(function(){var e=$(this);if(e.hasClass("selected"))return!1;var n=e.parents(".option-set");n.find(".selected").removeClass("selected"),e.addClass("selected");var t={},r=n.attr("data-option-key"),i=e.attr("data-option-value");return i="false"!==i&&i,t[r]=i,"layoutMode"===r&&"function"==typeof changeLayoutMode?changeLayoutMode(e,t):a.isotope(t),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var a,e,n,t,r,i,o,c,l;a=$(this).find("img").attr("src"),e=$(this).attr("card"),n=$(this).attr("marca"),t=$(this).attr("mascara"),r=$(this).attr("producto1"),i=$(this).attr("empresa"),c=$(this).attr("nombre"),l=$(this).attr("prefix"),$("#donor").children().remove(),o='<div class="product-presentation" producto="'+r+'">',o+='<img src="'+a+'" width="200" height="130" alt="" />',o+='<div class="product-network '+n.toLowerCase()+'"></div>',o+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+r+'"  prefix="'+l+'"  cardOrigen="'+e+'" />',o+="</div>",o+='<div class="product-info">',o+='<p class="product-cardholder" id="nombreCtaOrigen">'+c+"</p>",o+='<p class="product-cardnumber" id="mascara">'+t+"</p>",o+='<p class="product-metadata" id="marca">'+r+"</p>",o+='<nav class="product-stack">',o+='<ul class="stack">',o+='<li class="stack-item">',o+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',o+="</li>",o+="</ul>",o+="</nav>",o+="</div>",$("#donor").append(o),$(".product-button").removeClass("disabled-button"),$("#year-exp").attr("disabled",!1),$("#month-exp").attr("disabled",!1),$("#card-number").attr("disabled",!1),$("#bank-account-holder").attr("disabled",!1),$("#bank-account-holder-id").attr("disabled",!1),$("#bank-account-holder-email").attr("disabled",!1),$("#afiliarBank").attr("disabled",!1),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$.each($(".dashboard-item"),function(a,e){$(this).hasClass("current-dashboard-item")&&$(this).removeClass("current-dashboard-item")}),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close"),$(".stack-item").click(function(){$("#tdestino").children().remove(),$("#tdestino").append($("#removerDestino").html()),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}})}),$("#afiliarBank").removeClass("disabled-button")}),a(),$("#content-holder").on("click","#afiliarBank",function(){e(),$("#validate_afiliacion").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3);var a,n,t,r,i,o,c,l,d,s,u;a=$("#validate_afiliacion"),banco=$("#bank-name option:selected").text(),codBanco=$("#bank-name option:selected").val(),n=$("#content-holder").find("#bank-account-holder").val(),t=$("#content-holder").find("#card-number").val();var b=$("#doc-name option:selected").val();r=$("#content-holder").find("#bank-account-holder-id").val(),i=$("#content-holder").find("#bank-account-holder-email").val();var p=b+r;o=$("#donor").find(".product-cardholder").html(),c=$("#donor").find(".product-cardnumber").html(),l=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen"),d=$("#donor").find("#nombreCtaOrigen").html(),s=$("#donor").find("#donor-cardnumber-origen").attr("producto"),prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix"),expDate=$("#month-exp").val()+$("#year-exp").val(),u="<tr>",u+='<td class="data-label"><label>Cuenta Origen</label></td>',u+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" numeroCtaOrigen="'+l+'" nombreCtaOrigen="'+d+'" prefix="'+prefix+'" mascara="'+c+'" marca="'+s+'">'+o+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+c+'</span><br /><span class="lighten"> '+s+" </span></td>",u+="</tr>",u+="<tr>",u+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>',u+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+n+'" email="'+i+'" cedula="'+p+'" numeroCta="'+t+'" banco="'+banco+'" codBanco="'+codBanco+'">"'+n+'" <span class="lighten">("'+i+'")</span><br />'+p+'<br /><span class="highlight">'+t+'</span><br /><span class="lighten">'+banco+"</span></td>",u+="</tr>",cod_ban=t.substr(0,4),banc=!0,cod_ban!=codBanco&&(banc=!1,$("#dialog-banco").dialog({title:"Cuenta inválida",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")}),$(this).val("")),1==a.valid()&&1==banc&&($("#content").children().remove(),$("#content").append($("#content-confirmacion").html()),$("#cargarConfirmacion").append(u)),$(".continuar").click(function(){var a,e=new Date;hora=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();var o=e.getDate(),u=e.getMonth()+1,b=e.getFullYear();o<10&&(o="0"+o),u<10&&(u="0"+u);var p=o+"/"+u+"/"+b;l=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("numeroCtaOrigen"),d=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("nombreCtaOrigen"),prefix=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("prefix"),c=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("mascara"),n=$("#cargarConfirmacion").find("#ctaAfiliar").attr("beneficiario"),t=$("#cargarConfirmacion").find("#ctaAfiliar").attr("numeroCta"),i=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email"),r=$("#cargarConfirmacion").find("#ctaAfiliar").attr("cedula"),banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("codBanco"),nombre_banco=$("#cargarConfirmacion").find("#ctaAfiliar").attr("banco"),s=$("#cargarConfirmacion").find("#nombreOrigenTransfer").attr("marca"),$.post(base_url+"/affiliation/affiliation_P2T",{nroPlasticoOrigen:l,beneficiario:n,nroCuentaDestino:t,tipoOperacion:"P2T",email:i,cedula:r,banco:banco,prefix:prefix,expDate:expDate},function(e){if(e.rc==-61)$(location).attr("href",base_url+"/users/error_gral");else if(0==e.rc||e.rc==-188)a="<tr>",a+='<td class="data-label"><label>Fecha de Operación:</label></td>',a+='<td class="data-reference"><span class="lighten"> '+p+" "+hora+" </span></td>",a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta de Origen</label></td>',a+='<td class="data-reference">"'+d+'"<br /><span class="highlight">"'+c+'"</span><br /> <span class="lighten"> "'+s+'" </span> </td>',a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>',a+='<td class="data-reference">"'+n+'"<span class="lighten">("'+i+'")</span><br />"'+r+'"<br /><span class="highlight">"'+t+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>',a+="</tr>",$("#content").children().remove(),$("#cargarFinalizacion").append(a),0==e.rc?$("#content").append($("#content-finalizar").html()):($("#content").append($("#content-finalizar2").html()),$("#cargarFinalizacion3").append(a));else if(e.rc==-195)$("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido3").click(function(){$("#dialog-error-afil2").dialog("close"),$(location).attr("href",base_url+"/affiliation/affiliation_bank")});else if(e.rc==-210)$("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close"),$(location).attr("href",base_url+"/affiliation/affiliation_bank")});else{var o="";switch(e.rc){case-340:o="Cantidad de dígitos de la cuenta es invalida.";break;case-341:o="El número de cuenta no corresponde al banco.";break;case-342:o="Número de cuenta invalido";break;case-343:var l=transferencia.msg;o="Su tarjeta se encuentra bloqueada, código de bloqueo: ("+l.substr(34,35)+")";case-344:o="la fecha de vencimiento indicada es incorrecta"}a="<tr>",a+='<td class="data-label"><label>Fecha de Operación:</label></td>',a+='<td class="data-reference"><span class="lighten"> '+p+" "+hora+" </span></td>",a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta de Origen</label></td>',a+='<td class="data-reference">"'+d+'"<br /><span class="highlight">"'+c+'"</span><br /> <span class="lighten"> "'+s+'" </span> </td>',a+="</tr>",a+="<tr>",a+='<td class="data-label"><label>Cuenta Destino</label></td>',a+='<td class="data-reference">"'+n+'"<span class="lighten">("'+i+'")</span><br />"'+r+'"<br /><span class="highlight">"'+t+'"</span><br /><span class="lighten">"'+nombre_banco+'"</span></td>',a+="</tr>",$("#content").children().remove(),$("#content").append($("#content-finalizar3").html()),$("#nonAfiliation").text(o),$("#cargarFinalizacion2").append(a)}})})}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});