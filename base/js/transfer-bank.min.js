var path,base_cdn;path=window.location.href.split("/");base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1"));base_url=path[0]+"//"+path[2]+"/"+path[3];var dobleAutenticacion,claveValida,claveC,confirpass,rpta1,montoMaxDiario,montoMaxMensual,montoMasComision,saldo_imp;$(function(){var e=$("#content").attr("confirmacion");if(e=="1"){$("#content-clave").hide();$("#tabs-menu").show();$("#content_bank").show()}else{$("#content-clave").show()}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(p,q){$(".ui-dialog-titlebar-close",q.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});$.each($(".dashboard-item"),function(q,p){$.post(base_url+"/dashboard/saldo",{tarjeta:$(p).attr("card")},function(t){var s=$(".dashboard-item").attr("moneda");var r=t.disponible;if(typeof r!="string"){r="---"}$(p).find(".dashboard-item-balance").html(s+r)})});var n=$("#dashboard-donor");n.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var l=$("#filters-stack .option-set"),o=l.find("a");o.click(function(){var t=$(this);if(t.hasClass("selected")){return false}var r=t.parents(".option-set");r.find(".selected").removeClass("selected");t.addClass("selected");var p={},q=r.attr("data-option-key"),s=t.attr("data-option-value");s=s==="false"?false:s;p[q]=s;if(q==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(t,p)}else{n.isotope(p)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$("#continuar_transfer").click(function(){var l=$("#transpwd").val();if((i(l))){$("#content-clave").hide();$("#tabs-menu").show();$("#content_bank").show()}else{$("#content_clave").show();$.balloon.defaults.classname="field-error";$.balloon.defaults.css=null;$("#transpwd").showBalloon({position:"right",contents:"Clave inválida"});setTimeout(function(){$("#transpwd").hideBalloon()},3000)}});$(".dashboard-item").click(function(){var y,s,n,l,z,t,o,x,q,w,u,B,A,r,p,v=[];u=new Date();B=u.getFullYear();A=B-5;r=B+5;for(p=A;p<=r;p++){v.push(p)}y=$(this).find("img").attr("src");s=$(this).attr("card");n=$(this).attr("marca");l=$(this).attr("mascara");z=$(this).attr("producto1");t=$(this).attr("empresa");x=$(this).attr("nombre");q=$(this).attr("prefix");moneda=$(this).attr("moneda");pais=$(this).attr("pais");$("#donor").children().remove();o='<div class="product-presentation">';o+='<img src="'+y+'" width="200" height="130" alt="" />';o+='<div class="product-network '+n.toLowerCase()+'"></div>';o+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" cardOrigen="'+s+'" />';o+="</div>";o+='<div class="product-info">';o+='<p class="product-cardholder" id="nombreCtaOrigen">'+x+"</p>";o+='<p class="product-cardnumber">'+l+"</p>";o+='<p class="product-metadata">'+z+"</p>";o+='<nav class="product-stack">';o+='<ul class="stack">';o+='<li class="stack-item">';o+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';o+="</li>";o+="</ul>";o+="</nav>";o+="</div>";o+='<div class="product-scheme">';o+='<ul class="product-balance-group" style="margin: 10px 0">';o+='<li>Disponible <span class="product-balance" id="balance-available">'+moneda+" 0,00</span></li>";o+='<li>A debitar  <span class="product-balance debitar" id="balance-debit">'+moneda+" 0,00</span></li>";o+="</ul>";o+="<ul class='field-group'>";o+="<li class='field-group-item'>";o+="<label for='dayExp'>Fecha de Vencimiento</label>";o+="<select id='MonthExp' name='MonthExp'>";o+="<option value=''>Mes</option>";o+="<option value='01'>01</option>";o+="<option value='02'>02</option>";o+="<option value='03'>03</option>";o+="<option value='04'>04</option>";o+="<option value='05'>05</option>";o+="<option value='06'>06</option>";o+="<option value='07'>07</option>";o+="<option value='08'>08</option>";o+="<option value='09'>09</option>";o+="<option value='10'>10</option>";o+="<option value='11'>11</option>";o+="<option value='12'>12</option>";o+="</select>";o+="<select id='yearExp' name='yearExp'>";o+="<option value=''>Año</option>";o+="</select>";o+="</li>";o+="</div>";$("#donor").append(o);$.each(v,function(C,E){var D=E.toString().substring(2,4);var F="<option value='"+D+"'>"+E+"</option>";$("#yearExp").append(F)});$.post(base_url+"/dashboard/saldo",{tarjeta:$(this).attr("card")},function(D){var C=D.disponible;if(typeof C!="string"){C="---"}$("#balance-available").attr("saldo",C);$("#balance-available").html(moneda+C)});$(".product-button").removeClass("disabled-button");$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$.each($(".dashboard-item"),function(D,C){if($(this).hasClass("current-dashboard-item")){$(this).removeClass("current-dashboard-item")}});$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");$(".stack-item").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(C,D){$(".ui-dialog-titlebar-close",D.dialog).hide()}})});$.post(base_url+"/transferencia/ctaDestino",{nroTarjeta:$(this).attr("card"),prefijo:$(this).attr("prefix"),operacion:"P2T"},function(C){if(C.rc==-150){$("#content_bank").children().remove();$("#tabs-menu").children().remove();$("#content_bank").append($("#content-no-afil").html());$("#content-no-afil").children().remove()}if(C.rc==0){montoMaxOperaciones=C.parametrosTransferencias[0].montoMaxOperaciones;montoMinOperaciones=C.parametrosTransferencias[0].montoMinOperaciones;montoMaxDiario=C.parametrosTransferencias[0].montoMaxDiario;montoMaxSemanal=C.parametrosTransferencias[0].montoMaxSemanal;montoMaxMensual=C.parametrosTransferencias[0].montoMaxMensual;cantidadOperacionesDiarias=C.parametrosTransferencias[0].cantidadOperacionesDiarias;cantidadOperacionesSemanales=C.parametrosTransferencias[0].cantidadOperacionesSemanales;cantidadOperacionesMensual=C.parametrosTransferencias[0].cantidadOperacionesMensual;montoAcumDiario=C.parametrosTransferencias[0].montoAcumDiario;montoAcumSemanal=C.parametrosTransferencias[0].montoAcumSemanal;montoAcumMensual=C.parametrosTransferencias[0].montoAcumMensual;acumCantidadOperacionesDiarias=C.parametrosTransferencias[0].acumCantidadOperacionesDiarias;acumCantidadOperacionesSemanales=C.parametrosTransferencias[0].acumCantidadOperacionesSemanales;acumCantidadOperacionesMensual=C.parametrosTransferencias[0].acumCantidadOperacionesMensual;montoComision=C.parametrosTransferencias[0].montoComision;dobleAutenticacion=C.parametrosTransferencias[0].dobleAutenticacion;$("#dashboard-beneficiary").empty();$.each(C.cuentaDestinoTercero,function(H,G){var E=Math.floor(Math.random()*5)+1;var F="bank-"+E;var D;D=" <li class='dashboard-item muestraDestino' id='datos_ctaD' card='"+G.noCuenta+"' comision='"+montoComision+"' marca='"+G.marca+"' nombre='"+G.beneficiario+"' mascara='"+G.noCuentaConMascara+"' empresa='"+G.nomEmp+"' id_afiliacion='"+G.id_afiliacion+"' producto='"+G.banco.replace(" ","-")+"'>";D+="<a rel='section'>";D+="<img src='"+base_cdn+"/img/products/default/"+F+".png' width='200' height='130' alt='' />";D+="<div class='dashboard-item-info'>";D+="<p class='dashboard-item-cardholder'>"+G.beneficiario+"</p>";D+="<p class='dashboard-item-cardnumber'>"+G.noCuentaConMascara+"</p>";D+="<p class='dashboard-item-category'>"+G.banco+"</p>";D+="</div>";D+=" </a>";D+="</li>";$("#dashboard-beneficiary").append(D)})}if(C.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}$(".muestraDestino").click(function(){if($(this).hasClass("disabled-dashboard-item")==true){$("#content-destino").dialog("close")}else{var M,I,G,E,N,J,H,L,O,K;M=$(this).find("img").attr("src");I=$(this).attr("card");E=$(this).attr("mascara");G=$(this).attr("marca");N=$(this).attr("producto");J=$(this).attr("empresa");L=$(this).attr("nombre");O=$(this).attr("id_afiliacion");K=$(this).attr("producto");comision=$(this).attr("comision");moneda=$(".dashboard-item").attr("moneda");$(".edit").remove();var F=k();H='<div class="group"> ';H+='<div class="product-presentation">';H+='<img src="'+M+'" width="200" height="130" alt="" />';H+='<div class=""></div>';H+='<input class="tarjetaDestino" name="tarjetaDestino" type="hidden" value="'+I+'" />';H+='<input class="id_afiliacion" name="id_afil" type="hidden" value="'+O+'" />';H+='<input class="banco" name="banco" type="hidden" value="'+K+'" /> <input class="comision" name="comision" type="hidden" value="'+comision+'" /> <input class="marca" name="marca" type="hidden" value="'+G+'" />';H+="</div>";H+='<div class="product-info">';H+='<p class="product-cardholder">'+L+"</p>";H+='<p class="product-cardnumber">'+E+"</p>";H+='<p class="product-metadata">'+N+"</p>";H+='<nav class="product-stack">';H+='<ul class="stack">';H+='<li class="stack-item modifica">';H+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';H+="</li>";H+='<li class="stack-item elimina">';H+='<a rel="section" title="Remover"><span aria-hidden="true" class="icon-cancel"></span></a>';H+="</li>";H+="</ul>";H+="</nav>";H+="</div>";H+='<div class="product-scheme">';H+='<fieldset class="form-inline">';H+='<label for="beneficiary-1x-description" title="Descripción de la transferencia.">Concepto</label>';H+='<input class="field-large" id="beneficiary-'+F+'x-description" maxlength="60" name="beneficiary-1x-description" type="text" />';H+='<label for="beneficiary-1x-amount" title="Monto a transferir.">Importe</label>';H+='<div class="field-category" > '+moneda+"";H+='<input id="beneficiary-1x-coin" class="importe" name="beneficiary-1x-coin" type="hidden" value="'+moneda+'." />';H+="</div>";H+='<input class="field-small monto" id="beneficiary-'+F+'-amount" maxlength="12" name="beneficiary-1x-amount" type="text" />';H+="</fieldset></div></div>";$("#tdestino").append(H);$("#beneficiary-1x").removeClass("obscure-group");$("#content-destino").dialog("close");$("#tdestino").children("#btn-destino").remove();$("#tdestino").append($("#removerDestino").html());g();var D=$(".monto").val().replace(",",".");$("#content_bank").on("keyup",".monto",function(){var P=$(this).val();if((pais=="Pe")||(pais=="Usd")){expr=/^-?[0-9]+([\.][0-9]{0,2})?$/;saldo_imp=$("#balance-available").attr("saldo").replace(",","")}if((pais=="Ve")||(pais=="Co")){expr=/^-?[0-9]+([\,][0-9]{0,2})?$/;saldo_imp1=$("#balance-available").attr("saldo").replace(".","");saldo_imp=saldo_imp1.replace(",",".")}if(!expr.test(P)){if((pais=="Pe")||(pais=="Usd")){$("#dialog-error-monto").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_invalido").click(function(){$("#dialog-error-monto").dialog("close")})}if((pais=="Ve")||(pais=="Co")){$("#dialog-error-monto-vc").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_invalido_vc").click(function(){$("#dialog-error-monto-vc").dialog("close")})}$(this).val("")}D=$(this).val().replace(",",".");if((parseFloat(D))>saldo_imp){$("#dialog-max-monto1").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_inv").click(function(){$("#dialog-max-monto1").dialog("close")});$(this).val("")}if((parseFloat(D))>parseFloat(montoMaxOperaciones)){$("#dialog-max-monto").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_invalido1").click(function(){$("#dialog-max-monto").dialog("close")});$(this).val("")}if((parseFloat(D)+parseFloat(montoAcumMensual))>parseFloat(montoMaxMensual)){$("#dialog-min-monto2").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_invalido3").click(function(){$("#dialog-min-monto2").dialog("close")});$(this).val("");$("#balance-debit").html(m+d().toFixed(2))}else{if((parseFloat($(this).val())+parseFloat(montoAcumDiario))>parseFloat(montoMaxDiario)){$("#dialog-min-monto3").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(Q,R){$(".ui-dialog-titlebar-close",R.dialog).hide()}});$("#monto_invalido4").click(function(){$("#dialog-min-monto3").dialog("close")});$(this).val("");$("#balance-debit").html(m+d().toFixed(2))}else{m=$(".dashboard-item").attr("moneda");$(this).parents(".group").attr("montInput",$(this).val());$(this).val().replace(",",".");$("#balance-debit").html(m+d().toFixed(2))}}});if(k()>=4){$("#tdestino").children("#btn-destino").remove()}if(k()>=1){$("#continuar").removeAttr("disabled")}else{$("#continuar").attr("disabled","")}c()}});b()});$("#content_bank").on("click",".modifica",function(){$(this).parents(".group").addClass("edit");$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",beforeClose:function(C,D){$(".group").removeClass("edit")},open:function(C,D){$(".ui-dialog-titlebar-close",D.dialog).hide()}})});$("#content_bank").on("click",".elimina",function(){m=$(".dashboard-item").attr("moneda");suma=d();montoRestar=parseFloat($(this).parents(".group").attr("montInput"));saldo=suma-montoRestar;if((saldo<0)||isNaN(saldo)){$("#balance-debit").html(m+0)}else{$("#balance-debit").html(m+saldo)}$(this).parents(".group").remove();g();if($("#tdestino").find("#btn-destino").length==0){$("#tdestino").append($("#removerDestino").html());c()}if(k()>1){$("#continuar").removeAttr("disabled")}else{$("#continuar").attr("disabled","")}});c()});$("#continuar").click(function(){var q=true;var p=[];var t=false;var v=0;setTimeout(function(){$("#msg").fadeOut()},5000);$("#montoTotal").remove();$("#tdestino").append("<input id='montoTotal' name='montoTotal' type='hidden' class='checkTotal' value='' />");$("#montoTotal").val(d());total=d();saldo=saldo_imp;valor_concepto1=$("#beneficiary-1x-description").val();valor_concepto2=$("#beneficiary-2x-description").val();valor_concepto3=$("#beneficiary-3x-description").val();valor_monto1=$("#beneficiary-1-amount").val();valor_monto2=$("#beneficiary-2-amount").val();valor_monto3=$("#beneficiary-3-amount").val();if($("#MonthExp").val()===""){p.push("Seleccione el mes de vencimiento");q=false}if($("yearExp").val()===""){p.push("Seleccione el año de vencimiento.");q=false}if((valor_concepto1=="")||(valor_concepto2=="")||(valor_concepto3=="")){p.push("El campo concepto no debe estar vacío.");q=false}if((valor_monto1==="")||(valor_monto2==="")||(valor_monto3==="")){p.push("El campo importe no debe estar vacío.");t=true}else{t=false}if((parseFloat(total)+parseFloat(montoComision))>saldo){p.push("El monto total excede su saldo disponible.");q=false}if(parseFloat(acumCantidadOperacionesDiarias)+parseFloat(v)>=parseFloat(cantidadOperacionesDiarias)){p.push("Usted excede el límite diario permitido.");q=false}else{if(parseFloat(acumCantidadOperacionesSemanales)+parseFloat(v)>=parseFloat(cantidadOperacionesSemanales)){p.push("Usted excede el límite semanal permitido.");q=false}else{if(parseFloat(acumCantidadOperacionesMensual)+parseFloat(v)>parseFloat(cantidadOperacionesMensual)){p.push("Usted excede el límite mensual permitido.");q=false}}}if((parseFloat(total)+parseFloat(montoComision)+parseFloat(montoComision))>parseFloat(montoMaxOperaciones)){p.push("El monto a total a debitar supera el monto máximo de operaciones.");q=false}if(parseFloat(total)<=0&&t==false){p.push("El monto total a debitar es menor al monto mínimo de operaciones.");q=false}if((parseFloat(total)+parseFloat(montoAcumDiario))>parseFloat(montoMaxDiario)){p.push("El monto total a debitar es mayor al monto maximo diario permitido.");q=false}else{if((parseFloat(total)+parseFloat(montoAcumSemanal))>parseFloat(montoMaxSemanal)){p.push("El monto total a debitar es mayor al monto maximo diario permitido.");q=false}else{if((parseFloat(total)+parseFloat(montoAcumMensual))>parseFloat(montoMaxMensual)){p.push("El monto total a debitar es mayor al monto maximo mensual permitido.");q=false}}}var s=parseFloat(valor_monto1)+parseFloat(valor_monto2)+parseFloat(valor_monto3);if(q===false){$("#inputValid").dialog({title:"Transferencia de tarjetas",modal:"true",width:"440px",open:function(x,y){$(".ui-dialog-titlebar-close",y.dialog).hide();$.each(p,function(z,A){$("#contentValid").append("<p>"+A+"</p>")})}});$("#closeValid").on("click",function(){$(this).off("click");p=[];$("#contentValid").children().not("span").remove();$("#inputValid").dialog("close")})}else{if(q==true){var n,w,o;w=$("#donor").find(".product-cardholder").html();o=$("#donor").find(".product-cardnumber").html();numeroCtaOrigen=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen");nombreCtaOrigen=$("#donor").find("#nombreCtaOrigen").html();banco=$("#donor").find(".banco").html();marca=$("#donor").find(".product-metadata").html();comision=$("#tdestino").find(".comision").val();n="<tr>";n+='<td class="data-label"><label>Cuenta Origen</label></td>';n+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" numeroCtaOrigen="'+numeroCtaOrigen+'" nombreCtaOrigen="'+nombreCtaOrigen+'">'+w+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+o+'</span><br /><span class="lighten"> '+marca+" </span></td>";n+="</tr>";$("#cargarConfirmacion").append(n);var u;u='<td class="data-label"><label>Cuentas Destino</label></td>';$("#cargarConfirmacion").append(u);var r=0;$.each($("#tdestino").children(":not(.obscure-group, .checkTotal)"),function(E,A){var y,C,B,x,D;r=r+1;C=$(A).find(".product-cardholder").html();B=$(A).find(".product-cardnumber").html();montodef=$(A).find("#beneficiary-"+r+"-amount").val();D=$(A).find("#beneficiary-"+r+"x-description").val();ctnDestino=$(A).find(".tarjetaDestino").val();banco=$(A).find(".banco").val();id_afil=$(A).find(".id_afiliacion").val();moneda=$(".dashboard-item").attr("moneda");v=v+1;suma=d();montoT=suma;if((pais=="Ve")||(pais=="Co")){var z=$(".product-scheme").find(".debitar").html().replace(/Bs./g,"");total1=z.replace(".",",")}else{var z=$(".product-scheme").find(".debitar").html().replace(/S./g,"");total1=z}monto_t=total1.replace(",",".");y='<tr class="trdestino" card="'+ctnDestino+'" id_afil="'+id_afil+'" monto='+montodef+' concepto="'+D+'" banco="'+banco+'" comision="'+comision+'">';y+='<td class="data-label"> </td>';y+='<td class="data-reference" id="nombreDestinoTransfer">'+C+'<br /><span class="highlight" id="mascaraDestinoTransfer">'+B+'</span><br /><span class="lighten" id="bancoDestinoTransfer">'+banco+"</span></td>";y+='<td class="data-metadata data-resultado">';y+='<div class="data-indicator">';y+='<span aria-hidden="true" class="iconoTransferencia"></span>';y+='</div><span class="data-metadata" id="conceptoDestino"><strong>Concepto: </strong>'+D+'<br /><strong>Monto: </strong><span class="money-amount" monto='+monto_t+' id="montoDestinoTransfer"> '+montodef+'</span><br /><strong>Estatus: </strong><span class="money-amount" id="estatus">En espera por confirmación.</span></td>';y+="</td>";y+="</tr>";y+="<tr>";y+='<td class="data-spacing" colspan="3"></td>';y+="</tr>";$("#cargarConfirmacion").append(y)});comision=parseFloat(comision)*v;montoT=suma+comision;montoT=montoT.toString();montoT=montoT.replace(".",",");$("#content_bank").children().remove();$("#content_bank").append($("#contentConfirmacion").html());$("#contentConfirmacion").remove();montoMasComision=montoT;var l;l="<tr>";l+='<td class="data-spacing" colspan="3"></td>';l+="</tr>";l+="<tr>";l+='<td colspan="2"></td>';l+='<td class="data-metadata">Total+Comisión ('+moneda+" "+comision+')<br /><span class="money-amount" id="montocom">'+moneda+" "+montoT+"</span></td>";l+="</tr>";$("#cargarConfirmacion").append(l).html()}}});$("#content_bank").on("click","#confirmacion_t",function(){var o;$("#confirmacion_t").prop("disabled",true);if(dobleAutenticacion=="S"){if(j()){$("#dialog-confirm").dialog({modal:true,title:"Verificación requerida.",buttons:{Cancelar:function(){$(this).dialog("close")},Aceptar:function(){var v=$("#transpwd_confirmacion").val();if(h(v)){$("#dialog-confirm").dialog("close");var y=$("#nombreOrigenTransfer").attr("numeroCtaOrigen");var z=$("#nombreOrigenTransfer").attr("nombreCtaOrigen");var B,u,w,x,A;$(".data-indicator").show();$.each($(".trdestino"),function(I,L){B=$(L).attr("card");u=$(L).attr("id_afil");w=$(L).attr("monto").replace(",",".");x=$(L).attr("concepto");comision=$(L).attr("comision");o=f(y,B,w,x,z,u);if(o.status!=false){A=true;a(A,L,o);var D,E;nombre=$("#nombreOrigenTransfer").html();mascara=$("#mascaraOrigenTransfer").html();var H=new Date();hora=(H.getHours())+":"+H.getMinutes()+":"+H.getSeconds();var J=H.getDate();var F=H.getMonth()+1;var G=H.getFullYear();if(J<10){J="0"+J}if(F<10){F="0"+F}var K=J+"/"+F+"/"+G;D="<tr>";D+='<td class="data-label"><label>Cuenta Origen</label></td>';D+='<td class="data-reference" colspan="2"><br>'+nombre+"</td>";D+="</tr>";$("#bodyConfirm").append(D);$("#progress").children().remove();cabecera="<ul class='steps'>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-exchange'></span> Transferir</li>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";cabecera+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";cabecera+="</ul>";$("#progress").append(cabecera).html();$("#titulo").children().remove();titulo="<h2>Finalización</h2>";$("#titulo").append(titulo).html();var C;C="<tr>";C+='<td colspan="2"></td>';C+='<td class="data-metadata">';C+='Total: <span class="lighten"> ('+moneda+" "+comision+' Comisión) </span> <br /><span class="money-amount"> '+moneda+" "+montoMasComision+" </span>";C+="</td>";C+="</tr>";$("#bodyConfirm").append(C).html();$("#confimacion_b").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_b").append(completar1).html();$("#transfer-success").show();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}else{A=false;trans="-";a(A,L,o);$("#confimacion_b").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_b").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}})}},},open:function(u,v){$(".ui-dialog-titlebar-close",v.dialog).hide()}})}}else{var q=$("#nombreOrigenTransfer").attr("numeroCtaOrigen");var r=$("#nombreOrigenTransfer").attr("nombreCtaOrigen");var t,l,n,p,s;$(".data-indicator").show();$.each($(".trdestino"),function(z,C){t=$(C).attr("card");l=$(C).attr("id_afil");n=$(C).attr("monto").replace(",",".");p=$(C).attr("concepto");comision=$(C).attr("comision");o=f(q,t,n,p,r,l);if(o.status!=false){s=true;a(s,C,o);var u,v;nombre=$("#nombreOrigenTransfer").html();mascara=$("#mascaraOrigenTransfer").html();var y=new Date();hora=(y.getHours())+":"+y.getMinutes()+":"+y.getSeconds();var A=y.getDate();var w=y.getMonth()+1;var x=y.getFullYear();if(A<10){A="0"+A}if(w<10){w="0"+w}var B=A+"/"+w+"/"+x;u="<tr>";u+='<td class="data-label"><label>Cuenta Origen</label></td>';u+='<td class="data-reference" colspan="2"><br>'+nombre+"</td>";u+="</tr>";$("#progress").children().remove();cabecera="<ul class='steps'>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-exchange'></span> Transferir</li>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";cabecera+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";cabecera+="</ul>";$("#progress").append(cabecera).html();$("#titulo").children().remove();titulo="<h2>Finalización</h2>";$("#titulo").append(titulo).html();$("#confimacion_b").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_b").append(completar1).html();$("#transfer-success").show();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}else{s=false;trans="-";a(s,C,o);$("#confimacion_b").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_b").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}})}});function k(){var l;$.each($("#tdestino").children(),function(o,n){l=o});return l+1}function c(){$(".dialogDestino").click(function(){$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",open:function(l,n){$(".ui-dialog-titlebar-close",n.dialog).hide()}});$("#close").click(function(){$("#content-destino").dialog("close")})})}function g(){$.each($("#dashboard-beneficiary").children(".dashboard-item"),function(n,l){$(l).removeClass("disabled-dashboard-item");$.each($("#tdestino").children(":not(.obscure-group)"),function(p,o){if($(o).find(".tarjetaDestino").val()==$(l).attr("card")){$(l).addClass("disabled-dashboard-item")}})})}function b(){$.each($("#dashboard-beneficiary").children(".dashboard-item"),function(n,l){if(montoMaxDiario==montoAcumDiario){$(l).addClass("disabled-dashboard-item");alert("Para esta operacion usted supera el monto maximo diario de transferencias")}else{if(montoMaxMensual==montoAcumMensual){$(l).addClass("disabled-dashboard-item");alert("Para esta operacion usted supera el monto maximo diario de transferencias")}}})}function d(){var n=0;var l;$.each($(".monto"),function(p,o){l=$(o).val().replace(",",".");n=n+parseFloat(l);n.toFixed(2)});if(isNaN(n)){n=0}return n}function i(l){var o;var n;$.ajaxSetup({async:false});$.post(base_url+"/transferencia/operaciones",{clave:hex_md5(l)},function(p){rpta=$.parseJSON(p.response);n=$.parseJSON(p.transferir);if(rpta.rc==0){o=true}else{o=false;n=false}if(rpta.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}});return n}function j(){$.ajaxSetup({async:false});var l;$.post(base_url+"/transferencia/crearClave",function(n){if(n.rc==0){l=true}else{l=false;$("#dialog-error-clave").dialog({modal:"true",width:"440px",open:function(o,p){$(".ui-dialog-titlebar-close",p.dialog).hide()}});$("#invalido2").click(function(){$("#dialog-error-clave").dialog("close");$(location).attr("href",base_url+"/transfer/index_bank")})}if(n.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}});return l}function h(l){$.ajaxSetup({async:false});var n;$.post(base_url+"/transferencia/confirmacion",{clave:hex_md5(l)},function(o){if(o.rc==0){n=true}else{n=false;$("#dialog-error-correo").dialog({title:"Contraseñas no coinciden",modal:"true",width:"440px",open:function(p,q){$(".ui-dialog-titlebar-close",q.dialog).hide()}});$("#invalido").click(function(){$("#dialog-error-correo").dialog("close")})}if(o.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}});return n}function f(n,l,p,o,t,s){var r;var u;$.ajaxSetup({async:false});var q={cuentaOrigen:n,cuentaDestino:l,monto:p,descripcion:o,tipoOpe:"P2T",idUsuario:t,id_afil_terceros:s};$.ajax({url:base_url+"/transferencia/procesar",data:q,type:"post",dataType:"json",success:function(v){if(v.rc==0){u=v.dataTransaccion.referencia;r=u;$("#confirmacion_t").prop("disabled",false)}else{r={status:false,rc:v.rc,msg:v.msg};$("#confirmacion_t").prop("disabled",false)}if(v.rc==-61){$(location).attr("href",base_url+"/users/error_gral");$("#confirmacion_t").prop("disabled",false)}}});$.ajaxSetup({async:true});return r}function a(q,l,p){if(q==true){$(l).find(".data-resultado").addClass("data-success");$(l).find(".iconoTransferencia").removeClass("data-indicator icon-refresh icon-spin");$(l).find(".iconoTransferencia").addClass("icon-ok-sign");$(l).find("#estatus").empty();$(l).find("#estatus").text("Transacción exitosa. Nro. de Referencia: "+p)}else{var o,n=p.msg;switch(p.rc){case -340:o="Cantidad de dígitos de la cuenta es invalida.";break;case -341:o="El número de cuenta no corresponde al banco.";break;case -342:o="Número de cuenta invalido.";break;case -343:o="Su tarjeta se encuentra bloqueada, código de bloqueo: "+n.substr(34,35);break;default:o="Transacción fallida."}$(l).find(".data-resultado").addClass("data-error");$(l).find(".iconoTransferencia").removeClass("data-indicator data-indicator icon-refresh icon-spin");$(l).find(".iconoTransferencia").addClass("icon-cancel-sign");$(l).find("#estatus").empty();$(l).find("#estatus").text(o)}}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(l,n){$(".ui-dialog-titlebar-close",n.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});