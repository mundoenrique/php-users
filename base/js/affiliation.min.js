var path,base_cdn;path=window.location.href.split("/");base_cdn=path[0]+"//"+path[2].replace("online","cdn")+"/"+path[3];base_url=path[0]+"//"+path[2]+"/"+path[3];$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(e,f){$(".ui-dialog-titlebar-close",f.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});var c=$("#dashboard-donor");c.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var b=$("#filters-stack .option-set"),d=b.find("a");d.click(function(){var i=$(this);if(i.hasClass("selected")){return false}var g=i.parents(".option-set");g.find(".selected").removeClass("selected");i.addClass("selected");var e={},f=g.attr("data-option-key"),h=i.attr("data-option-value");h=h==="false"?false:h;e[f]=h;if(f==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(i,e)}else{c.isotope(e)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$(".dashboard-item").click(function(){var i,f,c,b,j,g,d,h,e;i=$(this).find("img").attr("src");f=$(this).attr("card");c=$(this).attr("marca");b=$(this).attr("mascara");j=$(this).attr("producto1");g=$(this).attr("empresa");h=$(this).attr("nombre");e=$(this).attr("prefix");$("#donor").children().remove();d='<div class="product-presentation" producto="'+j+'">';d+='<img src="'+i+'" width="200" height="130" alt="" />';d+='<div class="product-network '+c.toLowerCase()+'"></div>';d+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+j+'"  prefix="'+e+'" cardOrigen="'+f+'" />';d+="</div>";d+='<div class="product-info">';d+='<p class="product-cardholder" id="nombreCtaOrigen">'+h+"</p>";d+='<p class="product-cardnumber" id="mascara">'+b+"</p>";d+='<p class="product-metadata" id="marca">'+j+"</p>";d+='<nav class="product-stack">';d+='<ul class="stack">';d+='<li class="stack-item">';d+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';d+="</li>";d+="</ul>";d+="</nav>";d+="</div>";$("#donor").append(d);$(".product-button").removeClass("disabled-button");$("#yearExp").attr("disabled",false);$("#MonthExp").attr("disabled",false);$("#card-number").attr("disabled",false);$("#card-holder").attr("disabled",false);$("#bank-account-holder-id").attr("disabled",false);$("#card-holder-email").attr("disabled",false);$("#afiliar").attr("disabled",false);$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");$(".stack-item").click(function(){$("#tdestino").children().remove();$("#tdestino").append($("#removerDestino").html());$("#botonContinuar").attr("disabled",true);$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(k,l){$(".ui-dialog-titlebar-close",l.dialog).hide()}})})});$("#afiliar").click(function(){a();$("#validate_afiliacion").submit();setTimeout(function(){$("#msg").fadeOut()},5000);var b=$("#validate_afiliacion");numeroCta=$("#content-holder").find(".nrocta").val();email=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email");if(b.valid()==true){$.post(base_url+"/affiliation/cuentasP2P",{noTarjeta:numeroCta},function(f){if(f.rc==0){beneficiario=f.beneficiario;cedula=f.id_ext_per;nombre=$("#donor").find(".product-cardholder").html();mascara=$("#donor").find(".product-cardnumber").html();numeroCtaOrigen=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen");prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix");nombreCtaOrigen=$("#donor").find("#nombreCtaOrigen").html();marca=$("#donor").find("#donor-cardnumber-origen").attr("producto");email=$("#content-holder").find("#card-holder-email").val();expDate=$("#MonthExp").val()+$("#yearExp").val();var e=new Date();hora=(e.getHours())+":"+e.getMinutes()+":"+e.getSeconds();var c=e.getDate();var g=e.getMonth()+1;var h=e.getFullYear();if(c<10){c="0"+c}if(g<10){g="0"+g}var d=c+"/"+g+"/"+h;datos_afiliacion="<tr>";datos_afiliacion+='<td class="data-label"><label>Cuenta Origen</label></td>';datos_afiliacion+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" numeroCtaOrigen="'+numeroCtaOrigen+'" nombreCtaOrigen="'+nombre+'" prefix="'+prefix+'" mascara="'+mascara+'" marca="'+marca+'">'+nombre+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+mascara+'</span><br /><span class="lighten"> '+marca+" </span></td>";datos_afiliacion+="</tr>";datos_afiliacion+="<tr>";datos_afiliacion+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>';datos_afiliacion+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+beneficiario+'" email="'+email+'" cedula="'+cedula+'" numeroCta="'+numeroCta+'">"'+beneficiario+'" <span class="lighten">("'+email+'")</span><br /> "'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span></td>';datos_afiliacion+="</tr><tr>";$("#cargarConfirmacion").append(datos_afiliacion);$("#content-holder").children().remove();$("#content-holder").append($("#content-confirmacion").html());$(".continuar").click(function(){$.post(base_url+"/affiliation/affiliation",{nroPlasticoOrigen:numeroCtaOrigen,beneficiario:beneficiario,nroCuentaDestino:numeroCta,tipoOperacion:"P2P",email:email,cedula:cedula,prefix:prefix,expDate:expDate},function(i){if(i.rc==0||i.rc==-188){datos_finalizacion="<tr>";datos_finalizacion+='<td class="data-label"><label>Fecha de Operación</label></td>';datos_finalizacion+='<td class="data-reference">'+d+" "+hora+" </td>";datos_finalizacion+="</tr>";datos_finalizacion+="<tr>";datos_finalizacion+='<td class="data-label"><label>Cuenta de Origen</label></td>';datos_finalizacion+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>';datos_finalizacion+="</tr>";datos_finalizacion+="<tr>";datos_finalizacion+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>';datos_finalizacion+='<td class="data-reference">"'+beneficiario+'"<span class="lighten">("'+email+'")</span><br />"'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span><br /></td>';datos_finalizacion+="</tr>";$("#cargarFinalizacion").append(datos_finalizacion);$("#content-holder").children().remove();if(i.rc==0){$("#content-holder").append($("#content-finalizar").html())}else{$("#content-holder").append($("#content-finalizar2").html());$("#cargarFinalizacion3").append(datos_finalizacion)}}else{if(i.rc==-178){$("#dialog-error-afil3").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(j,k){$(".ui-dialog-titlebar-close",k.dialog).hide()}});$("#invalido5").click(function(){$("#dialog-error-afil3").dialog("close");$(location).attr("href",base_url+"/affiliation")})}else{if(i.rc==-210){$("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(j,k){$(".ui-dialog-titlebar-close",k.dialog).hide()}});$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close");$(location).attr("href",base_url+"/affiliation")})}else{datos_finalizacion="<tr>";datos_finalizacion+='<td class="data-label"><label>Fecha de Operación</label></td>';datos_finalizacion+='<td class="data-reference">'+d+" "+hora+" </td>";datos_finalizacion+="</tr>";datos_finalizacion+="<tr>";datos_finalizacion+='<td class="data-label"><label>Cuenta de Origen</label></td>';datos_finalizacion+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br/> <span class="lighten"> "'+marca+'" </span> </td>';datos_finalizacion+="</tr>";datos_finalizacion+="<tr>";datos_finalizacion+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>';datos_finalizacion+='<td class="data-reference">"'+beneficiario+'"<span class="lighten">("'+email+'")</span><br />Documento de Identidad "'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span><br /></td>';datos_finalizacion+="</tr>";$("#cargarFinalizacion2").append(datos_finalizacion);$("#content-holder").children().remove();$("#content-holder").append($("#content-finalizar3").html())}}}})})}else{if(f.rc==-221){$("#dialog-error-afil1").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(i,j){$(".ui-dialog-titlebar-close",j.dialog).hide()}});$("#invalido3").click(function(){$("#dialog-error-afil1").dialog("close");$(location).attr("href",base_url+"/affiliation")})}else{$("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(i,j){$(".ui-dialog-titlebar-close",j.dialog).hide()}});$("#invalido4").click(function(){$("#dialog-error-afil2").dialog("close");$(location).attr("href",base_url+"/dashboard")})}}})}});function a(){jQuery.validator.setDefaults({debug:true,success:"valid"});$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:true,number:true,minlength:16},"card-holder-email":{required:true,email:true},MonthExp:{required:true},yearExp:{required:true}},messages:{"card-number":"El número de cuenta no puede estar vacío y debe contener 16 números","card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(b,c){$(".ui-dialog-titlebar-close",c.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});