var path,base_cdn;path=window.location.href.split("/");base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1"));base_url=path[0]+"//"+path[2]+"/"+path[3];var montoMaxOperaciones,montoMinOperaciones,dobleAutenticacion,claveValida,claveC,montoComision,moneda,montoMasComision,saldo_imp;$(function(){var e=$("#content").attr("confirmacion");if(e=="1"){$("#content-clave").hide();$("#content_tdc").show()}else{$("#content-clave").show()}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(p,q){$(".ui-dialog-titlebar-close",q.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});$.each($(".dashboard-item"),function(q,p){$.post(base_url+"/dashboard/saldo",{tarjeta:$(p).attr("card")},function(s){var r=s.disponible;if(typeof r!="string"){r="---"}$(p).find(".dashboard-item-balance").html(r)})});var n=$("#dashboard-donor");n.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var l=$("#filters-stack .option-set"),o=l.find("a");o.click(function(){var t=$(this);if(t.hasClass("selected")){return false}var r=t.parents(".option-set");r.find(".selected").removeClass("selected");t.addClass("selected");var p={},q=r.attr("data-option-key"),s=t.attr("data-option-value");s=s==="false"?false:s;p[q]=s;if(q==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(t,p)}else{n.isotope(p)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$("#continuar_transfer").click(function(){var l=$("#transpwd").val();if((i(l))){$("#content-clave").hide();$("#content_tdc").show()}else{$("#content_clave").show();$.balloon.defaults.classname="field-error";$.balloon.defaults.css=null;$("#transpwd").showBalloon({position:"right",contents:"Clave inválida"});setTimeout(function(){$("#transpwd").hideBalloon()},3000)}});$(".dashboard-item").click(function(){var x,r,n,l,y,s,o,w,v,t,A,z,q,p,u=[];t=new Date();A=t.getFullYear();z=A-5;q=A+5;for(p=z;p<=q;p++){u.push(p)}x=$(this).find("img").attr("src");r=$(this).attr("card");n=$(this).attr("marca");l=$(this).attr("mascara");y=$(this).attr("producto1");s=$(this).attr("empresa");w=$(this).attr("nombre");moneda=$(this).attr("moneda");pais=$(this).attr("pais");$("#donor").children().remove();o='<div class="product-presentation">';o+='<img src="'+x+'" width="200" height="130" alt="" />';o+='<div class="product-network '+n.toLowerCase()+'"></div>';o+='<input id="origin-cardnumber" name="donor-cardnumber" type="hidden" value="'+r+'" />';o+="</div>";o+='<div class="product-info">';o+='<p class="product-cardholder">'+w+"</p>";o+='<p class="product-cardnumber">'+l+"</p>";o+='<p class="product-metadata">'+y+"</p>";o+='<nav class="product-stack">';o+='<ul class="stack">';o+='<li class="stack-item">';o+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';o+="</li>";o+="</ul>";o+="</nav>";o+="</div>";o+='<div class="product-scheme">';o+='<ul class="product-balance-group" style="margin: 10px 0">';o+='<li>Disponible <span class="product-balance" id="balance-available" > '+moneda+" 0,00</span></li>";o+='<li>A debitar <span class="product-balance" id="balance-debit"> '+moneda+" 0,00</span></li>";o+="</ul>";o+="<ul class='field-group'>";o+="<li class='field-group-item'>";o+="<label for='dayExp'>Fecha de Vencimiento</label>";o+="<select id='MonthExp' name='MonthExp'>";o+="<option value=''>Mes</option>";o+="<option value='01'>01</option>";o+="<option value='02'>02</option>";o+="<option value='03'>03</option>";o+="<option value='04'>04</option>";o+="<option value='05'>05</option>";o+="<option value='06'>06</option>";o+="<option value='07'>07</option>";o+="<option value='08'>08</option>";o+="<option value='09'>09</option>";o+="<option value='10'>10</option>";o+="<option value='11'>11</option>";o+="<option value='12'>12</option>";o+="</select>";o+="<select id='yearExp' name='yearExp'>";o+="<option value=''>Año</option>";o+="</select>";o+="</li>";o+="</div>";$("#donor").append(o);$.each(u,function(B,D){var C=D.toString().substring(2,4);var E="<option value='"+C+"'>"+D+"</option>";$("#yearExp").append(E)});$.post(base_url+"/dashboard/saldo",{tarjeta:$(this).attr("card")},function(C){var B=C.disponible;if(typeof B!="string"){B="---"}$("#balance-available").attr("saldo",B);$("#balance-available").html(moneda+B)});$(".product-button").removeClass("disabled-button");$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$.each($(".dashboard-item"),function(C,B){if($(this).hasClass("current-dashboard-item")){$(this).removeClass("current-dashboard-item")}});$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");$(".stack-item:not(.modifica)").click(function(){$("#tdestino").children(":not(#btn-destino)").remove();$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(B,C){$(".ui-dialog-titlebar-close",C.dialog).hide()}})});$.post(base_url+"/transferencia/ctaDestino",{nroTarjeta:$(this).attr("card"),prefijo:$(this).attr("prefix"),operacion:"P2C"},function(C){if(C.rc==-150){$("#content_tdc").children().remove();$("#tabs-menu").children().remove();$("#content_tdc").append($("#content-no-afil").html());$("#content-no-afil").children().remove()}else{montoMaxOperaciones=C.parametrosTransferencias[0].montoMaxOperaciones;montoMinOperaciones=C.parametrosTransferencias[0].montoMinOperaciones;montoMaxDiario=C.parametrosTransferencias[0].montoMaxDiario;montoMaxSemanal=C.parametrosTransferencias[0].montoMaxSemanal;montoMaxMensual=C.parametrosTransferencias[0].montoMaxMensual;cantidadOperacionesDiarias=C.parametrosTransferencias[0].cantidadOperacionesDiarias;cantidadOperacionesSemanales=C.parametrosTransferencias[0].cantidadOperacionesSemanales;cantidadOperacionesMensual=C.parametrosTransferencias[0].cantidadOperacionesMensual;montoAcumDiario=C.parametrosTransferencias[0].montoAcumDiario;montoAcumSemanal=C.parametrosTransferencias[0].montoAcumSemanal;montoAcumMensual=C.parametrosTransferencias[0].montoAcumMensual;acumCantidadOperacionesDiarias=C.parametrosTransferencias[0].acumCantidadOperacionesDiarias;acumCantidadOperacionesSemanales=C.parametrosTransferencias[0].acumCantidadOperacionesSemanales;acumCantidadOperacionesMensual=C.parametrosTransferencias[0].acumCantidadOperacionesMensual;dobleAutenticacion=C.parametrosTransferencias[0].dobleAutenticacion;montoComision=C.parametrosTransferencias[0].montoComision;$("#dashboard-beneficiary").empty();var B;$.each(C.tarjetaDestinoTercero,function(H,G){var E=Math.floor(Math.random()*5)+1;var F="card-"+E;var D;D="<li class='dashboard-item muestraDestino' card='"+G.noCuenta+"' marca='"+G.marca+"' nombre='"+G.beneficiario+"' comision='"+montoComision+"' mascara='"+G.noCuentaConMascara+"' banco ='"+G.banco+"' id_afiliacion='"+G.id_afiliacion+"'>";D+="<a rel='section'>";D+="<img src='"+base_cdn+"/img/products/default/"+F+".png' width='200' height='130' alt='' />";D+="<div class=''></div>";D+="<div class='dashboard-item-info'>";D+="<p class='dashboard-item-cardholder'>"+G.beneficiario+"</p>";D+="<p class='dashboard-item-cardnumber'>"+G.noCuentaConMascara+"</p>";D+="<p class='dashboard-item-category'>"+G.banco+"</p>";D+="</div>";D+=" </a>";D+="</li>";$("#dashboard-beneficiary").append(D)})}$(".muestraDestino").click(function(){if($(this).hasClass("disabled-dashboard-item")==true){$("#content-destino").dialog("close")}else{var L,I,G,E,M,J,H,K;L=$(this).find("img").attr("src");I=$(this).attr("card");E=$(this).attr("mascara");G=$(this).attr("marca");M=$(this).attr("banco");K=$(this).attr("nombre");id_afil=$(this).attr("id_afiliacion");banco=$(this).attr("banco");comision=$(this).attr("comision");$(".edit").remove();var F=k();H='<div class="group"> ';H+='<div class="product-presentation">';H+='<img src="'+L+'" width="200" height="130" alt="" />';H+='<div class=""></div>';H+='<input id="tarjetaDestino" class="tarjetaDestino" id="donor-cardnumber" name="donor-cardnumber" type="hidden" value="'+I+'" />';H+='<input class="id_afiliacion" name="id_afil" type="hidden" value="'+id_afil+'" />';H+='<input class="banco" name="id_afil" type="hidden" value="'+banco+'" /> <input class="comision" name="comision" type="hidden" value="'+comision+'" />';H+="</div>";H+='<div class="product-info">';H+='<p class="product-cardholder">'+K+"</p>";H+='<p class="product-cardnumber">'+E+"</p>";H+='<p class="product-metadata">'+M+"</p>";H+='<nav class="product-stack">';H+='<ul class="stack">';H+='<li class="stack-item modifica">';H+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';H+="</li>";H+='<li class="stack-item elimina">';H+='<a rel="section" title="Remover"><span aria-hidden="true" class="icon-cancel"></span></a>';H+="</li>";H+="</ul>";H+="</nav>";H+="</div>";H+='<div class="product-scheme">';H+='<fieldset class="form-inline">';H+='<label for="beneficiary-1x-description" title="Descripción del pago.">Concepto</label>';H+='<input class="field-large" id="beneficiary-'+F+'x-description" maxlength="60" name="beneficiary-'+F+'x-description" type="text"/>';H+='<label for="beneficiary-1x-amount" title="Monto a transferir.">Importe</label>';H+='<div class="field-category"> '+moneda+" ";H+='<input id="beneficiary-1x-coin" name="beneficiary-1x-coin" type="hidden" value="'+moneda+'" />';H+="</div>";H+='<input class="field-small monto dinero" id="beneficiary-'+F+'x-amount" maxlength="12"  name="beneficiary-'+F+'x-amount" type="text" />';H+="</fieldset></div></div>";$("#content_tdc #tdestino").append(H);$("#beneficiary-1x").removeClass("obscure-group");$("#content-destino").dialog("close");$("#tdestino").children("#btn-destino").remove();$("#tdestino").append($("#removerDestino").html());g();var D=$(".monto").val().replace(",",".");$("#content_tdc").on("keyup",".monto",function(){var N=$(this).val();if((pais=="Pe")||(pais=="Usd")){expr=/^-?[0-9]+([\.][0-9]{0,2})?$/;saldo_imp=$("#balance-available").attr("saldo").replace(",","")}if((pais=="Ve")||(pais=="Co")){expr=/^-?[0-9]+([\,][0-9]{0,2})?$/;saldo_imp1=$("#balance-available").attr("saldo").replace(".","");saldo_imp=saldo_imp1.replace(",",".")}if(!expr.test(N)){if((pais=="Pe")||(pais=="Usd")){$("#dialog-error-monto").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_invalido").click(function(){$("#dialog-error-monto").dialog("close")})}if((pais=="Ve")||(pais=="Co")){$("#dialog-error-monto-vc").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_invalido_vc").click(function(){$("#dialog-error-monto-vc").dialog("close")})}$(this).val("")}D=$(this).val().replace(",",".");if((parseFloat(D))>saldo_imp){$("#dialog-max-monto1").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_inv").click(function(){$("#dialog-max-monto1").dialog("close")});$(this).val("")}if((parseFloat(D))>parseFloat(montoMaxOperaciones)){$("#dialog-max-monto").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_invalido1").click(function(){$("#dialog-max-monto").dialog("close")});$(this).val("")}if((parseFloat($(this).val())+parseFloat(montoAcumDiario))>parseFloat(montoMaxDiario)){$("#dialog-min-monto2").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_invalido3").click(function(){$("#dialog-min-monto2").dialog("close")});$(this).val("");$("#balance-debit").html(m+d().toFixed(2))}else{if((parseFloat(D)+parseFloat(montoAcumMensual))>parseFloat(montoMaxMensual)){$("#dialog-min-monto3").dialog({title:"Monto no permitido",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#monto_invalido4").click(function(){$("#dialog-min-monto3").dialog("close")});$(this).val("");$("#balance-debit").html(m+d().toFixed(2))}else{m=$(".dashboard-item").attr("moneda");$(this).parents(".group").attr("montInput",$(this).val());$(this).val().replace(",",".");$("#balance-debit").html(m+d().toFixed(2))}}});if(k()>=4){$("#tdestino").children("#btn-destino").remove()}if(k()>1){$("#continuar").removeAttr("disabled")}else{$("#continuar").attr("disabled","")}c()}});$("#content_tdc").on("click",".modifica",function(){$(this).parents(".group").addClass("edit");$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",beforeClose:function(D,E){$(".group").removeClass("edit")},open:function(D,E){$(".ui-dialog-titlebar-close",E.dialog).hide()}})});$("#content_tdc").on("click",".elimina",function(){m=$(".dashboard-item").attr("moneda");suma=d();montoRestar=parseFloat($(this).parents(".group").attr("montInput"));saldo=suma-montoRestar;if(saldo<0){$("#balance-debit").html(m+0)}else{$("#balance-debit").html(m+saldo)}$(this).parents(".group").remove();g();if($("#tdestino").find("#btn-destino").length==0){$("#tdestino").append($("#removerDestino").html())}if(k()>=1){$("#continuar").removeAttr("disabled")}else{$("#continuar").attr("disabled","")}});b()});c()});$("#continuar").click(function(){var s=true;var y=0;var l=[];var q=false;$("#montoTotal").remove();$("#tdestino").append("<input id='montoTotal' name='montoTotal' type='hidden' class='checkTotal' value='' />");$("#montoTotal").val(d());$("#validate").submit();total=d();saldo=saldo_imp;valor_concepto1=$("#beneficiary-1x-description").val();valor_concepto2=$("#beneficiary-2x-description").val();valor_concepto3=$("#beneficiary-3x-description").val();valor_monto1=$("#beneficiary-1x-amount").val();valor_monto2=$("#beneficiary-2x-amount").val();valor_monto3=$("#beneficiary-3x-amount").val();if($("#MonthExp").val()===""){l.push("Seleccione el mes de vencimiento");s=false}if($("yearExp").val()===""){l.push("Seleccione el año de vencimiento.");s=false}if((valor_concepto1=="")||(valor_concepto2=="")||(valor_concepto3=="")){l.push("El campo concepto no debe estar vacío.");s=false}if((valor_monto1==="")||(valor_monto2==="")||(valor_monto3==="")){l.push("El campo importe no debe estar vacío.");q=true}else{q=false}if((parseFloat(total)+parseFloat(montoComision))>saldo){l.push("El monto total excede su saldo disponible.");s=false}if(parseFloat(acumCantidadOperacionesDiarias)+parseFloat(y)>=parseFloat(cantidadOperacionesDiarias)){l.push("Usted excede el límite diario permitido.");s=false}else{if(parseFloat(acumCantidadOperacionesSemanales)+parseFloat(y)>=parseFloat(cantidadOperacionesSemanales)){l.push("Usted excede el límite semanal permitido.");s=false}else{if(parseFloat(acumCantidadOperacionesMensual)+parseFloat(y)>parseFloat(cantidadOperacionesMensual)){l.push("Usted excede el límite mensual permitido.");s=false}}}if((parseFloat(total)+parseFloat(montoComision)+parseFloat(montoComision))>parseFloat(montoMaxOperaciones)){l.push("El monto a total a debitar supera el monto máximo de operaciones.");s=false}if(parseFloat(total)<=0){l.push("El monto total a debitar es menor al monto mínimo de operaciones.");s=false}if((parseFloat(total)+parseFloat(montoAcumDiario))>parseFloat(montoMaxDiario)){l.push("El monto total a debitar es mayor al monto maximo diario permitido.");s=false}else{if((parseFloat(total)+parseFloat(montoAcumSemanal))>parseFloat(montoMaxSemanal)){l.push("El monto total a debitar es mayor al monto maximo mensual permitido.");s=false}else{if((parseFloat(total)+parseFloat(montoAcumMensual))>parseFloat(montoMaxMensual)){l.push("El monto total a debitar es mayor al monto maximo mensual permitido.");s=false}}}var u=parseFloat(valor_monto1)+parseFloat(valor_monto2)+parseFloat(valor_monto3);if(s===false){$("#inputValid").dialog({title:"Transferencia de tarjetas",modal:"true",width:"440px",open:function(C,D){$(".ui-dialog-titlebar-close",D.dialog).hide();$.each(l,function(E,F){$("#contentValid").append("<p>"+F+"</p>")})}});$("#closeValid").on("click",function(){$(this).off("click");l=[];$("#contentValid").children().not("span").remove();$("#inputValid").dialog("close")})}else{if(s==true){var n,B,p,A,x,w,t,B,p,o,r,A,v,z;B=$("#donor").find(".product-cardholder").html();p=$("#donor").find(".product-cardnumber").html();A=$("#donor").find(".product-metadata").html();v=$("#origin-cardnumber").val();z=$("#content").attr("idUsuario");comision=$("#tdestino").find(".comision").val();n='<tr id="trorigen" card="'+v+'" idUsuario="'+z+'">';n+='<td class="data-label"><label>Cuenta Origen</label></td>';n+='<td class="data-reference" colspan="2" id="nombreOrigenTransfer">'+B+'<br /><span class="highlight">'+p+'</span><br /><span class="lighten">'+A+"</span></td>";n+="</tr>";$("#tbody").append(n);x='<td class="data-label"><label>Cuentas Destino</label></td>';$("#tbody").append(x);var y=0;$.each($("#tdestino").children(":not(.obscure-group, .checkTotal)"),function(E,D){B=$(D).find(".product-cardholder").html();p=$(D).find(".product-cardnumber").html();A=$(D).find(".product-metadata").html();o=$("#beneficiary-"+(E+1)+"x-amount").val();r=$("#beneficiary-"+(E+1)+"x-description").val();ctnDestino=$(D).find(".tarjetaDestino").val();id_afil=$(D).find(".id_afiliacion").val();banco=$(D).find(".banco").val();y=y+1;suma=d();montoT=suma;if((pais=="Ve")||(pais=="Co")){var C=$(".product-scheme").find("#balance-debit").html().replace(/Bs./g,"");total1=C.replace(".",",")}else{var C=$(".product-scheme").find("#balance-debit").html().replace(/S./g,"");total1=C}monto_t=total1.replace(",",".");destino='<tr class="trdestino" card="'+ctnDestino+'" id_afil="'+id_afil+'" monto="'+o+'" concepto="'+r+'" banco="'+banco+'" comision="'+comision+'">';destino+='<td class="data-label"> </td>';destino+='<td class="data-reference" id="nombreDestinoTransfer">'+B+'<br /><span class="highlight" id="mascaraDestinoTransfer">'+p+'</span><br /><span class="lighten" id="bancoDestinoTransfer">'+banco+"</span></td>";destino+='<td class="data-metadata data-resultado">';destino+='<div class="data-indicator">';destino+='<span aria-hidden="true" class="iconoTransferencia"></span>';destino+='</div><span class="data-metadata" id="conceptoDestino"><strong>Concepto: </strong>'+r+'<br /><strong>monto: </strong><span class="money-amount" monto="'+o+'" id="montoDestinoTransfer">'+moneda+" "+o+'</span><br /><strong>Estatus: </strong><span class="money-amount" id="estatus">En espera por confirmación.</span></td>';destino+="</td>";destino+="</tr>";destino+="<tr>";destino+='<td class="data-spacing" colspan="3"></td>';destino+="</tr>";$("#tbody").append(destino)});comision=parseFloat(comision)*y;montoT=suma+comision;montoT=montoT.toString();montoT=montoT.replace(".",",");montoMasComision=montoT;completar="<tr>";completar+='<td class="data-spacing" colspan="3"></td>';completar+="</tr>";completar+="<tr>";completar+='<td colspan="2"></td>';completar+='<td class="data-metadata">Total+Comisión ('+moneda+" "+comision+')<br /><span class="money-amount">'+moneda+" "+montoT+"</span></td>";completar+="</tr>";$("#tbody").append(completar);$("#content-transfer-P2C").children().remove();$("#content-transfer-P2C").append($("#confirm-transfer").html());$("#confirm-transfer").remove()}}});$("#content_tdc").on("click","#continue_trans",function(){$("#continue_trans").prop("disabled",true);if(dobleAutenticacion=="S"){if(j()){$("#dialog-confirm").dialog({modal:true,title:"Verificación requerida.",buttons:{Cancelar:function(){$(this).dialog("close")},Aceptar:function(){var u=$("#transpwd_confirmacion").val();if(h(u)){$("#dialog-confirm").dialog("close");var x=$("#trorigen").attr("card");var y=$("#trorigen").attr("idUsuario");var A,t,v,w,z;$(".data-indicator").show();$.each($(".trdestino"),function(H,K){A=$(K).attr("card");t=$(K).attr("id_afil");v=$(K).attr("monto").replace(",",".");w=$(K).attr("concepto");comision=$(K).attr("comision");transferencia=f(x,A,v,w,y,t);if(transferencia!=false){z=true;a(z,K,transferencia);var C,D;nombre=$("#nombreOrigenTransfer").html();mascara=$("#mascaraOrigenTransfer").html();var G=new Date();hora=(G.getHours())+":"+G.getMinutes()+":"+G.getSeconds();var I=G.getDate();var E=G.getMonth()+1;var F=G.getFullYear();if(I<10){I="0"+I}if(E<10){E="0"+E}var J=I+"/"+E+"/"+F;C="<tr>";C+='<td class="data-label"><label>Cuenta Origen</label></td>';C+='<td class="data-reference" colspan="2"><br>'+nombre+"</td>";C+="</tr>";$("#bodyConfirm").append(C);$("#progress").children().remove();cabecera="<ul class='steps'>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-exchange'></span> Transferir</li>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";cabecera+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";cabecera+="</ul>";$("#progress").append(cabecera).html();$("#titulo").children().remove();titulo="<h2>Finalización</h2>";$("#titulo").append(titulo).html();var B;B="<tr>";B+='<td colspan="2"></td>';B+='<td class="data-metadata">';B+='Total: <span class="lighten"> ('+moneda+" "+comision+' Comisión) </span> <br /><span class="money-amount"> '+moneda+" "+montoMasComision+" </span>";B+="</td>";B+="</tr>";$("#bodyConfirm").append(B).html();$("#confimacion_t").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_t").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}else{z=false;trans="-";a(z,K,transferencia);$("#confimacion_t").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_t").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}})}},},open:function(t,u){$(".ui-dialog-titlebar-close",u.dialog).hide()}})}}else{var p=$("#trorigen").attr("card");var q=$("#trorigen").attr("idUsuario");var s,l,n,o,r;$(".data-indicator").show();$.each($(".trdestino"),function(y,B){s=$(B).attr("card");l=$(B).attr("id_afil");n=$(B).attr("monto").replace(",",".");o=$(B).attr("concepto");comision=$(B).attr("comision");transferencia=f(p,s,n,o,q,l);if(transferencia!=false){r=true;a(r,B,transferencia);var t,u;nombre=$("#nombreOrigenTransfer").html();mascara=$("#mascaraOrigenTransfer").html();var x=new Date();hora=(x.getHours())+":"+x.getMinutes()+":"+x.getSeconds();var z=x.getDate();var v=x.getMonth()+1;var w=x.getFullYear();if(z<10){z="0"+z}if(v<10){v="0"+v}var A=z+"/"+v+"/"+w;t="<tr>";t+='<td class="data-label"><label>Cuenta Origen</label></td>';t+='<td class="data-reference" colspan="2"><br>'+nombre+"</td>";t+="</tr>";$("#progress").children().remove();cabecera="<ul class='steps'>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-exchange'></span> Transferir</li>";cabecera+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";cabecera+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";cabecera+="</ul>";$("#progress").append(cabecera).html();$("#titulo").children().remove();titulo="<h2>Finalización</h2>";$("#titulo").append(titulo).html();$("#confimacion_t").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_t").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}else{r=false;trans="-";a(r,B,transferencia);$("#confimacion_t").children().remove();completar1='<button id="exit">Finalizar</button>';$("#confimacion_t").append(completar1).html();$("#exit").click(function(){$(location).attr("href",base_url+"/dashboard")})}})}});function k(){var l;$.each($("#tdestino").children(),function(o,n){l=o});return l+1}function c(){$(".dialogDestino").click(function(){$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",open:function(l,n){$(".ui-dialog-titlebar-close",n.dialog).hide()}});$("#close").click(function(){$("#content-destino").dialog("close")})})}function d(){var n=0;var l;$.each($(".dinero"),function(p,o){l=$(o).val().replace(",",".");n=n+parseFloat(l);n.toFixed(2)});if(isNaN(n)){n=0}return n}function g(){$.each($("#dashboard-beneficiary").children(".dashboard-item"),function(n,l){$(l).removeClass("disabled-dashboard-item");$.each($("#tdestino").children(":not(.obscure-group)"),function(p,o){if($(o).find("#tarjetaDestino").val()==$(l).attr("card")){$(l).addClass("disabled-dashboard-item")}})})}function i(l){var o;var n;$.ajaxSetup({async:false});$.post(base_url+"/transferencia/operaciones",{clave:hex_md5(l)},function(p){rpta=$.parseJSON(p.response);n=$.parseJSON(p.transferir);if(rpta.rc==0){o=true}else{o=false;n=false}});return n}function j(){$.ajaxSetup({async:false});var l;$.post(base_url+"/transferencia/crearClave",function(n){if(n.rc==0){l=true}else{l=false;$("#dialog-error-clave").dialog({title:"ContraseÃ±as no coinciden",modal:"true",width:"440px",open:function(o,p){$(".ui-dialog-titlebar-close",p.dialog).hide()}});$("#invalido2").click(function(){$("#dialog-error-clave").dialog("close");$(location).attr("href",base_url+"/transfer/index_tdc")})}});return l}function h(l){$.ajaxSetup({async:false});var n;$.post(base_url+"/transferencia/confirmacion",{clave:hex_md5(l)},function(o){if(o.rc==0){n=true}else{n=false;$("#dialog-error-correo").dialog({title:"ContraseÃ±as no coinciden",modal:"true",width:"440px",open:function(p,q){$(".ui-dialog-titlebar-close",q.dialog).hide()}});$("#invalido").click(function(){$("#dialog-error-correo").dialog("close")})}});return n}function f(n,l,p,o,t,s){var r;var u;$.ajaxSetup({async:false});var q={cuentaOrigen:n,cuentaDestino:l,monto:p,descripcion:o,tipoOpe:"P2C",idUsuario:t,id_afil_terceros:s};$.ajax({url:base_url+"/transferencia/procesar",data:q,type:"post",dataType:"json",success:function(v){if(v.rc==0){u=v.dataTransaccion.referencia;r=u;$("#continue_trans").prop("disabled",false)}else{r=false;$("#continue_trans").prop("disabled",false)}}});$.ajaxSetup({async:true});return r}function a(o,l,n){if(o==true){$(l).find(".data-resultado").addClass("data-success");$(l).find(".iconoTransferencia").removeClass("data-indicator icon-refresh icon-spin");$(l).find(".iconoTransferencia").addClass("icon-ok-sign");$(l).find("#estatus").empty();$(l).find("#estatus").text("Transacción exitosa. Nro. de Referencia: "+n)}else{$(l).find(".data-resultado").addClass("data-error");$(l).find(".iconoTransferencia").removeClass("data-indicator data-indicator icon-refresh icon-spin");$(l).find(".iconoTransferencia").addClass("icon-cancel-sign");$(l).find("#estatus").empty();$(l).find("#estatus").text("Transacción fallida.")}}function b(){$.each($("#dashboard-beneficiary").children(".dashboard-item"),function(n,l){if(montoMaxDiario==montoAcumDiario){$(l).addClass("disabled-dashboard-item");alert("Para esta operacion usted supera el monto maximo diario de transferencias")}else{if(montoMaxMensual==montoAcumMensual){$(l).addClass("disabled-dashboard-item");alert("Para esta operacion usted supera el monto maximo diario de transferencias")}}})}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(l,n){$(".ui-dialog-titlebar-close",n.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});