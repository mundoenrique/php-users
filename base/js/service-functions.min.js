function viewSelect(e){var o,n,c,r,s,a=$("#lock-acount select, #lock-acount input, #continuar"),t="block",l=$("#bloqueo-cuenta");switch("key"==e&&(a=$("#change-key input, #change-key select, #continuar"),l=$("#cambio-pin"),t="change"),viewControl!=e&&(a.prop("disabled",!1),resetForms(l),cleanComplete(t),$("#sendToken").remove()),viewControl=e,e){case"lock":$("#msg-block h2").text(bloqAction+"cuenta"),o=$("#lock"),n=$("#key, #replace"),c=$("#change-key, #reason-rep"),r=$("#lock-acount, #prevent-bloq"),$("#mot-sol").prop("disabled",!0),s="lockAccoun",$("#action").text(bloqAction);break;case"key":$("#msg-change h2").text("Cambio de PIN"),o=$("#key"),n=$("#lock, #replace"),c=$("#lock-acount"),r=$("#change-key"),s="changePin";break;case"replace":$("#msg-block h2").text("Solicitud de reposición"),o=$("#replace"),n=$("#key, #lock"),c=$("#change-key, #prevent-bloq"),r=$("#lock-acount, #reason-rep"),s="lockReplace"}o.removeClass("service-item-unselect").addClass("service-item-select"),n.removeClass("service-item-select").addClass("service-item-unselect"),c.hide(),r.show(950),$("#continuar").attr("data-action",s)}function lock_change(e,o,n,c){var r="LockAccount"==o?"block":"change",s="LockAccount"==o?"lock-acount":"change-key";$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{data:e,model:o},datatype:"JSON",beforeSend:function(e,o){cleanBefore(r,s)},success:function(e){switch(cleanComplete(r),e.code){case 0:notiSystem(e.title,e.msg,"success","out",n);break;case 1:notiService(e.msg,"msg-lock-error","msg-lock-success",r),"lock-acount"==s?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").prop("disabled",!1),"lockAccoun"==c?$("#mot-sol").prop("disabled",!0):"";break;case 2:notiService(e.msg,"msg-lock-error","msg-lock-success",r),"lock-acount"==s?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0);break;case 3:notiSystem(e.title,e.msg,"warning","out",n);break;case 4:viewToken(e.msg,r);break;case 5:notiService(e.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(r),$("#msg-block div").unbind("click")});break;default:notiSystem(e.title,e.msg,"error","close",n)}},error:function(e,o,n){console.log(e),console.log(o),console.log(n)}})}function getToken(e){$("#carry").remove(),$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{model:"GetToken"},datatype:"json",beforeSend:function(e,o){cleanBefore("block")},success:function(o){switch(cleanComplete("block"),o.code){case 4:viewToken(o.msg,e);break;case 5:notiService(o.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(e),$("#msg-block div").unbind("click")});break;case 2:notiSystem(o.title,o.msg,"warning","out");break;default:notiSystem(o.title,o.msg,"error","close")}},error:function(e,o,n){console.log(e),console.log(o),console.log(n)}})}function cleanBefore(e,o){"lock-acount"==o?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0),$("#msg-"+e).removeClass("msg-lock-error msg-lock-success"),$("#msg-"+e+" #result-"+e).html("").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 50px;"></span>'),$("#msg-"+e+" h3").text("Estamos procesando su solicitud"),$("#msg-"+e).show()}function cleanComplete(e){$("#msg-"+e+" h3").text(""),$("#msg-"+e+" #result-"+e).html("")}function notiService(e,o,n,c){resetForms(),$("#msg-"+c).removeClass(n).addClass(o),$("#msg-"+c+" > h3").html(e)}function notiSystem(e,o,n,c,r){var s="lock"===r||"key"===r||"replace"===r?r:null,a="lock"!=r&&"key"!=r&&"replace"!=r?r:null;resetForms(a);var t="warning"==n?"warning":"error"==n?"cancel":"ok",l=$("#msg_system");l.dialog({title:e,modal:"true",width:"440px",draggable:!1,rezise:!1,open:function(e,r){$(".ui-dialog-titlebar-close",r.dialog).hide(),"carry"==c?($("#form-action").append('<button id="carry">Si</button>'),$("#carry").focus(),$("#close-info").text("No").attr("type","reset")):$("#close-info").text("Cerrar").removeAttr("type"),$("#msg_info").removeAttr("class").addClass("alert-simple alert-"+n),$("#msg_info span").removeAttr("class").addClass("icon-"+t+"-sign"),$("#msg_info p").empty().append(o)}}),$("#close-info").on("click",function(e){switch(e.preventDefault(),$("#msg_system").dialog("close"),c){case"out":$(location).attr("href",base_url+"/servicios");break;case"close":$(location).attr("href",base_url+"/users/closeSess")}$("#carry").remove()}),$("#carry").on("click",function(e){e.preventDefault(),$("#msg_system").dialog("close"),viewSelect(s),$("#carry").remove()})}function viewToken(e,o){notiService(e,"msg-lock-success","msg-lock-error",o),"block"==o?$("#lock-acount input, #lock-acount select, #continuar").not("#mes-exp-bloq, #anio-exp-bloq, #mot-sol").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").not("#mes-exp-cambio, #anio-exp-cambio, #pin-current, #new-pin, #confirm-pin").prop("disabled",!1);var n='<li id="sendToken" class="col-md-3-profile">';n+='<label for="token">Código de seguridad</label>',n+='<input class="field-medium" id="token" name="token" type="text">',n+="</li>",$("#"+o+"-ul").append(n)}function validar_campos(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("tokenValid",function(e,o){var n=/^[a-zA-Z0-9]+$/,c=o.value;return!!n.test(c)}),jQuery.validator.addMethod("pinNew1",function(e,o){return o.value.length>0&&o.value==$("#new-pin").val()},"Debe ser igual al nuevo PIN"),jQuery.validator.addMethod("pinNew2",function(e,o){return!(o.value.length>0&&o.value==$("#pin-current").val())},"El nuevo PIN no debe ser igual a su PIN anterior"),$("#bloqueo-cuenta").validate({errorElement:"label",ignore:"",errorContainer:"#msg1",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg1",rules:{token:{required:!0,tokenValid:!0},"mes-exp-bloq":{required:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"mot-sol":"Debe seleccionar el motivo de la reposición"}}),$("#cambio-pin").validate({errorElement:"label",ignore:"",errorContainer:"#msg2",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg2",rules:{token:{required:!0,tokenValid:!0},"pin-current":{required:!0,number:!0},"new-pin":{number:!0,pinNew2:!0,required:!0},"confirm-pin":{number:!0,pinNew1:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"pin-current":{required:"Debe colocar su PIN actual",number:"Debe ser numérico"},"new-pin":{number:"Su nuevo PIN debe ser numérico",pinNew2:"El nuevo PIN no debe ser igual a su PIN anterior",required:"Debe colocar su nuevo PIN"},"confirm-pin":{number:"La confirmación de su nuevo PIN debe ser numérico",pinNew1:"Debe ser igual a su nuevo PIN"}}})}function resetForms(e){e?e[0].reset():"",$("#msg1, #msg2").children().remove(),$("#bloqueo-cuenta *, #cambio-pin *").children().removeClass("field-success field-error")}