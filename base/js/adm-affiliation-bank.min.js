var path,base_cdn;path=window.location.href.split("/");base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1"));base_url=path[0]+"//"+path[2]+"/"+path[3];$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")});$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(g,h){$(".ui-dialog-titlebar-close",h.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")});var e=$("#dashboard-donor");e.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:true}});var d=$("#filters-stack .option-set"),f=d.find("a");f.click(function(){var k=$(this);if(k.hasClass("selected")){return false}var i=k.parents(".option-set");i.find(".selected").removeClass("selected");k.addClass("selected");var g={},h=i.attr("data-option-key"),j=k.attr("data-option-value");j=j==="false"?false:j;g[h]=j;if(h==="layoutMode"&&typeof changeLayoutMode==="function"){changeLayoutMode(k,g)}else{e.isotope(g)}return false})});$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item");$(this).parents("li").addClass("current-stack-item")});$(".dashboard-item").click(function(){var o,k,g,f,p,l,h,n;o=$(this).find("img").attr("src");k=$(this).attr("card");g=$(this).attr("marca");f=$(this).attr("mascara");p=$(this).attr("producto1");l=$(this).attr("empresa");n=$(this).attr("nombre");$("#donor").children().remove();h='<div class="product-presentation" producto="'+p+'">';h+='<img src="'+o+'" width="200" height="130" alt="" />';h+='<div class="product-network '+g.toLowerCase()+'"></div>';h+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+p+'" nombreOrigen="'+n+'" cardOrigen="'+k+'" masCtaOrigen="'+j+'" marcaCtaOrigen="'+g+'"  />';h+="</div>";h+='<div class="product-info-full">';h+='<p class="product-cardholder" id="nombreCtaOrigen">'+n+"</p>";h+='<p class="product-cardnumber" id="mascara">'+f+"</p>";h+='<p class="product-metadata" id="marca">'+p+"</p>";h+='<nav class="product-stack" id="selCtaOrigen">';h+='<ul class="stack">';h+='<li class="stack-item">';h+='<a dialog button product-button rel="section" id="buscarCta" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>';h+="</li>";h+="</ul>";h+="</nav>";h+="</div>";$("#donor").append(h);$(".product-button").removeClass("disabled-button");$("#agregarCuenta").attr("href","#");$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item");$(this).addClass("current-dashboard-item");$("#content-product").dialog("close");var d=$("#donor-cardnumber-origen").attr("cardorigen");var j=$("#donor-cardnumber-origen").attr("masCtaOrigen");var m=$("#donor-cardnumber-origen").attr("producto");var p=$("#donor-cardnumber-origen").attr("producto");var e=$("#donor-cardnumber-origen").attr("nombreOrigen");var i=$(this).attr("prefix");mes=$("#filter-month").val();anio=$("#filter-year").val();$("#buscar").removeClass("disabled-button");$("#list-detail").children().remove();c(d,i,j,m,e,p);$(".stack-item").click(function(){$("#dashboard").children().remove();$("#botonContinuar").attr("disabled",true);$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(q,r){$(".ui-dialog-titlebar-close",r.dialog).hide()}})})});function c(f,j,i,h,e,d){var k,g;$.post(base_url+"/transferencia/ctaDestino",{nroTarjeta:f,prefijo:j,operacion:"P2T"},function(m){if(m.rc==-61){$(location).attr("href",base_url+"/users/error_gral")}if(m.rc==0){$("#empty-state").remove();$.each(m.cuentaDestinoTercero,function(r,q){var o=Math.floor(Math.random()*5)+1;var p="bank-"+o;var n;n="<li class='dashboard-item "+q.beneficiario+" muestraDestino' card='"+q.noCuenta+"' banco='"+q.banco+"' codBanco='"+q.codBanco+"' id_ext_per='"+q.id_ext_per+"' nombre='"+q.beneficiario+"' emailCliente='"+q.email+"' id_afiliacion='"+q.id_afiliacion+"' marca='"+q.marca+"' mascara='"+q.noCuentaConMascara+"'>";n+="<div class='dashboard-item-box'>";n+="<img src='"+base_cdn+"/img/products/default/"+p+".png' width='200' height='130' alt='' />";n+="<div class='dashboard-item-info'>";n+="<p class='dashboard-item-cardholder'>"+q.beneficiario+"</p>";n+="<ul class='dashboard-item-actions'>";n+="<li class='actions-item'>";n+="<a title='Modificar' id='modificar'><span aria-hidden='true' class='icon-edit'></span></a>";n+="</li>";n+="<li class='actions-item' id='eliminar'>";n+="<a title='Remover'><span aria-hidden='true' class='icon-remove'></span></a>";n+="</li>";n+="</ul>";n+="<p class='dashboard-item-cardnumber'>"+q.noCuentaConMascara+"</p>";n+="<p class='dashboard-item-category'>"+q.banco+"</p>";n+="</div>";n+="</div>";n+="</li>";$("#dashboard").append(n)});$(".muestraDestino").on("click","#modificar",function(){var z,s,o,n,t,p,x,u,B,A,r,q,v=[],y;u=new Date();B=u.getFullYear();A=B-5;r=B+5;for(q=A;q<=r;q++){v.push(q)}s=$(this).parents(".dashboard-item").attr("card");id_ext_per_1=$(this).parents(".dashboard-item").attr("id_ext_per");tipo_doc=id_ext_per_1.substr(0,1);id_ext_per=id_ext_per_1.substr(1,9);y=$(this).parents(".dashboard-item").attr("nombre");emailCliente=$(this).parents(".dashboard-item").attr("emailCliente");id_afiliacion=$(this).parents(".dashboard-item").attr("id_afiliacion");banco=$(this).parents(".dashboard-item").attr("banco");codBanco=$(this).parents(".dashboard-item").attr("codBanco");$(".product-button").attr("disabled","disabled");$("#selCtaOrigen").attr("style","display:none");$("#content-holder").children().remove();var w;w="<div id='progress'>";w+="<ul class='steps'>";w+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";w+="<li class='step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";w+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";w+="</ul>";w+="</div>";w+="<div id='content-holder'>";w+="<form id='datos'>";w+="<ul class='field-group'>";w+="<li class='field-group-item'>";w+="<label for='dayExp'>Fecha de Vencimiento</label>";w+="<select id='MonthExp' name='MonthExp'>";w+="<option value=''>Mes</option>";w+="<option value='01'>01</option>";w+="<option value='02'>02</option>";w+="<option value='03'>03</option>";w+="<option value='04'>04</option>";w+="<option value='05'>05</option>";w+="<option value='06'>06</option>";w+="<option value='07'>07</option>";w+="<option value='08'>08</option>";w+="<option value='09'>09</option>";w+="<option value='10'>10</option>";w+="<option value='11'>11</option>";w+="<option value='12'>12</option>";w+="</select>";w+="<select id='yearExp' name='yearExp'>";w+="<option value=''>Año</option>";w+="</select>";w+="</li>";w+="<li class='field-group-item'>";w+="<label for='bank-name'>Banco	</label>";w+="<select id='bank-name' name='bank-name' banco='"+banco+"''>";w+="<option selected value='"+codBanco+"'>"+banco+"</option>";w+="</select>";w+="</li>";w+="</ul>";w+="<ul class='field-group'>";w+="<li class='field-group-item'>";w+="<label for='card-number'>N° de Cuenta Destino</label>";w+="<input class='field-medium' id='card-number' name='card-number' maxlength='20' value='"+s+"'/>";w+="</li>";w+=" <li class='field-group-item'>";w+="<label for='card-holder'>Beneficiario</label>";w+="<input class='field-large' id='card-holder' name='card-holder' maxlength='35' type='text' value='"+y+"' />";w+="</li>";w+="</ul>";w+="<ul class='field-group'>";w+="<li class='field-group-item'>";w+="<label for='bank-account-holder-id'>Documento de Identidad</label>";w+="<select id='doc-name' name='doc-name'>";w+="<option selected value='"+tipo_doc+"'>"+tipo_doc+"</option>";w+="<option value='V'>V</option>";w+="<option value='E'>E</option>";w+="<option value='J'>J</option>";w+="<option value='G'>G</option>";w+="</select>";w+="<input class='field-medium' id='bank-account-holder-id' name='bank-account-holder-id' maxlength='14' minlength='5' type='text' value="+id_ext_per+" />";w+="</li>";w+="<li class='field-group-item'>";w+="<label for='card-holder-email'>Correo Electrónico</label>";w+="<input class='field-large' id='card-holder-email' name='card-holder-email' maxlength='30'  type='text' value="+emailCliente+" />";w+="</li>";w+="</ul>";w+="</form>";w+="<div id='msg' banco='"+codBanco+"''></div>";w+="<div class='form-actions'>";w+="<button id='cancelar1' type='reset'>Cancelar</button>";w+="<button id='cambiar'>Modificar</button>";w+="</div>";w+="</div>";$("#content-holder").append(w);$.each(v,function(C,E){var D=E.toString().substring(2,4);var F="<option value='"+D+"'>"+E+"</option>";$("#yearExp").append(F)});b();$("#cancelar1").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")});$("#cambiar").click(function(){a();$("#datos").submit();setTimeout(function(){$("#msg").fadeOut()},5000);var D,M,H;D=$("#datos");var J=$("#card-number").val();cod_ban=J.substr(0,4);banc=true;if(cod_ban!=codBanco){banc=false;$("#dialog-banco").dialog({title:"Cuenta inválida",modal:"true",width:"440px",open:function(O,P){$(".ui-dialog-titlebar-close",P.dialog).hide()}});$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")});$(this).val("")}if((D.valid()==true)&&(banc==true)){var G;var J=$("#card-number").val();var F=$("#card-holder").val();var E=$("#bank-account-holder-id").val();var L=$("#doc-name option:selected").val();var N=L+E;var C=$("#card-holder-email").val();var I=$("#msg").attr("banco");var K=$("#bank-name").attr("banco");$("#selCtaOrigen").attr("style","display:none");n=$("#donor").find(".product-cardnumber").html();$("#content-holder").children().remove();G="<div id='progress'>";G+="<ul class='steps'>";G+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";G+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";G+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";G+="</ul>";G+="</div>";G+="<div id='content-holder'>";G+="<h2>Confirmación</h2>";G+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>";G+="<tbody>";G+="<tr>";G+="<td class='data-label'><label>Cuenta de Origen</label></td>";G+="<td class='data-reference'>"+e+"<br /><span class='highlight'>"+n+"</span><br /><span class='lighten'>"+d+"</span></td>";G+="</tr>";G+="<tr>";G+="<td class='data-label'><label>Cuenta Destino a Afiliar</label;></td>";G+="<td class='data-reference'>"+F+"<span class='lighten'>( "+C+" )</span><br /> "+N+" <br /><span class='highlight'>"+J+"</span><br /><span class='lighten'>"+K+"</span></td>";G+="</tr>";G+="</tbody>";G+="</table>";G+="<div class='form-actions'>";G+="<button id='cancelar' type='reset'>Cancelar</button>";G+="<button id='continuar'>Continuar</button>";G+="</div>";G+="</div>";$("#content-holder").append(G);$("#continuar").click(function(){$.post(base_url+"/adm/modificar",{id_afiliacion:id_afiliacion,nroPlasticoOrigen:f,nroCuentaDestino:J,id_ext_per:N," beneficiario":F,tipoOperacion:"P2T",email:C,banco:I},function(R){if(R.rc==0){var O;$("#progress").attr("style","display:none");$("#content-holder").children().remove();O="<div id='progress'>";O+="<ul class='steps'>";O+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>";O+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>";O+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";O+="</ul>";O+="</div>";O+="<div class='alert-success' id='message'>";O+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación modificada satisfactoriamente";O+="</div>";O+="<div class='form-actions'>";O+="<button id='exit'>Finalizar</button>";O+="</div>";$("#content-holder").append(O)}else{var O,P="",Q="(15)";switch(R.rc){case -340:P="Cantidad de dígitos de la cuenta es invalida.";break;case -341:P="El número de cuenta no corresponde al banco.";break;case -342:P="Número de cuenta invalido";break;case -343:P="Su tarjeta se encuentra bloqueada, código de bloqueo: ("+Q.substr(1,2)+")";break;default:}$("#progress").attr("style","display:none");$("#content-holder").children().remove();O="<div class='alert-error' id='message'>";O+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no modificada, "+P;O+="</div>";O+="<div class='form-actions'>";O+="<button id='exit'>Finalizar</button>";O+="</div>";$("#content-holder").append(O)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})})}$("#cancelar").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})});$(".muestraDestino").on("click","#eliminar",function(){tarjeta=$(this).parents(".dashboard-item").attr("card");id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per");nombre=$(this).parents(".dashboard-item").attr("nombre");emailCliente=$(this).parents(".dashboard-item").attr("emailCliente");banco=$(this).parents(".dashboard-item").attr("banco");codBanco=$(this).parents(".dashboard-item").attr("codBanco");mascara=$("#donor").find(".product-cardnumber").html();$("#selCtaOrigen").attr("style","display:none");var n;$("#content-holder").children().remove();n="<div id='progress'>";n+="<ul class='steps two-steps'>";n+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>";n+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";n+="</ul>";n+="</div>";n+="<div id='content-holder'>";n+="<h2>Eliminación de Afiliación</h2>";n+="<p>Por favor, verifique los datos de la afiliación que Ud. está a punto de remover.</p>";n+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>";n+="<tbody>";n+="<tr>";n+="<td class='data-label'><label>Cuenta de Origen</label></td>";n+="<td class='data-reference'>"+e+"<br /><span class='highlight'>"+mascara+"</span><br /><span class='lighten'>"+h+"</span></td>";n+="</tr>";n+="<tr>";n+="<td class='data-label'><label>Cuenta Destino Afiliada</label></td>";n+="<td class='data-reference'>"+nombre+"<span class='lighten'>( "+emailCliente+" )</span><br />"+id_ext_per+"<br /><span class='highlight'>"+tarjeta+"</span><br /><span class='lighten'>"+banco+"</span></td>";n+="</tr>";n+="</tbody>";n+="</table>";n+="<div class='form-actions'>";n+="<button id='cancel' type='reset'>Cancelar</button>";n+="<button id='cont'>Continuar</button>";n+="</div>";n+="</div>";$("#content-holder").append(n);$("#cont").click(function(){$.post(base_url+"/adm/eliminar",{noTarjeta:f,noCuentaDestino:tarjeta,tipoOperacion:"P2T"},function(p){if(p.rc==0){$("#progress").attr("style","display:none");$("#content-holder").children().remove();o="<div id='progress'>";o+="<ul class='steps two-steps'>";o+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>";o+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>";o+="</ul>";o+="</div>";o+="<div class='alert-success' id='message'>";o+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación eliminada satisfactoriamente";o+="</div>";o+="<div class='form-actions'>";o+="<button id='exit'>Finalizar</button>";o+="</div>";$("#content-holder").append(o)}else{var o;$("#progress").attr("style","display:none");$("#content-holder").children().remove();o="<div class='alert-error' id='message'>";o+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no eliminada";o+="</div>";o+="<div class='form-actions'>";o+="<button id='exit'>Finalizar</button>";o+="</div>";$("#content-holder").append(o)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})});$("#cancel").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})}else{$("#empty-state").children().remove();var l='<div id="empty-state" style="position: static;">';l+="<h2>No se encontraron tarjetas asociadas</h2>";l+="<p>Vuelva a realizar la búsqueda con una tarjeta distinta.</p>";l+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -415px;"></span>';l+="</div>";$("#empty-state").append(l)}})}function a(){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("numOnly",function(g,f){var h=/^[a-zA-Z0-9]+$/,e=f.value;if(h.test(e)){return true}else{return false}});var d=/^[a-zA-Z_áéíóúñ\s]*$/;$("#datos").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:true,number:true},"card-holder":{required:true,pattern:d},"doc-name":{required:true},"bank-account-holder-id":{number:true,required:true,maxlength:14,minlength:5,numOnly:true},"card-holder-email":{required:true,email:true},MonthExp:{required:true},yearExp:{required:true}},messages:{"card-number":"El n° de cuenta destino no puede estar vacío y debe contener solo números","card-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"doc-name":"El Tipo de Documento no puede estar vacío","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com).",MonthExp:"Seleccione el mes de vencimiento de su tarjeta",yearExp:"Seleccione el año de vencimiento de su tarjeta"}})}function b(){$.ajaxSetup({async:false});$.post(base_url+"/affiliation/bancos",function(d){$.each(d.lista,function(g,e){var f;f="<option value="+e.codBcv+"> "+e.nomBanco+" </option>";$("#bank-name").append(f)})})}$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(d,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}});$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});