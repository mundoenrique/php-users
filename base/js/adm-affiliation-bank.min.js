var path,base_cdn;path=window.location.href.split("/"),base_cdn=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_baseCdn\s*\=\s*([^;]*).*$)|^.*$/,"$1")),base_url=path[0]+"//"+path[2]+"/"+path[3],$(function(){function a(a,t,n,r,o,s){$.post(base_url+"/transferencia/ctaDestino",{nroTarjeta:a,prefijo:t,operacion:"P2T"},function(t){if(t.rc==-61&&$(location).attr("href",base_url+"/users/error_gral"),0==t.rc)$("#empty-state").remove(),$.each(t.cuentaDestinoTercero,function(a,e){var i,t=Math.floor(5*Math.random())+1,n="bank-"+t;i="<li class='dashboard-item "+e.beneficiario+" muestraDestino' card='"+e.noCuenta+"' banco='"+e.banco+"' codBanco='"+e.codBanco+"' id_ext_per='"+e.id_ext_per+"' nombre='"+e.beneficiario+"' emailCliente='"+e.email+"' id_afiliacion='"+e.id_afiliacion+"' marca='"+e.marca+"' mascara='"+e.noCuentaConMascara+"'>",i+="<div class='dashboard-item-box'>",i+="<img src='"+base_cdn+"/img/products/default/"+n+".png' width='200' height='130' alt='' />",i+="<div class='dashboard-item-info'>",i+="<p class='dashboard-item-cardholder'>"+e.beneficiario+"</p>",i+="<ul class='dashboard-item-actions'>",i+="<li class='actions-item'>",i+="<a title='Modificar' id='modificar'><span aria-hidden='true' class='icon-edit'></span></a>",i+="</li>",i+="<li class='actions-item' id='eliminar'>",i+="<a title='Remover'><span aria-hidden='true' class='icon-remove'></span></a>",i+="</li>",i+="</ul>",i+="<p class='dashboard-item-cardnumber'>"+e.noCuentaConMascara+"</p>",i+="<p class='dashboard-item-category'>"+e.banco+"</p>",i+="</div>",i+="</div>",i+="</li>",$("#dashboard").append(i)}),$(".muestraDestino").on("click","#modificar",function(){var t,n,r;t=$(this).parents(".dashboard-item").attr("card"),id_ext_per_1=$(this).parents(".dashboard-item").attr("id_ext_per"),tipo_doc=id_ext_per_1.substr(0,1),id_ext_per=id_ext_per_1.substr(1,9),r=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),id_afiliacion=$(this).parents(".dashboard-item").attr("id_afiliacion"),banco=$(this).parents(".dashboard-item").attr("banco"),codBanco=$(this).parents(".dashboard-item").attr("codBanco"),$(".product-button").attr("disabled","disabled"),$("#selCtaOrigen").attr("style","display:none"),$("#content-holder").children().remove();var d;d="<div id='progress'>",d+="<ul class='steps'>",d+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",d+="<li class='step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",d+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",d+="</ul>",d+="</div>",d+="<div id='content-holder'>",d+="<form id='datos'>",d+="<ul class='field-group'>",d+="<li class='field-group-item'>",d+="<label for='bank-name'>Banco</label>",d+="<select id='bank-name' name='bank-name' banco='"+banco+"''>",d+="<option selected value='"+codBanco+"'>"+banco+"</option>",d+="</select>",d+="</li>",d+="<li class='field-group-item'>",d+="<label for='card-number'>N° de Cuenta Destino</label>",d+="<input class='field-medium' id='card-number' name='card-number' maxlength='20' value='"+t+"'/>",d+="</li>",d+=" <li class='field-group-item'>",d+="<label for='card-holder'>Beneficiario</label>",d+="<input class='field-large' id='card-holder' name='card-holder' maxlength='35' type='text' value='"+r+"' />",d+="</li>",d+="</ul>",d+="<ul class='field-group'>",d+="<li class='field-group-item'>",d+="<label for='bank-account-holder-id'>Documento de Identidad</label>",d+="<select id='doc-name' name='doc-name'>",d+="<option selected value='"+tipo_doc+"'>"+tipo_doc+"</option>",d+="<option value='V'>V</option>",d+="<option value='E'>E</option>",d+="<option value='J'>J</option>",d+="<option value='G'>G</option>",d+="</select>",d+="<input class='field-medium' id='bank-account-holder-id' name='bank-account-holder-id' maxlength='14' minlength='5' type='text' value="+id_ext_per+" />",d+="</li>",d+="<li class='field-group-item'>",d+="<label for='card-holder-email'>Correo Electrónico</label>",d+="<input class='field-large' id='card-holder-email' name='card-holder-email' maxlength='30'  type='text' value="+emailCliente+" />",d+="</li>",d+="</ul>",d+="</form>",d+="<div id='msg' banco='"+codBanco+"''></div>",d+="<div class='form-actions'>",d+="<button id='cancelar1' type='reset'>Cancelar</button>",d+="<button id='cambiar'>Modificar</button>",d+="</div>",d+="</div>",$("#content-holder").append(d),i(),$("#cancelar1").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")}),$("#cambiar").click(function(){e(),$("#datos").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3);var i;i=$("#datos");var t=$("#card-number").val();if(cod_ban=t.substr(0,4),banc=!0,cod_ban!=codBanco&&(banc=!1,$("#dialog-banco").dialog({title:"Cuenta inválida",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")}),$(this).val("")),1==i.valid()&&1==banc){var r,t=$("#card-number").val(),d=$("#card-holder").val(),c=$("#bank-account-holder-id").val(),l=$("#doc-name option:selected").val(),u=l+c,p=$("#card-holder-email").val(),m=$("#msg").attr("banco"),b=$("#bank-name").attr("banco");$("#selCtaOrigen").attr("style","display:none"),n=$("#donor").find(".product-cardnumber").html(),$("#content-holder").children().remove(),r="<div id='progress'>",r+="<ul class='steps'>",r+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",r+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",r+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",r+="</ul>",r+="</div>",r+="<div id='content-holder'>",r+="<h2>Confirmación</h2>",r+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",r+="<tbody>",r+="<tr>",r+="<td class='data-label'><label>Cuenta de Origen</label></td>",r+="<td class='data-reference'>"+o+"<br /><span class='highlight'>"+n+"</span><br /><span class='lighten'>"+s+"</span></td>",r+="</tr>",r+="<tr>",r+="<td class='data-label'><label>Cuenta Destino a Afiliar</label;></td>",r+="<td class='data-reference'>"+d+"<span class='lighten'>( "+p+" )</span><br /> "+u+" <br /><span class='highlight'>"+t+"</span><br /><span class='lighten'>"+b+"</span></td>",r+="</tr>",r+="</tbody>",r+="</table>",r+="<div class='form-actions'>",r+="<button id='cancelar' type='reset'>Cancelar</button>",r+="<button id='continuar'>Continuar</button>",r+="</div>",r+="</div>",$("#content-holder").append(r),$("#continuar").click(function(){$.post(base_url+"/adm/modificar",{id_afiliacion:id_afiliacion,nroPlasticoOrigen:a,nroCuentaDestino:t,id_ext_per:u," beneficiario":d,tipoOperacion:"P2T",email:p,banco:m},function(a){if(0==a.rc){var e;$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),e="<div id='progress'>",e+="<ul class='steps'>",e+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",e+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",e+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",e+="</ul>",e+="</div>",e+="<div class='alert-success' id='message'>",e+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación modificada satisfactoriamente",e+="</div>",e+="<div class='form-actions'>",e+="<button id='exit'>Finalizar</button>",e+="</div>",$("#content-holder").append(e)}else{var e,i="",t="(15)";switch(a.rc){case-340:i="Cantidad de dígitos de la cuenta es invalida.";break;case-341:i="El número de cuenta no corresponde al banco.";break;case-342:i="Número de cuenta invalido";break;case-343:i="Su tarjeta se encuentra bloqueada, código de bloqueo: ("+t.substr(1,2)+")"}$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),e="<div class='alert-error' id='message'>",e+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no modificada, "+i,e+="</div>",e+="<div class='form-actions'>",e+="<button id='exit'>Finalizar</button>",e+="</div>",$("#content-holder").append(e)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})})}$("#cancelar").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})}),$(".muestraDestino").on("click","#eliminar",function(){tarjeta=$(this).parents(".dashboard-item").attr("card"),id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per"),nombre=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),banco=$(this).parents(".dashboard-item").attr("banco"),codBanco=$(this).parents(".dashboard-item").attr("codBanco"),mascara=$("#donor").find(".product-cardnumber").html(),$("#selCtaOrigen").attr("style","display:none");var e;$("#content-holder").children().remove(),e="<div id='progress'>",e+="<ul class='steps two-steps'>",e+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",e+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",e+="</ul>",e+="</div>",e+="<div id='content-holder'>",e+="<h2>Eliminación de Afiliación</h2>",e+="<p>Por favor, verifique los datos de la afiliación que Ud. está a punto de remover.</p>",e+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",e+="<tbody>",e+="<tr>",e+="<td class='data-label'><label>Cuenta de Origen</label></td>",e+="<td class='data-reference'>"+o+"<br /><span class='highlight'>"+mascara+"</span><br /><span class='lighten'>"+r+"</span></td>",e+="</tr>",e+="<tr>",e+="<td class='data-label'><label>Cuenta Destino Afiliada</label></td>",e+="<td class='data-reference'>"+nombre+"<span class='lighten'>( "+emailCliente+" )</span><br />"+id_ext_per+"<br /><span class='highlight'>"+tarjeta+"</span><br /><span class='lighten'>"+banco+"</span></td>",e+="</tr>",e+="</tbody>",e+="</table>",e+="<div class='form-actions'>",e+="<button id='cancel' type='reset'>Cancelar</button>",e+="<button id='cont'>Continuar</button>",e+="</div>",e+="</div>",$("#content-holder").append(e),$("#cont").click(function(){$.post(base_url+"/adm/eliminar",{noTarjeta:a,noCuentaDestino:tarjeta,tipoOperacion:"P2T"},function(a){if(0==a.rc)$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),e="<div id='progress'>",e+="<ul class='steps two-steps'>",e+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",e+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",e+="</ul>",e+="</div>",e+="<div class='alert-success' id='message'>",e+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación eliminada satisfactoriamente",e+="</div>",e+="<div class='form-actions'>",e+="<button id='exit'>Finalizar</button>",e+="</div>",$("#content-holder").append(e);else{var e;$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),e="<div class='alert-error' id='message'>",e+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no eliminada",e+="</div>",e+="<div class='form-actions'>",e+="<button id='exit'>Finalizar</button>",e+="</div>",$("#content-holder").append(e)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})})}),$("#cancel").click(function(){$(location).attr("href",base_url+"/adm/adm_bank")})});else{$("#empty-state").children().remove();var n='<div id="empty-state" style="position: static;">';n+="<h2>No se encontraron tarjetas asociadas</h2>",n+="<p>Vuelva a realizar la búsqueda con una tarjeta distinta.</p>",n+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -415px;"></span>',n+="</div>",$("#empty-state").append(n)}})}function e(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("numOnly",function(a,e){var i=/^[a-zA-Z0-9]+$/,t=e.value;return!!i.test(t)});var a=/^[a-zA-Z_áéíóúñ\s]*$/;$("#datos").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:!0,number:!0},"card-holder":{required:!0,pattern:a},"doc-name":{required:!0},"bank-account-holder-id":{number:!0,required:!0,maxlength:14,minlength:5,numOnly:!0},"card-holder-email":{required:!0,email:!0}},messages:{"card-number":"El n° de cuenta destino no puede estar vacío y debe contener solo números","card-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"doc-name":"El Tipo de Documento no puede estar vacío","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)."}})}function i(){$.ajaxSetup({async:!1}),$.post(base_url+"/affiliation/bancos",function(a){$.each(a.lista,function(a,e){var i;i="<option value="+e.codBcv+"> "+e.nomBanco+" </option>",$("#bank-name").append(i)})})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var a=$("#dashboard-donor");a.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var e=$("#filters-stack .option-set"),i=e.find("a");i.click(function(){var e=$(this);if(e.hasClass("selected"))return!1;var i=e.parents(".option-set");i.find(".selected").removeClass("selected"),e.addClass("selected");var t={},n=i.attr("data-option-key"),r=e.attr("data-option-value");return r="false"!==r&&r,t[n]=r,"layoutMode"===n&&"function"==typeof changeLayoutMode?changeLayoutMode(e,t):a.isotope(t),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var e,i,t,n,r,o,s,d;e=$(this).find("img").attr("src"),i=$(this).attr("card"),t=$(this).attr("marca"),n=$(this).attr("mascara"),r=$(this).attr("producto1"),o=$(this).attr("empresa"),d=$(this).attr("nombre"),$("#donor").children().remove(),s='<div class="product-presentation" producto="'+r+'">',s+='<img src="'+e+'" width="200" height="130" alt="" />',s+='<div class="product-network '+t.toLowerCase()+'"></div>',s+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+r+'" nombreOrigen="'+d+'" cardOrigen="'+i+'" masCtaOrigen="'+l+'" marcaCtaOrigen="'+t+'"  />',s+="</div>",s+='<div class="product-info-full">',s+='<p class="product-cardholder" id="nombreCtaOrigen">'+d+"</p>",s+='<p class="product-cardnumber" id="mascara">'+n+"</p>",s+='<p class="product-metadata" id="marca">'+r+"</p>",s+='<nav class="product-stack" id="selCtaOrigen">',s+='<ul class="stack">',s+='<li class="stack-item">',s+='<a dialog button product-button rel="section" id="buscarCta" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',s+="</li>",s+="</ul>",s+="</nav>",s+="</div>",$("#donor").append(s),$(".product-button").removeClass("disabled-button"),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close");var c=$("#donor-cardnumber-origen").attr("cardorigen"),l=$("#donor-cardnumber-origen").attr("masCtaOrigen"),u=$("#donor-cardnumber-origen").attr("producto"),r=$("#donor-cardnumber-origen").attr("producto"),p=$("#donor-cardnumber-origen").attr("nombreOrigen"),m=$(this).attr("prefix");mes=$("#filter-month").val(),anio=$("#filter-year").val(),$("#buscar").removeClass("disabled-button"),$("#list-detail").children().remove(),a(c,m,l,u,p,r),$(".stack-item").click(function(){$("#dashboard").children().remove(),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}})})}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});