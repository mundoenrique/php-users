var reporte;$(function(){var nombreMes=new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");"0"==$("#filter-month").val()&&$("#period").text("reciente"),$("#buscar").on("click",function(){"0"==$("#filter-month").val()?$("#period").text("Reciente"):"1"==$("#filter-month").val()?$("#period").text("de Enero "+$("#filter-year").val()):"2"==$("#filter-month").val()?$("#period").text("de Febrero "+$("#filter-year").val()):"3"==$("#filter-month").val()?$("#period").text("de Marzo "+$("#filter-year").val()):"4"==$("#filter-month").val()?$("#period").text("de Abril "+$("#filter-year").val()):"5"==$("#filter-month").val()?$("#period").text("de Mayo "+$("#filter-year").val()):"6"==$("#filter-month").val()?$("#period").text("de Junio "+$("#filter-year").val()):"7"==$("#filter-month").val()?$("#period").text("de Julio "+$("#filter-year").val()):"8"==$("#filter-month").val()?$("#period").text("de Agosto "+$("#filter-year").val()):"9"==$("#filter-month").val()?$("#period").text("de Septiembre "+$("#filter-year").val()):"10"==$("#filter-month").val()?$("#period").text("de Octubre "+$("#filter-year").val()):"11"==$("#filter-month").val()?$("#period").text("de Noviembre "+$("#filter-year").val()):"12"==$("#filter-month").val()&&$("#period").text("de Diciembre "+$("#filter-year").val())}),$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display: block")},function(){$(".submenu-transfer").attr("style","display: none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display: block")},function(){$(".submenu-user").attr("style","display: none")});var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),dataRequest=JSON.stringify({tarjeta:$("#card").attr("card")});dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/detalles/load",{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},function(response){data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),$("#loading").hide(),carga_lista(data)});var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),dataRequest=JSON.stringify({tarjeta:$("#card").attr("card")});function carga_lista(data){var clase,cadena;-61==data.rc&&$(location).attr("href",base_url+"/users/error_gral"),0!=data.rc?($("#list-detail").children().remove(),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la búsqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -260px;"></span>',cadena+="</div>",$("#list-detail").append(cadena),reporte=!1):(reporte=!0,$("#list-detail").children().remove(),$.each(data.movimientos,function(pos,item){clase="+"==item.signo?"feed-income":"feed-expense";var date=item.fecha.split("/"),dia=date[0],mes,annio=date[2],moneda=$(".product-info-full").attr("moneda"),seccion;switch(date[1]){case"01":mes="Ene";break;case"02":mes="Feb";break;case"03":mes="Mar";break;case"04":mes="Abr";break;case"05":mes="May";break;case"06":mes="Jun";break;case"07":mes="Jul";break;case"08":mes="Ago";break;case"09":mes="Sep";break;case"10":mes="Oct";break;case"11":mes="Nov";break;case"12":mes="Dic"}seccion='<li class="feed-item '+clase+'">',seccion+='<div class="feed-date">'+dia+'<span class="feed-date-month">'+mes+'</span><span class="feed-date-year">'+annio+"</span></div>","-"==item.signo?seccion+=item.concepto+'<span class="money-amount"> - '+moneda+" "+item.monto+"</span>":seccion+=item.concepto+'<span class="money-amount"> '+moneda+" "+item.monto+"</span>",seccion+='<ul class="feed-metadata">',seccion+='<li class="feed-metadata-item"><span aria-hidden="true" class="icon-file-text"></span> '+item.referencia+"</li>",seccion+="</ul></li>",$("#list-detail").append(seccion)}),$("#estadisticas").kendoChart({legend:{position:"top",visible:!1},seriesDefaults:{labels:{template:"#= category # - #= kendo.format('{0:P}', percentage)#",position:"outsideEnd",visible:!1,background:"transparent"}},seriesColors:["#E74C3C","#2ECC71"],series:[{type:"donut",overlay:{gradient:"none"},data:[{category:"Cargos",value:parseFloat(parseFloat(data.totalCargos).toFixed(1))},{category:"Abonos",value:parseFloat(parseFloat(data.totalAbonos).toFixed(1))}]}],tooltip:{visible:!0,template:"#= category # - #= kendo.format('{0:P}', percentage) #"}}))}dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/dashboard/saldo",{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},function(response){data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8));var moneda=$(".product-info-full").attr("moneda"),saldoAct=data.actual,saldoBloq=data.bloqueo,saldoDisp=data.disponible;"string"!=typeof saldoAct&&(saldoAct="---"),"string"!=typeof saldoBloq&&(saldoBloq="---"),"string"!=typeof saldoDisp&&(saldoDisp="---"),$("#actual").html(moneda+saldoAct),$("#bloqueado").html(moneda+saldoBloq),$("#disponible").html(moneda+saldoDisp)}),$("#download").click(function(event){event.preventDefault(),0==reporte?($("#list-detail").children().remove(),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la búsqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -260px;"></span>',cadena+="</div>",$("#list-detail").append(cadena)):($("#tarjeta").val($("#card").attr("card")),0==$("#filter-month").val()?($("#mes").val(""),$("#anio").val("")):($("#mes").val(("0"+$("#filter-month").val()).slice(-2)),$("#anio").val($("#filter-year").val())),document.getElementById("idOperation").value="5",$("#form").submit())}),$("#downloadxls").click(function(event){event.preventDefault(),0==reporte?($("#list-detail").children().remove(),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la búsqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -260px;"></span>',cadena+="</div>",$("#list-detail").append(cadena)):($("#tarjeta").val($("#card").attr("card")),0==$("#filter-month").val()?($("#mes").val(""),$("#anio").val("")):($("#mes").val(("0"+$("#filter-month").val()).slice(-2)),$("#anio").val($("#filter-year").val())),document.getElementById("idOperation").value="46",$("#form").submit())}),$("#mes").hover(function(){$(".sub-stack").attr("style","display:block")},function(){$(".sub-stack").attr("style","display:none")}),$.each(nombreMes,function(pos,item){$(".sub-stack").append('<li class="sub-stack-item"><a href="#" rel="subsection" num="'+parseInt(pos+1)+'">'+item+"</a></li>")}),$("#content").on("click","#filter-month",function(){mes=$("#filter-month").val(),0==mes?($("#filter-year").prop("disabled",!0),$("#filter-year")[0].selectedIndex=0):($("#filter-year").prop("disabled",!1),0==$("#filter-year").selectedIndex&&($("#filter-year")[0].selectedIndex=1))}),$("#content").on("click","#buscar",function(){$("#list-detail").children("li").remove(),$("#estadisticas").children().remove(),$("#loading").show(),mes=$("#filter-month").val(),anio=$("#filter-year").val();var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));if(0==mes){var dataRequest=JSON.stringify({tarjeta:$("#card").attr("card")});dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/detalles/load",{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},function(response){data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),$("#loading").hide(),carga_lista(data)})}else{var dataRequest=JSON.stringify({tarjeta:$("#card").attr("card"),mes:mes,anio:anio});dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/detail/CallWsMovimientos",{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},function(response){data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),$("#loading").hide(),carga_lista(data)})}}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(event,ui){$(".ui-dialog-titlebar-close",ui.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});