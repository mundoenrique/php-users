var base_url,base_cdn,expDate;base_url=$("body").attr("data-app-url"),base_cdn=$("body").attr("data-app-cdn"),$(function(){function e(e,i,n,o,r,s){var l=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),c=JSON.stringify({nroTarjeta:e,prefijo:i,operacion:"P2C"});c=CryptoJS.AES.encrypt(c,l,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/transferencia/ctaDestino",{request:c,cpo_name:l,plot:btoa(l)},function(i){if(data=JSON.parse(CryptoJS.AES.decrypt(i.code,i.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),-61==data.rc&&$(location).attr("href",base_url+"/users/error_gral"),0==data.rc)$("#empty-state").remove(),$.each(data.tarjetaDestinoTercero,function(e,a){var t,i=Math.floor(5*Math.random())+1,n="card-"+i;t="<li class='dashboard-item "+a.beneficiario+" muestraDestino' card='"+a.noCuenta+"' banco='"+a.banco+"' codBanco='"+a.codBanco+"' id_ext_per='"+a.id_ext_per+"' nombre='"+a.beneficiario+"' emailCliente='"+a.email+"' id_afiliacion='"+a.id_afiliacion+"' marca='"+a.marca+"' mascara='"+a.noCuentaConMascara+"'>",t+="<div class='dashboard-item-box'>",t+="<img src='"+base_cdn+"img/products/default/"+n+".png' width='200' height='130' alt='' />",t+="<div class='dashboard-item-info'>",t+="<p class='dashboard-item-cardholder'>"+a.beneficiario+"</p>",t+="<ul class='dashboard-item-actions'>",t+="<li class='actions-item'>",t+="<a title='Modificar' id='modificar'><span aria-hidden='true' class='icon-edit'></span></a>",t+="</li>",t+="<li class='actions-item' id='eliminar'>",t+="<a title='Remover'><span aria-hidden='true' class='icon-remove'></span></a>",t+="</li>",t+="</ul>",t+="<p class='dashboard-item-cardnumber'>"+a.noCuentaConMascara+"</p>",t+="<p class='dashboard-item-category'>"+a.banco+"</p>",t+="</div>",t+="</div>",t+="</li>",$("#dashboard").append(t)}),$(".muestraDestino").on("click","#modificar",function(){var i,n,o,l,c,d,p,u,m,b=[];for(l=new Date,c=l.getFullYear(),d=c-5,p=c+15,u=d;u<=p;u++)b.push(u);i=$(this).parents(".dashboard-item").attr("card"),id_ext_per_1=$(this).parents(".dashboard-item").attr("id_ext_per"),tipo_doc=id_ext_per_1.substr(0,1),id_ext_per=id_ext_per_1.substr(1,14),o=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),id_afiliacion=$(this).parents(".dashboard-item").attr("id_afiliacion"),banco=$(this).parents(".dashboard-item").attr("banco"),codBanco=$(this).parents(".dashboard-item").attr("codBanco"),$("#content-holder").children().remove(),$("#selCtaOrigen").attr("style","display:none"),m="<div id='progress'>",m+="<ul class='steps'>",m+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",m+="<li class='step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",m+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",m+="</ul>",m+="</div>",m+="<div id='content-holder'>",m+="<form id='datos'>",m+="<ul class='field-group'>",m+="<li class='field-group-item'>",m+="<label for='dayExp'>Fecha de vcto. cta. origen</label>",m+="<select id='month-exp' name='month-exp' style='margin-right: 5px;'>",m+="<option value=''>Mes</option>",m+="<option value='01'>01</option>",m+="<option value='02'>02</option>",m+="<option value='03'>03</option>",m+="<option value='04'>04</option>",m+="<option value='05'>05</option>",m+="<option value='06'>06</option>",m+="<option value='07'>07</option>",m+="<option value='08'>08</option>",m+="<option value='09'>09</option>",m+="<option value='10'>10</option>",m+="<option value='11'>11</option>",m+="<option value='12'>12</option>",m+="</select>",m+="<select id='year-exp' name='year-exp'>",m+="<option value=''>Año</option>",m+="</select>",m+="</li>",m+="<li class='field-group-item'>",m+="<label for='bank-name'>Banco</label>",m+="<select id='bank-name' name='bank-name'>",m+="<option selected value=''>"+banco+"</option>",m+="</select>",m+="</li>",m+="</ul>",m+="<ul class='field-group'>",m+="<li class='field-group-item'>",m+="<label for='card-number'>N° de Cuenta Destino</label>",m+="<input class='field-medium' id='card-number' name='card-number' maxlength='16' value='"+i+"'/>",m+="</li>",m+=" <li class='field-group-item'>",m+="<label for='card-holder'>Beneficiario</label>",m+="<input class='field-large' id='card-holder' name='card-holder' maxlength='35' type='text' value='"+o+"' />",m+="</li>",m+="</ul>",m+="<ul class='field-group'>",m+="<li class='field-group-item'>",m+="<label for='bank-account-holder-id'>Documento de Identidad</label>",m+="<select id='doc-name' name='doc-name'>",m+="<option selected value='"+tipo_doc+"'>"+tipo_doc+"</option>",m+="<option value='V'>V</option>",m+="<option value='E'>E</option>",m+="<option value='J'>J</option>",m+="<option value='G'>G</option>",m+="</select>",m+="<input class='field-medium' id='bank-account-holder-id' name='bank-account-holder-id' maxlength='14' minlength='5' type='text' value="+id_ext_per+" />",m+="</li>",m+="<li class='field-group-item'>",m+="<label for='card-holder-email'>Correo Electrónico</label>",m+="<input class='field-large' id='card-holder-email' name='card-holder-email' maxlength='30'  type='text' value="+emailCliente+" />",m+="</li>",m+="</ul>",m+="</form>",m+="<div id='msg' banco='"+codBanco+"''></div>",m+="<div class='form-actions'>",m+="<button id='cancelar1' type='reset'>Cancelar</button>",m+="<button id='cambiar'>Modificar</button>",m+="</div>",m+="</div>",$("#content-holder").append(m),$.each(b,function(e,a){var t=a.toString().substring(2,4),i="<option value='"+t+"'>"+a+"</option>";$("#year-exp").append(i)}),t(),$("#cancelar1").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")}),$("#cambiar").click(function(){var t;a(),$("#datos").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3),t=$("#datos");var i=$("#card-number").val();if(cod_ban=i.substr(0,1),banc=!0,"5"!=cod_ban&&"4"!=cod_ban&&(banc=!1,$("#dialog-banco").dialog({title:"Tarjeta inválida",modal:"true",width:"440px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#banco_inv").click(function(){$("#dialog-banco").dialog("close")}),$(this).val("")),1==t.valid()&&1==banc){i=$("#card-number").val();var o,l=$("#card-holder").val(),c=$("#bank-account-holder-id").val(),d=$("#doc-name option:selected").val(),p=d+c,u=$("#card-holder-email").val(),m=($("#bank-name").val(),$("#msg").attr("banco"));n=$("#donor").find(".product-cardnumber").html(),expDate=$("#month-exp").val()+$("#year-exp").val(),$("#selCtaOrigen").attr("style","display:none"),$("#content-holder").children().remove(),o="<div id='progress'>",o+="<ul class='steps'>",o+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",o+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",o+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",o+="</ul>",o+="</div>",o+="<div id='content-holder'>",o+="<h2>Confirmación</h2>",o+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",o+="<tbody>",o+="<tr>",o+="<td class='data-label'><label>Cuenta de Origen</label></td>",o+="<td class='data-reference'>"+r+"<br /><span class='highlight'>"+n+"</span><br /><span class='lighten'>"+s+"</span></td>",o+="</tr>",o+="<tr>",o+="<td class='data-label'><label>Cuenta Destino a Afiliar</label></td>",o+="<td class='data-label'><label>Cuenta Destino a Afiliar</label></td>",o+="<td class='data-reference'>"+l+"<span class='lighten'>( "+u+" )</span><br /> "+p+" <br /><span class='highlight'>"+i+"</span><br /><span class='lighten'>"+banco+"</span></td>",o+="</tr>",o+="</tbody>",o+="</table>",o+="<div class='form-actions'>",o+="<button id='cancelar' type='reset'>Cancelar</button>",o+="<button id='continuar'>Continuar</button>",o+="</div>",o+="</div>",$("#content-holder").append(o),$("#continuar").click(function(){var a=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/adm/modificar",{id_afiliacion:id_afiliacion,nroPlasticoOrigen:e,nroCuentaDestino:i,id_ext_per:p," beneficiario":l,tipoOperacion:"P2C",email:u,banco:m,expDate:expDate,cpo_name:a},function(e){if(0==e.rc){$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps'>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-edit'></span> Modificación de Afiliación</li>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-view'></span> Confirmación</li>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div class='alert-success' id='message'>",a+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación modificada satisfactoriamente",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)}else{var a,t=-344===e.rc?"la fecha de expiracion indicada es incorrecta":"";$("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div class='alert-error' id='message'>",a+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no modificada, "+t,a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)}$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})})}$("#cancelar").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})}),$(".muestraDestino").on("click","#eliminar",function(){var a;tarjeta=$(this).parents(".dashboard-item").attr("card"),id_ext_per=$(this).parents(".dashboard-item").attr("id_ext_per"),nombre=$(this).parents(".dashboard-item").attr("nombre"),emailCliente=$(this).parents(".dashboard-item").attr("emailCliente"),banco=$(this).parents(".dashboard-item").attr("banco"),codBanco=$(this).parents(".dashboard-item").attr("codBanco"),mascara=$("#donor").find(".product-cardnumber").html(),$("#selCtaOrigen").attr("style","display:none"),$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps two-steps'>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",a+="<li class='step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div id='content-holder'>",a+="<h2>Eliminación de Afiliación</h2>",a+="<p>Por favor, verifique los datos de la afiliación que Ud. está a punto de remover.</p>",a+="<table class='receipt' cellpadding='0' cellspacing='0' width='100%'>",a+="<tbody>",a+="<tr>",a+="<td class='data-label'><label>Cuenta de Origen</label></td>",a+="<td class='data-reference'>"+r+"<br /><span class='highlight'>"+mascara+"</span><br /><span class='lighten'>"+o+"</span></td>",a+="</tr>",a+="<tr>",a+="<td class='data-label'><label>Cuenta Destino Afiliada</label></td>",a+="<td class='data-reference'>"+nombre+"<span class='lighten'>("+emailCliente+" )</span><br />"+id_ext_per+"<br /><span class='highlight'>"+tarjeta+"</span><br /><span class='lighten'>"+banco+"</span></td>",a+="</tr>",a+="</tbody>",a+="</table>",a+="<div class='form-actions'>",a+="<button id='cancel' type='reset'>Cancelar</button>",a+="<button id='cont'>Continuar</button>",a+="</div>",a+="</div>",$("#content-holder").append(a),$("#cont").click(function(){var a=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/adm/eliminar",{noTarjeta:e,noCuentaDestino:tarjeta,tipoOperacion:"P2C",cpo_name:a},function(e){var a;0==e.rc?($("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div id='progress'>",a+="<ul class='steps two-steps'>",a+="<li class='step-item completed-step-item'><span aria-hidden='true' class='icon-remove'></span> Eliminación de Afiliación</li>",a+="<li class='step-item current-step-item'><span aria-hidden='true' class='icon-thumbs-up'></span> Finalización</li>",a+="</ul>",a+="</div>",a+="<div class='alert-success' id='message'>",a+="<span aria-hidden='true' class='icon-ok-sign'></span> Afiliación eliminada satisfactoriamente",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a)):($("#progress").attr("style","display:none"),$("#content-holder").children().remove(),a="<div class='alert-error' id='message'>",a+="<span aria-hidden='true' class='icon-cancel-sign'></span> Afiliación no eliminada",a+="</div>",a+="<div class='form-actions'>",a+="<button id='exit'>Finalizar</button>",a+="</div>",$("#content-holder").append(a));$("#exit").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})})}),$("#cancel").click(function(){$(location).attr("href",base_url+"/adm/adm_tdc")})});else{$("#empty-state").children().remove();var n='<div id="empty-state" style="position: static;">';n+="<h2>No se encontraron tarjetas asociadas</h2>",n+="<p>Vuelva a realizar la búsqueda con una tarjeta distinta.</p>",n+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -415px;"></span>',n+="</div>",$("#empty-state").append(n)}})}function a(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("numOnly",function(e,a){var t=/^[a-zA-Z0-9]+$/,i=a.value;return!!t.test(i)});var e=/^[a-zA-Z_áéíóúñ\s]*$/;$("#datos").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:!0,number:!0},"card-holder":{required:!0,pattern:e},"doc-name":{required:!0},"bank-account-holder-id":{number:!0,required:!0,maxlength:14,minlength:5,numOnly:!0},"card-holder-email":{required:!0,email:!0},"month-exp":{required:!0},"year-exp":{required:!0}},messages:{"card-number":"El n° de cuenta destino no puede estar vacío y debe contener solo números.","card-holder":{required:"El beneficiario no puede estar vacío",pattern:"El beneficiario no debe tener caracteres especiales"},"doc-name":"El Tipo de Documento no puede estar vacío.","bank-account-holder-id":{required:"El documento de identidad no puede estar vacío",number:"El documento de identidad debe ser numérico y no debe tener caracteres especiales",minlength:"El documento de identidad debe tener un mínimo de 5 caracteres",numOnly:"El documento de identidad debe ser numérico y no debe tener caracteres especiales"},"card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com).","month-exp":"Seleccione el mes de vencimiento de su tarjeta","year-exp":"Seleccione el año de vencimiento de su tarjeta"}})}function t(){$.ajaxSetup({async:!1});var e=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/affiliation/bancos",{cpo_name:e},function(e){$.each(e.lista,function(e,a){var t;t="<option value="+a.codBcv+"> "+a.nomBanco+" </option>",$("#bank-name").append(t)})})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var e=$("#dashboard-donor");e.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var a=$("#filters-stack .option-set"),t=a.find("a");t.click(function(){var a=$(this);if(a.hasClass("selected"))return!1;var t=a.parents(".option-set");t.find(".selected").removeClass("selected"),a.addClass("selected");var i={},n=t.attr("data-option-key"),o=a.attr("data-option-value");return o="false"!==o&&o,i[n]=o,"layoutMode"===n&&"function"==typeof changeLayoutMode?changeLayoutMode(a,i):e.isotope(i),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var a,t,i,n,o,r;a=$(this).find("img").attr("src"),t=$(this).attr("card"),i=$(this).attr("marca"),n=$(this).attr("mascara"),p=$(this).attr("producto1"),$(this).attr("empresa"),r=$(this).attr("nombre"),$("#donor").children().remove(),o='<div class="product-presentation" producto="'+p+'">',o+='<img src="'+a+'" width="200" height="130" alt="" />',o+='<div class="product-network '+i.toLowerCase()+'"></div>',o+='<input id="donor-cardnumber-origen" name="donor-cardnumber" producto="'+p+'" type="hidden" nombreOrigen="'+r+'" cardOrigen="'+t+'" masCtaOrigen="'+l+'" marcaCtaOrigen="'+i+'"  />',o+="</div>",o+='<div class="product-info-full">',o+='<p class="product-cardholder" id="nombreCtaOrigen">'+r+"</p>",o+='<p class="product-cardnumber" id="mascara">'+n+"</p>",o+='<p class="product-metadata" id="marca">'+p+"</p>",o+='<nav class="product-stack" id="selCtaOrigen">',o+='<ul class="stack">',o+='<li class="stack-item">',o+='<a dialog button product-button rel="section" id="buscarCta" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',o+="</li>",o+="</ul>",o+="</nav>",o+="</div>",$("#donor").append(o),$(".product-button").removeClass("disabled-button"),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close");var s=$("#donor-cardnumber-origen").attr("cardorigen"),l=$("#donor-cardnumber-origen").attr("masCtaOrigen"),c=$("#donor-cardnumber-origen").attr("marcaCtaOrigen"),d=$("#donor-cardnumber-origen").attr("nombreOrigen"),p=$("#donor-cardnumber-origen").attr("producto"),u=$(this).attr("prefix");mes=$("#filter-month").val(),anio=$("#filter-year").val(),$("#buscar").removeClass("disabled-button"),$("#list-detail").children().remove(),e(s,u,l,c,d,p),$(".stack-item").click(function(){$("#dashboard").children().remove(),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}})})}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});