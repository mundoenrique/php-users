var base_url,base_cdn,expDate;base_url=$("body").attr("data-app-url"),base_cdn=$("body").attr("data-app-cdn"),$(function(){function a(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#validate_afiliacion").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"card-number":{required:!0,number:!0,minlength:16},"card-holder-email":{required:!0,email:!0},"month-exp":{required:!0},"year-exp":{required:!0}},messages:{"card-number":"El número de cuenta no puede estar vacío y debe contener 16 números","card-holder-email":"El correo electrónico no puede estar vacío y debe contener formato correcto. (xxxxx@ejemplo.com)","month-exp":"Seleccione el mes de vencimiento de su tarjeta","year-exp":"Seleccione el año de vencimiento de su tarjeta"}})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$(".dialog").click(function(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var a=$("#dashboard-donor");a.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var e=$("#filters-stack .option-set"),i=e.find("a");i.click(function(){var e=$(this);if(e.hasClass("selected"))return!1;var i=e.parents(".option-set");i.find(".selected").removeClass("selected"),e.addClass("selected");var t={},r=i.attr("data-option-key"),o=e.attr("data-option-value");return o="false"!==o&&o,t[r]=o,"layoutMode"===r&&"function"==typeof changeLayoutMode?changeLayoutMode(e,t):a.isotope(t),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")}),$(".dashboard-item").click(function(){var a,e,i,t,r,o,n,l;a=$(this).find("img").attr("src"),e=$(this).attr("card"),i=$(this).attr("marca"),t=$(this).attr("mascara"),r=$(this).attr("producto1"),$(this).attr("empresa"),n=$(this).attr("nombre"),l=$(this).attr("prefix"),$("#donor").children().remove(),o='<div class="product-presentation" producto="'+r+'">',o+='<img src="'+a+'" width="200" height="130" alt="" />',o+='<div class="product-network '+i.toLowerCase()+'"></div>',o+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" producto="'+r+'"  prefix="'+l+'" cardOrigen="'+e+'" />',o+="</div>",o+='<div class="product-info">',o+='<p class="product-cardholder" id="nombreCtaOrigen">'+n+"</p>",o+='<p class="product-cardnumber" id="mascara">'+t+"</p>",o+='<p class="product-metadata" id="marca">'+r+"</p>",o+='<nav class="product-stack">',o+='<ul class="stack">',o+='<li class="stack-item">',o+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',o+="</li>",o+="</ul>",o+="</nav>",o+="</div>",$("#donor").append(o),$(".product-button").removeClass("disabled-button"),$("#month-exp").attr("disabled",!1),$("#year-exp").attr("disabled",!1),$("#card-number").attr("disabled",!1),$("#card-holder").attr("disabled",!1),$("#bank-account-holder-id").attr("disabled",!1),$("#card-holder-email").attr("disabled",!1),$("#afiliar").attr("disabled",!1),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close"),$(".stack-item").click(function(){$("#tdestino").children().remove(),$("#tdestino").append($("#removerDestino").html()),$("#botonContinuar").attr("disabled",!0),$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"940px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}})})}),$("#afiliar").click(function(){a(),$("#validate_afiliacion").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3);var e=$("#validate_afiliacion");if(numeroCta=$("#content-holder").find(".nrocta").val(),email=$("#cargarConfirmacion").find("#ctaAfiliar").attr("email"),1==e.valid()){var i=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),t=JSON.stringify({noTarjeta:numeroCta});t=CryptoJS.AES.encrypt(t,i,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/affiliation/cuentasP2P",{request:t,cpo_name:i,plot:btoa(i)},function(a){if(data=JSON.parse(CryptoJS.AES.decrypt(a.code,a.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),0==data.rc){beneficiario=data.beneficiario,cedula=data.id_ext_per,nombre=$("#donor").find(".product-cardholder").html(),mascara=$("#donor").find(".product-cardnumber").html(),numeroCtaOrigen=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen"),prefix=$("#donor").find("#donor-cardnumber-origen").attr("prefix"),nombreCtaOrigen=$("#donor").find("#nombreCtaOrigen").html(),marca=$("#donor").find("#donor-cardnumber-origen").attr("producto"),email=$("#content-holder").find("#card-holder-email").val(),expDate=$("#month-exp").val()+$("#year-exp").val();var e=new Date;hora=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();var i=e.getDate(),t=e.getMonth()+1,r=e.getFullYear();i<10&&(i="0"+i),t<10&&(t="0"+t);var o=i+"/"+t+"/"+r;datos_afiliacion="<tr>",datos_afiliacion+='<td class="data-label"><label>Cuenta Origen</label></td>',datos_afiliacion+='<td class="data-reference" id="nombreOrigenTransfer" colspan="2" numeroCtaOrigen="'+numeroCtaOrigen+'" nombreCtaOrigen="'+nombre+'" prefix="'+prefix+'" mascara="'+mascara+'" marca="'+marca+'">'+nombre+'<br /><span class="highlight" id="mascaraOrigenTransfer">'+mascara+'</span><br /><span class="lighten"> '+marca+" </span></td>",datos_afiliacion+="</tr>",datos_afiliacion+="<tr>",datos_afiliacion+='<td class="data-label"><label>Cuenta Destino a Afiliar</label></td>',datos_afiliacion+='<td class="data-reference" id="ctaAfiliar" beneficiario="'+beneficiario+'" email="'+email+'" cedula="'+cedula+'" numeroCta="'+numeroCta+'">"'+beneficiario+'" <span class="lighten">("'+email+'")</span><br /> "'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span></td>',datos_afiliacion+="</tr><tr>",$("#cargarConfirmacion").append(datos_afiliacion),$("#content-holder").children().remove(),$("#content-holder").append($("#content-confirmacion").html()),$(".continuar").click(function(){var e=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),i=JSON.stringify({nroPlasticoOrigen:numeroCtaOrigen,beneficiario:beneficiario,nroCuentaDestino:numeroCta,tipoOperacion:"P2P",email:email,cedula:cedula,prefix:prefix,expDate:expDate});i=CryptoJS.AES.encrypt(i,e,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/affiliation/affiliation",{request:i,cpo_name:e,plot:btoa(e)},function(e){if(e=JSON.parse(CryptoJS.AES.decrypt(a.code,a.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),0==e.rc||-188==e.rc)datos_finalizacion="<tr>",datos_finalizacion+='<td class="data-label"><label>Fecha de Operación</label></td>',datos_finalizacion+='<td class="data-reference">'+o+" "+hora+" </td>",datos_finalizacion+="</tr>",datos_finalizacion+="<tr>",datos_finalizacion+='<td class="data-label"><label>Cuenta de Origen</label></td>',datos_finalizacion+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br /> <span class="lighten"> "'+marca+'" </span> </td>',datos_finalizacion+="</tr>",datos_finalizacion+="<tr>",datos_finalizacion+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>',datos_finalizacion+='<td class="data-reference">"'+beneficiario+'"<span class="lighten">("'+email+'")</span><br />"'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span><br /></td>',datos_finalizacion+="</tr>",$("#cargarFinalizacion").append(datos_finalizacion),$("#content-holder").children().remove(),0==e.rc?$("#content-holder").append($("#content-finalizar").html()):($("#content-holder").append($("#content-finalizar2").html()),$("#cargarFinalizacion3").append(datos_finalizacion));else if(-178==e.rc||-344==e.rc){var i;$("#dialog-error-afil3").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,t){$(".ui-dialog-titlebar-close",t.dialog).hide(),i=-178===e.rc?"No se puede realizar el registro. <strong>Cuenta ya afiliada.</strong>":"La fecha de vencimiento indicada es incorrecta",$("#msgNon").html(i)}}),$("#invalido5").click(function(){$("#dialog-error-afil3").dialog("close"),$(location).attr("href",base_url+"/affiliation")})}else-210==e.rc?($("#dialog-error-afil").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido2").click(function(){$("#dialog-error-afil").dialog("close"),$(location).attr("href",base_url+"/affiliation")})):(datos_finalizacion="<tr>",datos_finalizacion+='<td class="data-label"><label>Fecha de Operación</label></td>',datos_finalizacion+='<td class="data-reference">'+o+" "+hora+" </td>",datos_finalizacion+="</tr>",datos_finalizacion+="<tr>",datos_finalizacion+='<td class="data-label"><label>Cuenta de Origen</label></td>',datos_finalizacion+='<td class="data-reference">"'+nombreCtaOrigen+'"<br /><span class="highlight">"'+mascara+'"</span><br/> <span class="lighten"> "'+marca+'" </span> </td>',datos_finalizacion+="</tr>",datos_finalizacion+="<tr>",datos_finalizacion+='<td class="data-label"><label>Cuenta Destino Afiliada</label></td>',datos_finalizacion+='<td class="data-reference">"'+beneficiario+'"<span class="lighten">("'+email+'")</span><br />Documento de Identidad "'+cedula+'"<br /><span class="highlight">"'+numeroCta+'"</span><br /></td>',datos_finalizacion+="</tr>",$("#cargarFinalizacion2").append(datos_finalizacion),$("#content-holder").children().remove(),$("#content-holder").append($("#content-finalizar3").html()))})})}else-221==data.rc?($("#dialog-error-afil1").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido3").click(function(){$("#dialog-error-afil1").dialog("close"),$(location).attr("href",base_url+"/affiliation")})):($("#dialog-error-afil2").dialog({title:"Error Afiliación",modal:"true",width:"440px",open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}}),$("#invalido4").click(function(){$("#dialog-error-afil2").dialog("close"),$(location).attr("href",base_url+"/dashboard")}))})}})});