var base_url,base_cdn,ctasDestino,moneda,pais,editCard,numberBeneficiary=[3,2,1],totalTrans,saldoDisp,transferNumber,montoMinOperaciones,montoMaxOperaciones,montoAcumMensual,montoMaxMensual,montoAcumSemanal,montoMaxSemanal,montoAcumDiario,montoMaxDiario,acumCantidadOperacionesMensual,cantidadOperacionesMensual,acumCantidadOperacionesSemanales,cantidadOperacionesSemanales,acumCantidadOperacionesDiarias,cantidadOperacionesDiarias,montoComision,nameSource,maskSource,sourceNumber,brand,destination={},dobleAutenticacion,operationType,expDate,country;$("#cargandoInfo").hide();base_url=$("body").attr("data-app-url");base_cdn=$("body").attr("data-app-cdn");country=$("body").data("country");$(function(){$("#tabs-menu").show();$("#content_plata").show();moneda=$("#donor").attr("moneda");$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")})});function modalCtasOrigen(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"950px",open:function(a,b){$(".ui-dialog-titlebar-close",b.dialog).hide()}});$("#cerrar").click(function(){$("#content-product").dialog("close")})}function normaliza(d){var c="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç";var b="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc";for(var a=0;a<c.length;a++){d=d.replace(c.charAt(a),b.charAt(a))}return d}function changeDecimals(b){var a;a=b.toFixed(2);if(pais=="Ve"||pais=="Co"){a=a.replace(".",",")}return a}function validar_campos(a){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("tokenValid",function(d,c){var e=/^[a-zA-Z0-9]+$/,b=c.value;if(e.test(b)){return true}else{return false}});+jQuery.validator.addMethod("onlyLetters",function(d,c){var e=/^[A-Za-z0-9\s]+$/,b=c.value;if(e.test(b)){return true}else{return false}});jQuery.validator.addMethod("amountAvailable",function(d,c){var b=parseFloat(c.value);if(b>saldoVerifica){return false}else{return true}});jQuery.validator.addMethod("amountsValue",function(d,c){var b=parseFloat(c.value);if(b<montoMinOperaciones||b>=montoMaxOperaciones){return false}else{return true}});jQuery.validator.addMethod("amountDay",function(e,d){var c=parseFloat(d.value);var b=montoAcumDiario+c;if(b>=montoMaxDiario){return false}else{return true}});jQuery.validator.addMethod("amountWeek",function(e,d){var c=parseFloat(d.value);var b=montoAcumSemanal+c;if(b>=montoMaxSemanal){return false}else{return true}});jQuery.validator.addMethod("amountMonth",function(e,d){var c=parseFloat(d.value);var b=montoAcumMensual+c;if(b>=montoMaxMensual){return false}else{return true}});jQuery.validator.addMethod("trxDay",function(d,c){var b=acumCantidadOperacionesDiarias+1;if(b>cantidadOperacionesDiarias){return false}else{return true}});jQuery.validator.addMethod("trxWeek",function(d,c){var b=acumCantidadOperacionesSemanales+1;if(b>cantidadOperacionesSemanales){return false}else{return true}});jQuery.validator.addMethod("trxMonth",function(e,c){var d=c.value;var b=acumCantidadOperacionesMensual+1;if(b>cantidadOperacionesMensual){return false}else{return true}});$("#form-search").validate({errorElement:"label",ignore:".ignore",errorContainer:"#msg-history",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg-history",rules:{telefonoDestino:{number:true,required:true,minlength:9,maxlength:9}},messages:{telefonoDestino:{required:"El número de teléfono no puede estar vacío",number:"El teléfono debe ser numérico y no debe tener caracteres especiales",minlength:"El número de teléfono debe tener un mínimo de 7 caracteres",maxlength:"El número de teléfono debe tener un máximo de 7 caracteres",numOnly:"El teléfono debe ser numérico y no debe tener caracteres especiales",}},submitHandler:function(c){var b={telefonoDestino:$("#telefonoDestino").val()};var d=$.param(b);$.ajax({url:base_url+"/transferencia/peGeneral",type:"post",data:{data:d,model:"AccountPhone"},datatype:"JSON",success:function(e){switch(e.code){case 0:$("select").empty();$("#ctaDestino").append('<option value="" selected>Seleccione una cuenta</option>');$.each(e.phone,function(f,g){$("#ctaDestino").append($("<option>",{value:g.noTarjeta,text:g.noTarjetaConMascara}))});$("#form-trx").find("input, textarea, button, select").attr("disabled",false);$("#continuar").attr("disabled",false);break;case 1:$("#telefonoDestino").val("");msgService(e.title,e.msg,"alert-warning",0);break}}})}});$("#form-trx").validate({errorElement:"label",ignore:".ignore",errorContainer:"#msg-history",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg-history",rules:{descripcion:{required:true,minlength:4,maxlength:30,onlyLetters:true},monto:{number:true,required:true,amountAvailable:true,amountsValue:true,amountDay:true,amountWeek:true,amountMonth:true},ctaDestinoText:{number:true,required:true,minlength:16,maxlength:16},ctaDestino:{required:true},opeMax:{required:true,trxDay:true,trxWeek:true,trxMonth:true},},messages:{descripcion:{required:"El campo descripción no puede estar vacio",minlength:"El campo descripción debe contener mínimo 4 caracteres",maxlength:"El campo descripción debe contener máximo 30 caracteres",onlyLetters:"Este campo no puede contener caracteres especiales."},opeMax:{trxDay:"Se ha superado la cantidad máxima de transacciones diarias, ha realizado: "+acumCantidadOperacionesDiarias+" transacciones",trxWeek:"Se ha superado la cantidad máxima de transacciones semanales, ha realizado: "+acumCantidadOperacionesSemanales+" transacciones",trxMonth:"Se ha superado la cantidad máxima de transacciones mensuales, ha realizado: "+acumCantidadOperacionesMensual+" transacciones",},monto:{required:"El campo monto no puede estar vacio",amountAvailable:"El monto de la transferencia excede su saldo disponible",number:"El campo monto debe ser numérico y no debe tener caracteres especiales",amountsValue:"El monto mínimo de la transacción debe ser "+moneda+". "+montoMinOperaciones+" y el máximo "+moneda+". "+montoMaxOperaciones+"",amountDay:"El monto máximo diario que puede transferir es: "+moneda+". "+montoMaxDiario+",  hoy a transferido: "+moneda+". "+montoAcumDiario,amountWeek:"El monto máximo semanal que puede transferir es: "+moneda+". "+montoMaxSemanal+", esta semana a transferido: "+moneda+". "+montoAcumSemanal,amountMonth:"El monto máximo mensual que puede transferir es: "+moneda+". "+montoMaxMensual+", este mes a transferido: "+moneda+". "+montoAcumMensual,},ctaDestinoText:{required:"El campo tarjeta no puede estar vacio",number:"El campo tarjeta debe ser numérico y no debe tener caracteres especiales",minlength:"El campo tarjeta debe contener 16 dígitos",maxlength:"El campo tarjeta debe contener 16 dígitos",},ctaDestino:{required:"El campo tarjeta no puede estar vacio",},},submitHandler:function(c){$("#progress > ul > li	:nth-child(2)").removeClass("current-step-item").addClass("completed-step-item");var d=($("#ctaDestinoText").val()==="")?$("#ctaDestino").val():$("#ctaDestinoText").val();var b=d.substring(0,6);var e=d.substring(12,16);d=b+"******"+e;$("#conDescripcion").html($("#descripcion").val());$("#conMonto, #conMonto2").html($("#monto").val());$("#conCtaOrigen").html($("#donor").find(".product-cardnumber").html());$("#conCtaDestino").html(d);$("#progress > ul > li:nth-child(1)").addClass("completed-step-item");$("#progress > ul > li:nth-child(2)").addClass("current-step-item");$("#confirmTrxValues").show();$("#transfer-date").hide();$("#continuar").attr("action","form-trx")}});$("#form-pin").validate({errorElement:"label",ignore:"",errorContainer:"#msg-history2",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg-history2",rules:{pin:{required:true,tokenValid:true},},messages:{pin:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no puede tener caracteres especiales",},},submitHandler:function(c){var b={ctaOrigen:$("#ctaOrigen").val(),ctaDestino:$("#ctaDestino").val(),monto:$("#monto").val(),descripcion:$("#descripcion").val(),pin:($("#pin").val())};var d=$.param(b);makeTransferPe(d,1)},})}function makeTransferPe(b,a){$.ajax({url:base_url+"/transfererencia/transferPe",type:"post",data:{data:b,token:a},dataType:"json",beforeSend:function(d,c){cleanBefore()},success:function(c){cleanComplete();switch(c.code){case 0:$("#progress > ul > li:nth-child(3)").removeClass("current-step-item").addClass("completed-step-item");$("#transfer-date").hide();$("#confirmTrxValues").hide();$("#pinDiv").hide();$("#confirmacion").show();$("#conCtaOrigenTrx").html(c.ctaOrigenMascara);$("#conCtaDestinoTrx").html(c.ctaDestinoMascara);$("#montoConfirm").html(c.monto);$("#conNombreOrigen").html(c.nombreCuentaOrigen);$("#conNombreDestino").html(c.nombreCuentaDestino);$("#conDescripcionTrx").html(c.descripcion);$("#finalTrx").show();$("#buttonTrx").hide();break;case 1:$("#pinDiv").show();$("#transfer-date").hide();$("#confirmTrxValues").hide();$("#continuar").attr("action","form-pin");$("#ctaOrigen").val();$("#ctaDestino").val();$("#monto").val();$("#descripcion").val();break;case 2:$("#msgInfoPin").addClass("pinError");$("#msgInfoPin").html("El PIN ingresado no coincide o ha caducado, verifique e intente nuevamente.");$("#pin").addClass("field-error").removeClass("field-success");$("#pin").val("");break;case 3:msgService(c.title,c.msg,"alert-error",1);break;case 4:$(location).attr("href",base_url+"../users/error_gral");break;default:msgService(c.title,c.msg,"alert-error",1);break}}})}function msgService(c,b,a,d){$("#registrar").fadeIn();$("#dialogo-movil").dialog({title:c,modal:"true",resizable:false,closeOnEscape:false,draggable:false,width:"440px",open:function(e,f){$(".ui-dialog-titlebar-close",f.dialog).hide();$("#modalType").addClass(a);$("#msgService").html(b)}});$("#inva5").click(function(){$("#dialogo-movil").dialog("close");if(d==1){$(location).attr("href",base_url+"/transferencia/pe")}})}function cleanBefore(){$("#cargandoInfo").show();$("#continuar").hide()}function cleanComplete(){$("#cargandoInfo").hide();$("#continuar").show()};