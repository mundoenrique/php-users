function viewSelect(e){var o,r,a,c,t,n=$("#lock-acount select, #lock-acount input, #continuar"),s="block",l=$("#bloqueo-cuenta");switch("key"==e&&(n=$("#change-key input, #change-key select, #continuar"),l=$("#cambio-pin"),s="change"),"recover"==e&&(n=$("#rec-key input, #continuar"),l=$("#recover-key"),s="rec"),viewControl!=e&&(n.prop("disabled",!1),resetForms(l),cleanComplete(s),$("#sendToken").remove()),viewControl=e,e){case"lock":$("#msg-block h2").text(bloqAction+"cuenta"),o=$("#lock"),r=$("#key, #replace, #recover"),a=$("#change-key, #reason-rep, #rec-key"),c=$("#lock-acount, #prevent-bloq"),$("#mot-sol").prop("disabled",!0),t="lockAccoun",$("#action").text(bloqAction);break;case"key":$("#msg-change h2").text("Cambio de PIN"),o=$("#key"),r=$("#lock, #replace, #recover"),a=$("#lock-acount, #rec-key"),c=$("#change-key"),t="changePin";break;case"replace":$("#msg-block h2").text("Solicitud de reposición"),o=$("#replace"),r=$("#lock, #key, #recover"),a=$("#change-key, #prevent-bloq, #rec-key"),c=$("#lock-acount, #reason-rep"),t="lockReplace";break;case"recover":$("#msg-rec h2").text("Solicitud de reposición de PIN"),o=$("#recover"),r=$("#lock, #key, #replace"),a=$("#lock-acount, #change-key, #reason-rep"),c=$("#rec-key, #rec-clave"),t="recoverKey"}o.removeClass("service-item-unselect").addClass("service-item-select"),r.removeClass("service-item-select").addClass("service-item-unselect"),a.hide(),c.show(950),$("#continuar").attr("data-action",t)}function lock_change(e,o,r,a){var c,t="LockAccount"==o?"block":"change",n=1,s="LockAccount"==o?"lock-acount":"change-key";"recoverKey"==a&&(t="rec",s="recoverKey");var l=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),i=JSON.stringify({formData:e,model:o});i=CryptoJS.AES.encrypt(i,l,{format:CryptoJSAesJson}).toString(),$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{request:i,cpo_name:l,plot:btoa(l)},datatype:"JSON",beforeSend:function(e,o){cleanBefore(t,s)},success:function(e){switch(data=JSON.parse(CryptoJS.AES.decrypt(e.code,e.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),cleanComplete(t),data.code){case 0:notiSystem(data.title,data.msg,"success","out",r);break;case 1:notiService(data.msg,"msg-lock-error","msg-lock-success",t),"lock-acount"==s?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").prop("disabled",!1),"lockAccoun"==a&&$("#mot-sol").prop("disabled",!0);break;case 2:notiService(data.msg,"msg-lock-error","msg-lock-success",t),"lock-acount"==s?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0);break;case 3:notiSystem(data.title,data.msg,"warning","out",r);break;case 4:c=void 0!==data.cost_repos_plas&&""!==data.cost_repos_plas?data.cost_repos_plas:"",viewToken(data.msg,t,c,n);break;case 5:notiService(data.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(t),$("#msg-block div").unbind("click")});break;case 6:n=0,costo=void 0!==data.cost_repos_plas&&""!==data.cost_repos_plas?data.cost_repos_plas:"",viewToken(data.msg,t,costo,n);break;default:notiSystem(data.title,data.msg,"error","close",r)}},error:function(e,o,r){console.log(e),console.log(o),console.log(r)}})}function getToken(e){var o=1;$("#carry").remove();var r=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),a=JSON.stringify({model:"GetToken"});a=CryptoJS.AES.encrypt(a,r,{format:CryptoJSAesJson}).toString(),$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{request:a,cpo_name:r,plot:btoa(r)},datatype:"json",beforeSend:function(e,o){cleanBefore("block")},success:function(r){switch(data=JSON.parse(CryptoJS.AES.decrypt(r.code,r.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),cleanComplete("block"),data.code){case 4:viewToken(data.msg,e,"",o);break;case 5:notiService(data.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(e),$("#msg-block div").unbind("click")});break;case 2:notiSystem(data.title,data.msg,"warning","out");break;default:notiSystem(data.title,data.msg,"error","close")}},error:function(e,o,r){console.log(e),console.log(o),console.log(r)}})}function cleanBefore(e,o){"lock-acount"==o?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0),$("#msg-"+e).removeClass("msg-lock-error msg-lock-success"),$("#msg-"+e+" #result-"+e).html("").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 50px;"></span>'),$("#msg-"+e+" h3").text("Estamos procesando tu solicitud"),$("#msg-"+e).show()}function cleanComplete(e){$("#msg-"+e+" h3").text(""),$("#msg-"+e+" #result-"+e).html("")}function notiService(e,o,r,a){resetForms(),$("#msg-"+a).removeClass(r).addClass(o),$("#msg-"+a+" > h3").html(e)}function notiSystem(e,o,r,a,c){var t="lock"===c||"key"===c||"replace"===c||"recover"===c?c:null,n="lock"!=c&&"key"!=c&&"replace"!=c&&"recover"!=c?c:null;resetForms(n);var s=$("#msg_system");s.dialog({title:e,modal:"true",width:"440px",draggable:!1,rezise:!1,open:function(e,r){$(".ui-dialog-titlebar-close",r.dialog).hide(),"carry"==a?($("#form-action").append('<button id="carry" class="novo-btn-primary">Si</button>'),$("#close-info").addClass("novo-btn-secondary-modal"),$("#carry").focus(),$("#close-info").text("No").attr("type","reset")):$("#close-info").text("Cerrar").removeAttr("type"),$("#msg_info p").empty().append(o)}}),$("#close-info").on("click",function(e){switch(e.preventDefault(),$("#msg_system").dialog("close"),a){case"out":$(location).attr("href",base_url+"/servicios");break;case"close":$(location).attr("href",base_url+"/users/closeSess")}$("#carry").remove()}),$("#carry").on("click",function(e){e.preventDefault(),$("#msg_system").dialog("close"),viewSelect(t),$("#carry").remove()})}function viewToken(e,o,r,a){var c="";notiService(e,"msg-lock-success","msg-lock-error",o),"block"==o?$("#lock-acount input, #lock-acount select, #continuar").not("#mes-exp-bloq, #anio-exp-bloq, #mot-sol").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").not("#mes-exp-cambio, #anio-exp-cambio, #pin-current, #new-pin, #confirm-pin").prop("disabled",!1),1===a&&(c+='<li id="sendToken" class="col-md-3-profile">',c+='<label for="token">Código de seguridad</label>',c+='<input class="field-medium" id="token" name="token" type="text">',c+="</li>"),""!==r&&($("#montoComisionTransaccion").val(r),c+='<table class="receipt" cellspacing="0" cellpadding="0"><tr><td class="data-metadata">Comisión/Pago (S/. '+r+') <br><span class="money-amount">S/. '+r+"</span></td></tr></table>"),$("#"+o+"-ul").append(c)}function validar_campos(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("tokenValid",function(e,o){var r=/^[a-zA-Z0-9]+$/,a=o.value;return!!r.test(a)}),jQuery.validator.addMethod("pinNew1",function(e,o){return o.value.length>0&&o.value==$("#new-pin").val()},"Debe ser igual al nuevo PIN"),jQuery.validator.addMethod("pinNew2",function(e,o){return!(o.value.length>0&&o.value==$("#pin-current").val())},"El nuevo PIN no debe ser igual a su PIN anterior"),$("#bloqueo-cuenta").validate({errorElement:"label",ignore:"",errorContainer:"#msg1",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg1",rules:{token:{required:!0,tokenValid:!0},"mot-sol":{required:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"mot-sol":"Debe seleccionar el motivo de la reposición"}}),$("#cambio-pin").validate({errorElement:"label",ignore:"",errorContainer:"#msg2",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg2",rules:{token:{required:!0,tokenValid:!0},"pin-current":{required:!0,number:!0,minlength:4},"new-pin":{number:!0,pinNew2:!0,required:!0,minlength:4},"confirm-pin":{number:!0,pinNew1:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"pin-current":{required:"Debe colocar su PIN actual",number:"Debe ser numérico",minlength:"El PIN debe tener 4 digitos"},"new-pin":{number:"Su nuevo PIN debe ser numérico",pinNew2:"El nuevo PIN no debe ser igual a su PIN anterior",required:"Debe colocar su nuevo PIN",minlength:"El nuevo PIN debe tener 4 digitos"},"confirm-pin":{number:"La confirmación de su nuevo PIN debe ser numérico",pinNew1:"Debe ser igual a su nuevo PIN"}}}),$("#recover-key").validate({errorElement:"label",ignore:"",errorContainer:"",errorClass:"field-error",validClass:"field-success",errorLabelContainer:""})}function resetForms(e){e&&e[0].reset(),$("#msg1, #msg2").children().remove(),$("#bloqueo-cuenta *, #cambio-pin *").children().removeClass("field-success field-error")}