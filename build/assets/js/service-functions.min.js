function viewSelect(id){var disable=$("#lock-acount select, #lock-acount input, #continuar"),clean="block",into,leave,conceal,display,action,formData=$("#bloqueo-cuenta");switch("key"==id&&(disable=$("#change-key input, #change-key select, #continuar"),formData=$("#cambio-pin"),clean="change"),"recover"==id&&(disable=$("#rec-key input, #continuar"),formData=$("#recover-key"),clean="rec"),viewControl!=id&&(disable.prop("disabled",!1),resetForms(formData),cleanComplete(clean),$("#sendToken").remove()),viewControl=id,id){case"lock":$("#msg-block h2").text(bloqAction+"cuenta"),into=$("#lock"),leave=$("#key, #replace"),conceal=$("#change-key, #reason-rep"),display=$("#lock-acount, #prevent-bloq"),$("#mot-sol").prop("disabled",!0),action="lockAccoun",$("#action").text(bloqAction);break;case"key":$("#msg-change h2").text("Cambio de PIN"),into=$("#key"),leave=$("#lock, #replace"),conceal=$("#lock-acount"),display=$("#change-key"),action="changePin";break;case"replace":$("#msg-block h2").text("Solicitud de reposición"),into=$("#replace"),leave=$("#key, #lock"),conceal=$("#change-key, #prevent-bloq"),display=$("#lock-acount, #reason-rep"),action="lockReplace";break;case"recover":$("#msg-rec h2").text("Solicitud de reposición de PIN"),into=$("#recover"),leave=$("#key, #replace"),conceal=$("#change-key, #reason-rep"),display=$("#rec-key, #rec-clave"),action="recoverKey"}into.removeClass("service-item-unselect").addClass("service-item-select"),leave.removeClass("service-item-select").addClass("service-item-unselect"),conceal.hide(),display.show(950),$("#continuar").attr("data-action",action)}function lock_change(formData,model,form,action){var msgMain="LockAccount"==model?"block":"change",token=1,msgSec="LockAccount"==model?"lock-acount":"change-key",costo_repo;"recoverKey"==action&&(msgMain="rec",msgSec="recoverKey");var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),dataRequest=JSON.stringify({formData:formData,model:model});dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},datatype:"JSON",beforeSend:function(xrh,status){cleanBefore(msgMain,msgSec)},success:function(response){switch(data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),cleanComplete(msgMain),data.code){case 0:notiSystem(data.title,data.msg,"success","out",form);break;case 1:notiService(data.msg,"msg-lock-error","msg-lock-success",msgMain),"lock-acount"==msgSec?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").prop("disabled",!1),"lockAccoun"==action&&$("#mot-sol").prop("disabled",!0);break;case 2:notiService(data.msg,"msg-lock-error","msg-lock-success",msgMain),"lock-acount"==msgSec?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0);break;case 3:notiSystem(data.title,data.msg,"warning","out",form);break;case 4:costo_repo=void 0!==data.cost_repos_plas&&""!==data.cost_repos_plas?data.cost_repos_plas:"",viewToken(data.msg,msgMain,costo_repo,token);break;case 5:notiService(data.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(msgMain),$("#msg-block div").unbind("click")});break;case 6:token=0,costo=void 0!==data.cost_repos_plas&&""!==data.cost_repos_plas?data.cost_repos_plas:"",viewToken(data.msg,msgMain,costo,token);break;default:notiSystem(data.title,data.msg,"error","close",form)}},error:function(xrh,status,obj){console.log(xrh),console.log(status),console.log(obj)}})}function getToken(msgMain){var token=1;$("#carry").remove();var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),dataRequest=JSON.stringify({model:"GetToken"});dataRequest=CryptoJS.AES.encrypt(dataRequest,cpo_cook,{format:CryptoJSAesJson}).toString(),$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{request:dataRequest,cpo_name:cpo_cook,plot:btoa(cpo_cook)},datatype:"json",beforeSend:function(xrh,status){cleanBefore("block")},success:function(response){switch(data=JSON.parse(CryptoJS.AES.decrypt(response.code,response.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),cleanComplete("block"),data.code){case 4:viewToken(data.msg,msgMain,"",1);break;case 5:notiService(data.msg,"msg-lock-error","msg-lock-success","block"),$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(msgMain),$("#msg-block div").unbind("click")});break;case 2:notiSystem(data.title,data.msg,"warning","out");break;default:notiSystem(data.title,data.msg,"error","close")}},error:function(xrh,status,obj){console.log(xrh),console.log(status),console.log(obj)}})}function cleanBefore(msgMain,msgSec){"lock-acount"==msgSec?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",!0):$("#change-key input, #change-key select, #continuar").prop("disabled",!0),$("#msg-"+msgMain).removeClass("msg-lock-error msg-lock-success"),$("#msg-"+msgMain+" #result-"+msgMain).html("").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 50px;"></span>'),$("#msg-"+msgMain+" h3").text("Estamos procesando tu solicitud"),$("#msg-"+msgMain).show()}function cleanComplete(msgMain){$("#msg-"+msgMain+" h3").text(""),$("#msg-"+msgMain+" #result-"+msgMain).html("")}function notiService(msg,NewClass,oldClass,msgMain){resetForms(),$("#msg-"+msgMain).removeClass(oldClass).addClass(NewClass),$("#msg-"+msgMain+" > h3").html(msg)}function notiSystem(title,message,type,action,param){var id="lock"===param||"key"===param||"replace"===param?param:null,form;resetForms("lock"!=param&&"key"!=param&&"replace"!=param?param:null);var icon="warning"==type?"warning":"error"==type?"cancel":"ok",msgSystem;$("#msg_system").dialog({title:title,modal:"true",width:"440px",draggable:!1,rezise:!1,open:function(event,ui){$(".ui-dialog-titlebar-close",ui.dialog).hide(),"carry"==action?($("#form-action").append('<button id="carry">Si</button>'),$("#carry").focus(),$("#close-info").text("No").attr("type","reset")):$("#close-info").text("Cerrar").removeAttr("type"),$("#msg_info").removeAttr("class").addClass("alert-simple alert-"+type),$("#msg_info span").removeAttr("class").addClass("icon-"+icon+"-sign"),$("#msg_info p").empty().append(message)}}),$("#close-info").on("click",function(e){switch(e.preventDefault(),$("#msg_system").dialog("close"),action){case"out":$(location).attr("href",base_url+"/servicios");break;case"close":$(location).attr("href",base_url+"/users/closeSess")}$("#carry").remove()}),$("#carry").on("click",function(e){e.preventDefault(),$("#msg_system").dialog("close"),viewSelect(id),$("#carry").remove()})}function viewToken(msg,msgMain,costoReposicion,token){var sendToken="";notiService(msg,"msg-lock-success","msg-lock-error",msgMain),"block"==msgMain?$("#lock-acount input, #lock-acount select, #continuar").not("#mes-exp-bloq, #anio-exp-bloq, #mot-sol").prop("disabled",!1):$("#change-key input, #change-key select, #continuar").not("#mes-exp-cambio, #anio-exp-cambio, #pin-current, #new-pin, #confirm-pin").prop("disabled",!1),1===token&&(sendToken+='<li id="sendToken" class="col-md-3-profile">',sendToken+='<label for="token">Código de seguridad</label>',sendToken+='<input class="field-medium" id="token" name="token" type="text">',sendToken+="</li>"),""!==costoReposicion&&($("#montoComisionTransaccion").val(costoReposicion),sendToken+='<table class="receipt" cellspacing="0" cellpadding="0"><tr><td class="data-metadata">Comisión/Pago (S/. '+costoReposicion+') <br><span class="money-amount">S/. '+costoReposicion+"</span></td></tr></table>"),$("#"+msgMain+"-ul").append(sendToken)}function validar_campos(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),jQuery.validator.addMethod("tokenValid",function(value,element){var regEx=/^[a-zA-Z0-9]+$/,token=element.value;return!!regEx.test(token)}),jQuery.validator.addMethod("pinNew1",function(value,element){return element.value.length>0&&element.value==$("#new-pin").val()},"Debe ser igual al nuevo PIN"),jQuery.validator.addMethod("pinNew2",function(value,element){return!(element.value.length>0&&element.value==$("#pin-current").val())},"El nuevo PIN no debe ser igual a su PIN anterior"),$("#bloqueo-cuenta").validate({errorElement:"label",ignore:"",errorContainer:"#msg1",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg1",rules:{token:{required:!0,tokenValid:!0},"mot-sol":{required:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"mot-sol":"Debe seleccionar el motivo de la reposición"}}),$("#cambio-pin").validate({errorElement:"label",ignore:"",errorContainer:"#msg2",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg2",rules:{token:{required:!0,tokenValid:!0},"pin-current":{required:!0,number:!0},"new-pin":{number:!0,pinNew2:!0,required:!0},"confirm-pin":{number:!0,pinNew1:!0}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"pin-current":{required:"Debe colocar su PIN actual",number:"Debe ser numérico"},"new-pin":{number:"Su nuevo PIN debe ser numérico",pinNew2:"El nuevo PIN no debe ser igual a su PIN anterior",required:"Debe colocar su nuevo PIN"},"confirm-pin":{number:"La confirmación de su nuevo PIN debe ser numérico",pinNew1:"Debe ser igual a su nuevo PIN"}}}),$("#recover-key").validate({errorElement:"label",ignore:"",errorContainer:"",errorClass:"field-error",validClass:"field-success",errorLabelContainer:""})}function resetForms(formData){formData&&formData[0].reset(),$("#msg1, #msg2").children().remove(),$("#bloqueo-cuenta *, #cambio-pin *").children().removeClass("field-success field-error")}