function viewSelect(a){var e=$("#lock-acount select, #lock-acount input, #continuar"),g="block",d,i,h,f,c,b=$("#bloqueo-cuenta");if(a=="key"){e=$("#change-key input, #change-key select, #continuar");b=$("#cambio-pin");g="change"}if(a=="recover"){e=$("#rec-key input, #continuar");b=$("#recover-key");g="rec"}if(viewControl!=a){e.prop("disabled",false);resetForms(b);cleanComplete(g);$("#sendToken").remove()}viewControl=a;switch(a){case"lock":$("#msg-block h2").text(bloqAction+"cuenta");d=$("#lock");i=$("#key, #replace");h=$("#change-key, #reason-rep");f=$("#lock-acount, #prevent-bloq");$("#mot-sol").prop("disabled",true);c="lockAccoun";$("#action").text(bloqAction);break;case"key":$("#msg-change h2").text("Cambio de PIN");d=$("#key");i=$("#lock, #replace");h=$("#lock-acount");f=$("#change-key");c="changePin";break;case"replace":$("#msg-block h2").text("Solicitud de reposición");d=$("#replace");i=$("#key, #lock");h=$("#change-key, #prevent-bloq");f=$("#lock-acount, #reason-rep");c="lockReplace";break;case"recover":$("#msg-rec h2").text("Solicitud de reposición de PIN");d=$("#recover");i=$("#key, #replace");h=$("#change-key, #reason-rep");f=$("#rec-key, #rec-clave");c="recoverKey";break}d.removeClass("service-item-unselect").addClass("service-item-select");i.removeClass("service-item-select").addClass("service-item-unselect");h.hide();f.show(950);$("#continuar").attr("data-action",c)}function lock_change(h,b,d,g){var f=(b=="LockAccount")?"block":"change";var c=1;var a=(b=="LockAccount")?"lock-acount":"change-key";var e;if(g=="recoverKey"){f="rec";a="recoverKey"}$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{data:h,model:b},datatype:"JSON",beforeSend:function(j,i){cleanBefore(f,a)},success:function(i){cleanComplete(f);switch(i.code){case 0:notiSystem(i.title,i.msg,"success","out",d);break;case 1:notiService(i.msg,"msg-lock-error","msg-lock-success",f);(a=="lock-acount")?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",false):$("#change-key input, #change-key select, #continuar").prop("disabled",false);(g=="lockAccoun")?$("#mot-sol").prop("disabled",true):"";break;case 2:notiService(i.msg,"msg-lock-error","msg-lock-success",f);(a=="lock-acount")?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",true):$("#change-key input, #change-key select, #continuar").prop("disabled",true);break;case 3:notiSystem(i.title,i.msg,"warning","out",d);break;case 4:e=(typeof i.cost_repos_plas!=="undefined"&&i.cost_repos_plas!=="")?i.cost_repos_plas:"";viewToken(i.msg,f,e,c);break;case 5:notiService(i.msg,"msg-lock-error","msg-lock-success","block");$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(f);$("#msg-block div").unbind("click")});break;case 6:c=0;costo=(typeof i.cost_repos_plas!=="undefined"&&i.cost_repos_plas!=="")?i.cost_repos_plas:"";viewToken(i.msg,f,costo,c);break;default:notiSystem(i.title,i.msg,"error","close",d)}},error:function(j,i,k){console.log(j);console.log(i);console.log(k)}})}function getToken(b){var a=1;$("#carry").remove();$.ajax({url:base_url+"/servicios/modelo",type:"POST",data:{model:"GetToken"},datatype:"json",beforeSend:function(d,c){cleanBefore("block")},success:function(c){cleanComplete("block");switch(c.code){case 4:viewToken(c.msg,b,"",a);break;case 5:notiService(c.msg,"msg-lock-error","msg-lock-success","block");$("#msg-block div").html("Presione <strong>Aquí</strong> para recibir un nuevo código de seguridad").on("click",function(){getToken(b);$("#msg-block div").unbind("click")});break;case 2:notiSystem(c.title,c.msg,"warning","out");break;default:notiSystem(c.title,c.msg,"error","close")}},error:function(d,c,e){console.log(d);console.log(c);console.log(e)}})}function cleanBefore(b,a){(a=="lock-acount")?$("#lock-acount input, #lock-acount select, #continuar").prop("disabled",true):$("#change-key input, #change-key select, #continuar").prop("disabled",true);$("#msg-"+b).removeClass("msg-lock-error msg-lock-success");$("#msg-"+b+" #result-"+b).html("").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 50px;"></span>');$("#msg-"+b+" h3").text("Estamos procesando su solicitud");$("#msg-"+b).show()}function cleanComplete(a){$("#msg-"+a+" h3").text("");$("#msg-"+a+" #result-"+a).html("")}function notiService(d,c,a,b){resetForms();$("#msg-"+b).removeClass(a).addClass(c);$("#msg-"+b+" > h3").html(d)}function notiSystem(h,i,f,d,c){var a=(c==="lock"||c==="key"||c==="replace")?c:null,b=(c!="lock"&&c!="key"&&c!="replace")?c:null;resetForms(b);var g=(f=="warning")?"warning":(f=="error")?"cancel":"ok",e=$("#msg_system");e.dialog({title:h,modal:"true",width:"440px",draggable:false,rezise:false,open:function(j,k){$(".ui-dialog-titlebar-close",k.dialog).hide();if(d=="carry"){$("#form-action").append('<button id="carry">Si</button>');$("#carry").focus();$("#close-info").text("No").attr("type","reset")}else{$("#close-info").text("Cerrar").removeAttr("type")}$("#msg_info").removeAttr("class").addClass("alert-simple alert-"+f);$("#msg_info span").removeAttr("class").addClass("icon-"+g+"-sign");$("#msg_info p").empty().append(i)}});$("#close-info").on("click",function(j){j.preventDefault();$("#msg_system").dialog("close");switch(d){case"out":$(location).attr("href",base_url+"/servicios");break;case"close":$(location).attr("href",base_url+"/users/closeSess");break}$("#carry").remove()});$("#carry").on("click",function(j){j.preventDefault();$("#msg_system").dialog("close");viewSelect(a);$("#carry").remove()})}function viewToken(e,c,b,a){var d="";notiService(e,"msg-lock-success","msg-lock-error",c);(c=="block")?$("#lock-acount input, #lock-acount select, #continuar").not("#mes-exp-bloq, #anio-exp-bloq, #mot-sol").prop("disabled",false):$("#change-key input, #change-key select, #continuar").not("#mes-exp-cambio, #anio-exp-cambio, #pin-current, #new-pin, #confirm-pin").prop("disabled",false);if(a===1){d+='<li id="sendToken" class="col-md-3-profile">';d+='<label for="token">Código de seguridad</label>';d+='<input class="field-medium" id="token" name="token" type="text">';d+="</li>"}if(b!==""){$("#montoComisionTransaccion").val(b);d+='<table class="receipt" cellspacing="0" cellpadding="0"><tr><td class="data-metadata">Comisión/Pago (S/. '+b+') <br><span class="money-amount">S/. '+b+"</span></td></tr></table>"}$("#"+c+"-ul").append(d)}function validar_campos(){jQuery.validator.setDefaults({debug:true,success:"valid"});jQuery.validator.addMethod("tokenValid",function(c,b){var d=/^[a-zA-Z0-9]+$/,a=b.value;if(d.test(a)){return true}else{return false}});jQuery.validator.addMethod("pinNew1",function(b,a){if(a.value.length>0&&a.value==$("#new-pin").val()){return true}else{return false}},"Debe ser igual al nuevo PIN");jQuery.validator.addMethod("pinNew2",function(b,a){if(a.value.length>0&&a.value==$("#pin-current").val()){return false}else{return true}},"El nuevo PIN no debe ser igual a su PIN anterior");$("#bloqueo-cuenta").validate({errorElement:"label",ignore:"",errorContainer:"#msg1",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg1",rules:{token:{required:true,tokenValid:true},"mot-sol":{required:true}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"mot-sol":"Debe seleccionar el motivo de la reposición"}});$("#cambio-pin").validate({errorElement:"label",ignore:"",errorContainer:"#msg2",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg2",rules:{token:{required:true,tokenValid:true},"pin-current":{required:true,number:true},"new-pin":{number:true,pinNew2:true,required:true},"confirm-pin":{number:true,pinNew1:true}},messages:{token:{required:"Debe colocar su código de seguridad",tokenValid:"El código de seguridad no debe tener caracteres especiales"},"pin-current":{required:"Debe colocar su PIN actual",number:"Debe ser numérico"},"new-pin":{number:"Su nuevo PIN debe ser numérico",pinNew2:"El nuevo PIN no debe ser igual a su PIN anterior",required:"Debe colocar su nuevo PIN"},"confirm-pin":{number:"La confirmación de su nuevo PIN debe ser numérico",pinNew1:"Debe ser igual a su nuevo PIN"}}});$("#recover-key").validate({errorElement:"label",ignore:"",errorContainer:"",errorClass:"field-error",validClass:"field-success",errorLabelContainer:""})}function resetForms(a){(a)?a[0].reset():"";$("#msg1, #msg2").children().remove();$("#bloqueo-cuenta *, #cambio-pin *").children().removeClass("field-success field-error")};