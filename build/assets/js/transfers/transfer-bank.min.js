function getCtasDestino(a,e,t){var o=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),n=JSON.stringify({nroTarjeta:a,prefijo:e,operacion:t});n=CryptoJS.AES.encrypt(n,o,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/transferencia/ctaDestino",{request:n,cpo_name:o,plot:btoa(o)},function(a){switch(data=JSON.parse(CryptoJS.AES.decrypt(a.code,a.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),data.rc){case 0:$("#wait").hide(),$(".product-button").removeClass("disabled-button"),montoMaxOperaciones=parseFloat(data.parametrosTransferencias[0].montoMaxOperaciones),montoMinOperaciones=parseFloat(data.parametrosTransferencias[0].montoMinOperaciones),montoMaxDiario=parseFloat(data.parametrosTransferencias[0].montoMaxDiario),montoMaxSemanal=parseFloat(data.parametrosTransferencias[0].montoMaxSemanal),montoMaxMensual=parseFloat(data.parametrosTransferencias[0].montoMaxMensual),cantidadOperacionesDiarias=parseInt(data.parametrosTransferencias[0].cantidadOperacionesDiarias),cantidadOperacionesSemanales=parseInt(data.parametrosTransferencias[0].cantidadOperacionesSemanales),cantidadOperacionesMensual=parseInt(data.parametrosTransferencias[0].cantidadOperacionesMensual),montoAcumDiario=parseFloat(data.parametrosTransferencias[0].montoAcumDiario),montoAcumSemanal=parseFloat(data.parametrosTransferencias[0].montoAcumSemanal),montoAcumMensual=parseFloat(data.parametrosTransferencias[0].montoAcumMensual),acumCantidadOperacionesDiarias=parseInt(data.parametrosTransferencias[0].acumCantidadOperacionesDiarias),acumCantidadOperacionesSemanales=parseInt(data.parametrosTransferencias[0].acumCantidadOperacionesSemanales),acumCantidadOperacionesMensual=parseInt(data.parametrosTransferencias[0].acumCantidadOperacionesMensual),montoBase=parseFloat(data.parametrosTransferencias[0].montoBaseTransferencia),montoComision=parseFloat(data.parametrosTransferencias[0].montoComision),porcentajeComision=parseFloat(data.parametrosTransferencias[0].porcentajeComision),totalComision=0,dobleAutenticacion=data.parametrosTransferencias[0].dobleAutenticacion,console.log(montoBase+"  probando"),$("#dashboard-beneficiary").empty(),$.each(data.cuentaDestinoTercero,function(a,e){var t=Math.floor(5*Math.random())+1,o="bank-"+t;cadena="<li class='dashboard-item muestraDestino' card='"+e.noCuenta+"' nombre='"+e.beneficiario+"' marca='"+e.marca+"' mascara='"+e.noCuentaConMascara+"' empresa='"+e.nomEmp+"' producto='"+e.banco.replace(" ","-")+"' id-afil='"+e.id_afiliacion+"'>",cadena+="<a rel='section' class='escogerDestino'>",cadena+="<img src='"+base_cdn+"img/products/default/"+o+".png' width='200' height='130' alt='' />",cadena+="<div class='dashboard-item-info'>",cadena+="<p class='dashboard-item-cardholder'>"+e.beneficiario+"</p>",cadena+="<p class='dashboard-item-cardnumber'>"+e.noCuentaConMascara+"</p>",cadena+="<p class='dashboard-item-category'>"+e.banco+"</p>",cadena+="</div>",cadena+=" </a>",cadena+="</li>",$("#dashboard-beneficiary").append(cadena),modalCtasDestino()});break;case-150:$("#transfer-date").append($("#without-account").html()),$("#affiliate-account, #transfer-date > fieldset, #without-account, #next-step").remove(),$("#progress > ul > li:nth-child(1)").removeClass("current-step-item").addClass("failed-step-item");break;default:$(location).attr("href",base_url+"/dashboard")}})}$(function(){operationType="P2T",$(".dialog").on("click",function(){modalCtasOrigen(),"Ve"!==country&&$.each($(".dashboard-item"),function(a,e){var t=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),o=JSON.stringify({tarjeta:$(e).attr("card")});o=CryptoJS.AES.encrypt(o,t,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/dashboard/saldo",{request:o,cpo_name:t,plot:btoa(t)},function(a){data=JSON.parse(CryptoJS.AES.decrypt(a.code,a.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8));var t=$(".dashboard-item").attr("moneda"),o=($(".dashboard-item").attr("doc"),data.disponible);"string"!=typeof o&&(o="---"),$(e).find(".dashboard-item-balance").html(t+o)})})}),$(".dashboard-item").click(function(){var a,e,t,o,n,s,r,i,d,c,l,p,m,u,f=[];for(c=new Date,l=c.getFullYear(),p=l-5,m=l+15,u=p;u<=m;u++)f.push(u);a=$(this).find("img").attr("src"),e=$(this).attr("card"),t=$(this).attr("marca").toLowerCase(),o=$(this).attr("mascara"),n=$(this).attr("producto1"),$(this).attr("empresa"),i=$(this).attr("nombre"),pais=$(this).attr("pais"),s=d="Pe"==pais||"Usd"==pais?"0.00":"0,00",$("#donor").children().remove(),r='<div class="product-presentation" producto="'+n+'">',r+='<img src="'+a+'" width="200" height="130" alt="" />',r+='<div class="product-network '+t.toLowerCase()+'"></div>',r+='<input id="donor-cardnumber-origen" name="donor-cardnumber" type="hidden" cardOrigen="'+e+'" />',r+="</div>",r+='<div class="product-info">',r+='<p class="product-cardholder" id="nombreCtaOrigen">'+i+"</p>",r+='<p class="product-cardnumber">'+o+"</p>",r+='<p class="product-metadata">'+n+"</p>",r+='<nav class="product-stack">',r+='<ul class="stack">',r+='<li class="stack-item">',r+='<a dialog button product-button rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',r+="</li>",r+="</ul>",r+="</nav>",r+="</div>",r+='<div class="product-scheme">',r+='<ul class="product-balance-group" style="margin: 10px 0">',r+='<li>Disponible <span class="product-balance" id="balance-available">'+moneda+" "+d+"</span></li>",r+='<li>A debitar <span class="product-balance debitar" monto-transfer id="balance-debit">'+moneda+" "+s+"</span></li>",r+="</ul>",r+="<ul class='field-group'>",r+="<li class='field-group-item'>",r+="<label for='dayExp'>Fecha de Vencimiento</label>",r+="<select id='month-exp' name='month-exp' style='margin-right: 5px;'>",r+="<option value=''>Mes</option>",r+="<option value='01'>01</option>",r+="<option value='02'>02</option>",r+="<option value='03'>03</option>",r+="<option value='04'>04</option>",r+="<option value='05'>05</option>",r+="<option value='06'>06</option>",r+="<option value='07'>07</option>",r+="<option value='08'>08</option>",r+="<option value='09'>09</option>",r+="<option value='10'>10</option>",r+="<option value='11'>11</option>",r+="<option value='12'>12</option>",r+="</select>",r+="<select id='year-exp' name='year-exp'>",r+="<option value=''>Año</option>",r+="</select>",r+="</li>",r+="</ul>",r+="</div>",$("#donor").append(r),$.each(f,function(a,e){var t=e.toString().substring(2,4),o="<option value='"+t+"'>"+e+"</option>";$("#year-exp").append(o)}),$("#wait").show();var h=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),b=JSON.stringify({tarjeta:$(this).attr("card")});b=CryptoJS.AES.encrypt(b,h,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/dashboard/saldo",{request:b,cpo_name:h,plot:btoa(h)},function(a){data=JSON.parse(CryptoJS.AES.decrypt(a.code,a.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8));var e=data.disponible;"string"!=typeof e&&(e="---"),$("#balance-available").html(moneda+" "+e),$("#balance-available").attr("saldo",e)}),$("#agregarCuenta").attr("href","#"),$("#agregarCuenta").parents("li").removeClass("disabled-group-action-item"),$.each($(".dashboard-item"),function(a,e){$(this).hasClass("current-dashboard-item")&&$(this).removeClass("current-dashboard-item")}),$(this).addClass("current-dashboard-item"),$("#content-product").dialog("close");var v=$(this).attr("card"),g=$(this).attr("prefix"),C=operationType;getCtasDestino(v,g,C)}),$("#donor").on("click",".stack-item",function(){$(".product-button").addClass("disabled-button"),$("#tdestino").children().remove(),$("#tdestino").append(ctasDestino),$("#continuar").prop("disabled",!0),modalCtasOrigen()}),$("#content-destino").on("click",".muestraDestino",function(){var a,e,t,o,n,s,r,i;1==$(this).hasClass("disabled-dashboard-item")?$("#content-destino").dialog("close"):(a=$(this).find("img").attr("src"),e=$(this).attr("card"),$(this).attr("marca"),t=$(this).attr("mascara"),o=$(this).attr("producto"),$(this).attr("empresa"),s=$(this).attr("nombre"),i=$(this).attr("id-afil"),r=editCard||countBeneficiary("get"),editCard=!1,$(".edit").remove(),n='<div class="group" count-Beneficiary = "'+r+'"> ',n+='<div class="product-presentation">',n+='<img src="'+a+'" width="200" height="130" alt="" />',n+='<div class=""></div>',n+='<input id="tarjetaDestino" name="tarjetaDestino" type="hidden" value="'+e+'" />',n+='<input id="id-afil" name="marcaDestino" type="hidden" value="'+i+'" />',n+='<input id="marca" name="marcaDestino" type="hidden" value="'+o+'" />',n+="</div>",n+='<div class="product-info">',n+='<p class="product-cardholder">'+s+"</p>",n+='<p class="product-cardnumber">'+t+"</p>",n+='<p class="product-metadata">'+o+"</p>",n+='<nav class="product-stack">',n+='<ul class="stack">',n+='<li class="stack-item modifica">',n+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit"></span></a>',n+="</li>",n+='<li class="stack-item elimina">',n+='<a rel="section" title="Remover"><span aria-hidden="true" class="icon-cancel"></span></a>',n+="</li>",n+="</ul>",n+="</nav>",n+="</div>",n+='<div class="product-scheme">',n+='<fieldset class="form-inline">',n+='<label for="beneficiary-1x-description" title="Descripción de la transferencia.">Concepto</label>',n+='<input class="field-large mont" id="beneficiary-'+r+'x-description" maxlength="60" name="beneficiary-1x-description" type="text" />',n+='<label for="beneficiary-1x-amount" title="Monto a transferir.">Importe</label>',n+='<div class="field-category"> '+moneda+" ",n+='<input id="beneficiary-1x-coin" name="beneficiary-1x-coin" type="hidden" value="'+moneda+'."/>',n+="</div>",n+='<input class="field-small monto dinero" id="beneficiary-'+r+'-amount" maxlength="12" name="beneficiary-1x-amount"/> <br/>',n+="</fieldset>",n+="</div>",n+="</div>",$("#content_plata #tdestino").append(n),$("#beneficiary-1x").removeClass("obscure-group"),$("#content-destino").dialog("close"),$("#tdestino").children("#btn-destino").remove(),$("#tdestino").append(ctasDestino),marcar_destino(),modalCtasDestino(),contar_tarjetas()>=3&&$("#tdestino").children("#btn-destino").remove(),contar_tarjetas()>0&&($("#continuar").prop("disabled",!1),$(".product-button").removeClass("disabled-button")))}),$("#content_plata").on("click",".modifica",function(){$(this).parents(".group").addClass("edit"),editCard=$(this).parents(".group").attr("count-beneficiary"),$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",beforeClose:function(a,e){$(".group").removeClass("edit"),editCard=!1},open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide()}})}),$("#content_plata").on("click",".elimina",function(){var a=$(this).parents(".group").attr("count-beneficiary");countBeneficiary("set",a),$(this).parents(".group").remove(),marcar_destino(),0==$("#tdestino").find("#btn-destino").length&&($("#tdestino").append(ctasDestino),modalCtasDestino(),$(".product-button").removeClass("disabled-button")),contar_tarjetas()<1&&$("#continuar").prop("disabled",!0),sumar_saldo()}),$("#content_plata").on("keyup",".monto",function(){sumar_saldo()}),$("#content_plata").on("click",".confir",function(){var a,e,t=!0,o=!0,n=/^-?[0-9]+([0-9])?$/,s=[];""===$("#month-exp").val()?(s.push("Seleccione el mes de vencimiento"),$("#month-exp").addClass("field-error"),t=!1):$("#month-exp").removeClass("field-error"),""===$("#year-exp").val()?(s.push("Seleccione el año de vencimiento"),$("#year-exp").addClass("field-error"),t=!1):$("#year-exp").removeClass("field-error");var r=0,i=0,d=0;if($.each($("#tdestino > .group > .product-scheme > fieldset").children("input").not(".skip"),function(){""===$(this).val()?($(this).addClass("field-error"),$(this).hasClass("field-large")&&0===r&&(s.push("El campo concepto no debe estar vacío."),r=1,t=!1),$(this).hasClass("monto")&&0===i&&(s.push("El campo importe no debe estar vacío."),i=1,t=!1)):$(this).hasClass("monto")&&!n.test($(this).val())?($(this).addClass("field-error"),t=!1,0===d&&(s.push("El campo importe no admite decimales."),d=1)):$(this).removeClass("field-error")}),!0===t){transferNumber=contar_tarjetas(),"Pe"===pais||"Usd"===pais?saldoDisp=$("#balance-available").attr("saldo").replace(/\,/g,""):"Ve"!==pais&&"Co"!==pais||(saldoDisp=$("#balance-available").attr("saldo").replace(/\./g,""),saldoDisp=saldoDisp.replace(",",".")),saldoDisp=parseFloat(saldoDisp),totalTrans=parseFloat($("#balance-debit").attr("monto-transfer"));var c=0;$.each($("#tdestino > .group > .product-scheme > fieldset").children("input").not(".skip"),function(){$(this).hasClass("monto")&&($(this).val()<montoMinOperaciones||$(this).val()>montoMaxOperaciones)?($(this).addClass("field-error"),o=!1,0===c&&(s.push("Las transferencias deben ser mínimo "+moneda+" "+montoMinOperaciones+", máximo "+moneda+" "+montoMaxOperaciones),c=1)):$(this).removeClass("field-error")}),totalTrans>saldoDisp?(s.push("El monto de la transferencia excede su saldo disponible."),o=!1):montoAcumMensual+totalTrans>montoMaxMensual?(a=montoMaxMensual-montoAcumMensual,e=0===a?".<br>No puede realizar otra transferencia este mes":"",s.push("El monto máximo mensual que puede transferir es "+moneda+" "+montoMaxMensual+".<br>Este mes ha transferido  "+moneda+" "+montoAcumMensual+e),o=!1):montoAcumSemanal+totalTrans>montoMaxSemanal?(a=montoMaxSemanal-montoAcumSemanal,e=0===a?".<br>No puede realizar otra transferencia esta semana":"",s.push("El monto máximo semanal que puede transferir es "+moneda+" "+montoMaxSemanal+".<br>Esta semana ha transferido  "+moneda+" "+montoAcumSemanal+e),o=!1):montoAcumDiario+totalTrans>montoMaxDiario&&(a=montoMaxDiario-montoAcumDiario,e=0===a?".<br>No puede realizar otra transferencia hoy":"",s.push("El monto máximo diario que puede transferir es "+moneda+" "+montoMaxDiario+".<br>Hoy ha transferido  "+moneda+" "+montoAcumDiario+e),o=!1),acumCantidadOperacionesMensual+transferNumber>cantidadOperacionesMensual?(a=cantidadOperacionesMensual-acumCantidadOperacionesMensual,e=0===a?".<br>No puede realizar otra operación este mes":"",s.push("Puede realizar: "+cantidadOperacionesMensual+" operaciones mensuales.<br>Este mes ha realizado: "+acumCantidadOperacionesMensual+e),o=!1):acumCantidadOperacionesSemanales+transferNumber>cantidadOperacionesSemanales?(a=cantidadOperacionesSemanales-acumCantidadOperacionesSemanales,e=0===a?".<br>No puede realizar otra operación esta semana":"",s.push("Puede realizar: "+cantidadOperacionesSemanales+" operaciones semanales.<br>Esta semana ha realizado: "+acumCantidadOperacionesSemanales+e),o=!1):acumCantidadOperacionesDiarias+transferNumber>cantidadOperacionesDiarias&&(a=cantidadOperacionesDiarias-acumCantidadOperacionesDiarias,e=0===a?".<br>No puede realizar otra operación hoy":"",s.push("Puede realizar: "+cantidadOperacionesDiarias+" operaciones diarias.<br>Hoy ha realizado: "+acumCantidadOperacionesDiarias+e),o=!1)}if(!1===t||!1===o)$("#info-system").dialog({title:"Transferencia entre tarjetas",modal:"true",width:"440px",draggable:!1,rezise:!1,open:function(a,e){$(".ui-dialog-titlebar-close",e.dialog).hide(),$.each(s,function(a,e){$("#content-info").append("<p>"+e+"</p>")})}}),$("#close-info").on("click",function(){$(this).off("click"),s=[],$("#content-info").children().not("span").remove(),$("#info-system").dialog("close")});else{var l,p=1;nameSource=$("#donor").find(".product-cardholder").html(),maskSource=$("#donor").find(".product-cardnumber").html(),sourceNumber=$("#donor").find("#donor-cardnumber-origen").attr("cardOrigen"),brand=$("#donor").find(".product-metadata").html(),expDate=$("#month-exp").val()+$("#year-exp").val(),l="<tr>",l+='<td class="data-label"><label>Cuenta Origen</label></td>',l+='<td class="data-reference" colspan="2">'+nameSource+"<br/>",l+='<span class="highlight">'+maskSource+"</span><br/>",l+='<span class="lighten">'+brand+"</span>",l+="</td>",l+="</tr>",l+="<tr>",l+='<td class="data-label"><label>Cuentas Destino</label></td>',l+="</tr>",$("#progress > ul > li:nth-child(1)").removeClass("current-step-item").addClass("completed-step-item"),$("#cargarConfirmacion").append(l),$.each($("#tdestino").children(":not(.obscure-group)"),function(a,e){destination["account"+a]={nameDest:$(e).find(".product-cardholder").html(),maskDest:$(e).find(".product-cardnumber").html(),accountDes:$(e).find("#tarjetaDestino").val(),amountDest:$(e).find(".monto").val(),conceptDest:$(e).find(".field-large").val(),brandDest:$(e).find("#marca").val(),idAfil:$(e).find("#id-afil").val(),transfer:p+a};var t=$(e).find(".field-large").val(),o=parseFloat($(e).find(".monto").val().replace(",",".")),n=o<=montoBase?montoComision:o*porcentajeComision/100;totalComision+=n,l='<tr class="trdestino-'+(p+a)+'">',l+='<td class="data-label"> </td>',l+='<td class="data-reference">'+$(e).find(".product-cardholder").html()+"<br/>",l+='<span class="highlight">'+$(e).find(".product-cardnumber").html()+"</span><br/>",l+='<span class="lighten"> '+$(e).find("#marca").val()+" </span>",l+="</td>",l+='<td class="data-metadata data-resultado">',l+='<div class="data-indicator">',l+='<span aria-hidden="true" class="iconoTransferencia"></span>',l+="</div>",l+='<span class="data-metadata conceptoDestino"></span>',l+="<strong>Concepto: </strong>"+t+"<br />",l+="<strong>Monto: </strong>",l+='<span class="money-amount"> '+moneda+" "+changeDecimals(o)+"<br /> </span>",l+="<strong>Comisión: </strong>",l+='<span class="money-amount"> '+moneda+" "+changeDecimals(n)+"<br /> </span>",l+="<strong>Estatus: </strong>",l+='<span class="money-amount estatus">En espera por confirmación.</span>',l+="</td>",l+="</tr>",l+="<tr>",l+='<td class="data-spacing" colspan="3"></td>',l+="</tr>",$("#cargarConfirmacion").append(l)}),l="<tr>",l+='<td class="data-spacing" colspan="3"></td>',l+="</tr>",l+="<tr>",l+='<td colspan="2"></td>',l+='<td class="data-metadata">Total (Transferencia + Comisión '+moneda+" "+changeDecimals(totalComision)+") = ",l+='<span class="money-amount">'+moneda+" "+changeDecimals(totalTrans+totalComision)+"</span>",l+="</tr>",$("#cargarConfirmacion").append(l),$("#progress > ul > li:nth-child(2)").addClass("current-step-item"),$("#continuar").removeClass("confir").addClass("sol-transfer"),$("#transfer-date").append($("#confirm-transfer").html()),$("#affiliate-account, #transfer-date > fieldset, #confirm-transfer").remove()}}),$("#content_plata").on("click",".sol-transfer",function(){$(".sol-transfer").prop("disabled",!0),$("#next-step").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 25px; float: right"></span>'),"S"===dobleAutenticacion?requestPassword():"N"===dobleAutenticacion&&makeTransfer(operationType)})});