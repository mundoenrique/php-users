function confirmPassOperac(e){var a,n={clave:hex_md5(e)};return $.ajax({url:base_url+"/transferencia/operaciones",data:n,type:"post",dataType:"json",async:!1,success:function(e){switch(a=$.parseJSON(e.response),a.rc){case 0:a=$.parseJSON(e.transferir);break;case-61:$(location).attr("href",base_url+"/users/error_gral");break;default:a=$.parseJSON(e.transferir)}}}),a}function modalCtasOrigen(){$("#content-product").dialog({title:"Selección de Cuentas Origen",modal:"true",width:"950px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")})}function modalCtasDestino(){$(".dialogDestino").on("click",function(){$("#content-destino").dialog({title:"Selección de Cuentas Destino",modal:"true",width:"940px",open:function(e,a){$(".ui-dialog-titlebar-close",a.dialog).hide()}}),$("#close").click(function(){$("#content-destino").dialog("close")})})}function normaliza(e){for(var a="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",n="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",t=0;t<a.length;t++)e=e.replace(a.charAt(t),n.charAt(t));return e}function countBeneficiary(e,a){var n,t=numberBeneficiary.length;return"get"==e?(n=numberBeneficiary[t-1],numberBeneficiary.pop(),n):void("set"==e&&(n=parseInt(a),numberBeneficiary.push(n)))}function marcar_destino(){$.each($("#dashboard-beneficiary").children(".dashboard-item"),function(e,a){$(a).removeClass("disabled-dashboard-item"),$.each($("#tdestino").children(":not(.obscure-group)"),function(e,n){$(n).find("#tarjetaDestino").val()==$(a).attr("card")&&$(a).addClass("disabled-dashboard-item")})})}function contar_tarjetas(){var e=0;return $.each($("#tdestino").children().not(".obscure-group"),function(a,n){e++}),e}function sumar_saldo(){var e,a=0;$.each($(".dinero"),function(n,t){return e=$(t).val().replace(",","."),isNaN(e)?(a=0,!1):void(""!==e&&(a+=parseFloat(e)))}),$("#balance-debit").html(moneda+" "+changeDecimals(a)),$("#balance-debit").attr("monto-transfer",a)}function requestPassword(){var e;$.ajax({url:base_url+"/transferencia/crearClave",type:"post",dataType:"json",success:function(a){switch($("#next-step span").remove(),a.rc){case 0:e="Hemos enviado una notificación a su correo electrónico con el código aleatorio que se solicita a continuación para confirmar la operación en curso.",notiSystem("passReq","Verificación requerida.",e),$("#input-pass").focus(),$("#button-action").on("click","#send-pass",function(){$("#content-input p").remove();var e=$("#input-pass").val();""===e?$("#input-pass").addClass("field-error"):($("#button-action").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 25px; float: right"></span>'),$("#send-pass").prop("disabled",!0),validar_clave(e))});break;case-176:e="No fue posible enviar la <strong>clave de confirmación.</strong> Por favor, intente nuevamente.",notiSystem("fail","Verificación requerida.",e);break;default:$(location).attr("href",base_url+"/users/error_gral")}}})}function validar_clave(e){var a={clave:hex_md5(e)};$.ajax({url:base_url+"/transferencia/confirmacion",data:a,type:"post",dataType:"json",success:function(e){switch($("#button-action span").remove(),e.rc){case 0:$("#info-system").dialog("close"),$("#next-step").append('<span aria-hidden="true" class="icon-refresh icon-spin" style="font-size: 25px; float: right"></span>'),makeTransfer(operationType);break;case-22:$("#input-pass").addClass("field-error").val(""),$("#content-input").append('<p style="color: #f04848;">La <strong>clave de confirmación</strong> es incorrecta. Por favor, verifique e intente nuevamente.</p>'),$("#send-pass").prop("disabled",!1);break;default:$(location).attr("href",base_url+"/users/error_gral")}}})}function makeTransfer(e){var a=1;$.each(destination,function(n,t){var o={cuentaOrigen:sourceNumber,cuentaDestino:t.accountDes,monto:t.amountDest,descripcion:t.conceptDest,tipoOpe:e,idUsuario:nameSource,id_afil_terceros:t.idAfil,expDate:expDate};$.ajax({url:base_url+"/transferencia/procesar",data:o,type:"post",dataType:"json",async:!1,success:function(e){var n,t,o="data-error",r="icon-cancel-sign",s="",i="";switch($("#next-step span").remove(),$("#button-action span").remove(),e.rc){case 0:s=e.dataTransaccion.referencia,o="data-success",r="icon-ok-sign",t="Transacción exitosa. No. de Referencia: ",$("#transfer-success").show();break;case-61:$(location).attr("href",base_url+"/users/error_gral");break;default:switch(n=e.rc){case-340:t="Cantidad de dígitos de la cuenta es invalida.";break;case-341:t="El número de cuenta no corresponde al banco.";break;case-342:t="Número de cuenta invalido.";break;case-343:i=transferencia.msg,t="Su tarjeta se encuentra bloqueada, código de bloqueo: "+i.substr(34,35);break;case-344:t="La fecha de vencimiento es incorrecta.";break;default:t="No fue posible realizar la transferencia."}}$("#titulo > h2").text("Finalización"),$("#cargarConfirmacion > tr.trdestino-"+a+" > td.data-resultado").addClass(o),$("#cargarConfirmacion > tr.trdestino-"+a+" > td.data-resultado > div.data-indicator > span.iconoTransferencia").addClass(r),$("#cargarConfirmacion > tr.trdestino-"+a+" > td.data-resultado > span.estatus").empty().text(t+s)}}),a++}),$("#progress > ul > li:nth-child(2)").removeClass("current-step-item").addClass("completed-step-item"),$("#progress > ul > li:nth-child(3)").addClass("current-step-item"),$("#cancel > button").removeAttr("type").text("Finalizar"),$("#continuar").remove()}function changeDecimals(e){var a;return a=e.toFixed(2),"Ve"!=pais&&"Co"!=pais||(a=a.replace(".",",")),a}function notiSystem(e,a,n){$("#send-pass").remove(),$("#button-action").children().not(".skip").remove(),$("#content-info").children().not(".skip").remove(),$("#content-input").children().not(".skip").remove(),$("#close-info").text("Aceptar").removeAttr("type","reset"),$("#info-system").dialog({title:a,modal:"true",width:"440px",draggable:!1,resizable:!1,focus:!1,open:function(a,t){switch($(".ui-dialog-titlebar-close",t.dialog).hide(),e){case"passReq":$("#button-action").append('<button id="send-pass">Aceptar</button>'),$("#close-info").text("Cancelar").attr("type","reset"),$("#content-info").removeClass("alert-warning").addClass("alert-info").append("<p>"+n+"</p>"),$("#content-input").append('<input class="field-medium" id="input-pass" name="transpwd" placeholder="Código Aleatorio" type="password" />');break;case"fail":$("#content-info").removeClass("alert-info").addClass("alert-warning").append("<p>"+n+"</p>")}}}),$("#close-info").on("click",function(){$(this).off("click"),$("#info-system").dialog("close"),$(".sol-transfer").prop("disabled",!1)})}var base_url,base_cdn,ctasDestino,moneda,pais,editCard,numberBeneficiary=[3,2,1],totalTrans,saldoDisp,transferNumber,montoMinOperaciones,montoMaxOperaciones,montoAcumMensual,montoMaxMensual,montoAcumSemanal,montoMaxSemanal,montoAcumDiario,montoMaxDiario,acumCantidadOperacionesMensual,cantidadOperacionesMensual,acumCantidadOperacionesSemanales,cantidadOperacionesSemanales,acumCantidadOperacionesDiarias,cantidadOperacionesDiarias,montoComision,nameSource,maskSource,sourceNumber,brand,destination={},dobleAutenticacion,operationType,expDate,country;base_url=$("body").attr("data-app-url"),base_cdn=$("body").attr("data-app-cdn"),country=$("body").data("country"),$(function(){ctasDestino=$("#tdestino").html(),moneda=$("#donor").attr("moneda"),$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")});var e=$("#content").attr("confirmacion");"1"==e?($("#content-clave").hide(),$("#tabs-menu").show(),$("#content_plata").show()):$("#content-clave").show(),$("#continuar_transfer").click(function(){var e=$("#transpwd").val();""==e?$("#transpwd").addClass("field-error"):($("#transpwd").removeClass("field-error"),confirmPassOperac(e)?($("#content-clave").hide(),$("#tabs-menu").show(),$("#content_plata").show()):($("#content_clave").show(),$.balloon.defaults.classname="field-error",$.balloon.defaults.css=null,$("#transpwd").showBalloon({position:"right",contents:"Clave inválida"}),setTimeout(function(){$("#transpwd").hideBalloon()},3e3)))})});