var base_url,base_cdn;base_url=$("body").attr("data-app-url"),base_cdn=$("body").attr("data-app-cdn"),$(function(){var max=4,telefono=getVarsUrl()["num%20"],estatus=getVarsUrl()["disponeClaveSMS%20"],pais=getVarsUrl()["acCodPais%20"],id_ext_per=getVarsUrl()["id_ext_per%20"];function validar_campos(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#form-validar").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{userpwd:{required:!0,number:!0},"confirm-userpwd":{required:!0,number:!0,minlength:4,maxlength:4,equalTo:"#userpwd"}},messages:{userpwd:"El campo Clave SMS no puede estar vacío y debe contener 4 números","confirm-userpwd":"El campo Confirmación no puede estar vacío, debe contener 4 números y coincidir con el campo Clave SMS"}})}function getVarsUrl(){for(var url,arrUrl=location.search.replace("?","").split("&"),urlObj={},i=0;i<arrUrl.length;i++){var x=arrUrl[i].split("=%20");urlObj[x[0]]=x[1]}return urlObj}cadena="<form accept-charset='utf-8' method='post' id='form-validar'>",cadena+="<fieldset class='fieldset-column-center'>",cadena+="<div class='field-meter' id='password-strength-meter'>",cadena+="<h4>Requerimientos de contraseña:</h4>",cadena+="<ul class='pwd-rules'>",cadena+="<li id='consecutivo' class='pwd-rules-item rule-invalid'>• Debe tener <strong>4 números</strong></li>",cadena+="</ul>",cadena+="</div>",cadena+="<label>Número de teléfono</label>",cadena+="<input class='field-medium' maxlength='15' id='num_tlf' name='num_tlf' value="+telefono+" disabled/>",cadena+="<label for='userpwd'>Clave SMS</label>",cadena+="<input class='field-medium' maxlength='4' id='userpwd' name='userpwd' type='password' />",cadena+="<label for='confirm-userpwd'>Confirmación</label>",cadena+="<input class='field-medium' maxlength='4' id='confirm-userpwd' name='confirm-userpwd' type='password'/>",cadena+="</fieldset>",cadena+="</form>",confirmacion="<div class='form-actions'>",confirmacion+="<button id='eliminar' type='reset'>Eliminar</button>",confirmacion+="<button id='actualizar'>Actualizar</button>",confirmacion+="</div>",confirmacion1="<div class='form-actions'>",confirmacion1+="<button id='volver' type='reset'>Volver</button>",confirmacion1+="<button id='afiliar'>Afiliar</button>",confirmacion1+="</div>",$("#content-pass").append(cadena).html(),1==estatus?$("#content-pass").append(confirmacion).html():0==estatus&&$("#content-pass").append(confirmacion1).html(),$("#volver").click(function(){$(location).attr("href",base_url+"/perfil")}),$("#actualizar").click(function(){var form;if(validar_campos(),$("#form-validar").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3),1==$("#form-validar").valid()){$("#consecutivo").removeClass("rule-invalid").addClass("rule-valid");var claveSMS=$("#userpwd").val(),newC=$("#confirm-userpwd").val();$("#actualizar").removeClass("disabled-button"),"Pe"!=pais&&"Usd"!=pais&&"Co"!=pais||(claveSMS=hex_md5(claveSMS));var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/users/passwordSmsActualizar",{id_ext_per:id_ext_per,claveSMS:claveSMS,nroMovil:telefono,cpo_name:cpo_cook},function(data){0==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#confirmaActualizar").removeAttr("style")).html(),$("#confirmar").click(function(){$(location).attr("href",base_url+"/dashboard")})),-217==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito").removeAttr("style")).html(),$("#regresar").click(function(){$(location).attr("href",base_url+"/perfil")})),-215==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito2").removeAttr("style")).html(),$("#regresar2").click(function(){$(location).attr("href",base_url+"/perfil")}))})}}),$("#eliminar").click(function(){var claveSMS="",cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/users/passwordSmsEliminar",{id_ext_per:id_ext_per,claveSMS:"",nroMovil:telefono,cpo_name:cpo_cook},function(data){0==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#confirmaEliminar").removeAttr("style")).html(),$("#confirmar-eliminar").click(function(){$(location).attr("href",base_url+"/dashboard")})),-61==data.rc&&$(location).attr("href",base_url+"/users/error_gral"),-214==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito3").removeAttr("style")).html(),$("#regresar3").click(function(){$(location).attr("href",base_url+"/perfil")})),-218==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito4").removeAttr("style")).html(),$("#regresar4").click(function(){$(location).attr("href",base_url+"/perfil")})),-215==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito2").removeAttr("style")).html(),$("#regresar2").click(function(){$(location).attr("href",base_url+"/perfil")}))})}),$("#afiliar").click(function(){var form;if(validar_campos(),$("#form-validar").submit(),setTimeout(function(){$("#msg").fadeOut()},5e3),1==$("#form-validar").valid()){$("#consecutivo").removeClass("rule-invalid").addClass("rule-valid");var claveSMS=$("#userpwd").val(),newC=$("#confirm-userpwd").val();$("#actualizar").removeClass("disabled-button"),"Pe"!=pais&&"Usd"!=pais&&"Co"!=pais||(claveSMS=hex_md5(claveSMS));var cpo_cook=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$.post(base_url+"/users/passwordSmsNew",{id_ext_per:id_ext_per,claveSMS:claveSMS,nroMovil:telefono,cpo_name:cpo_cook},function(data){0==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#confirmaCrear").removeAttr("style")).html(),$("#continuar").click(function(){$(location).attr("href",base_url+"/dashboard")})),-61==data.rc&&$(location).attr("href",base_url+"/users/error_gral"),-213==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito5").removeAttr("style")).html(),$("#regresar5").click(function(){$(location).attr("href",base_url+"/perfil")})),-216==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito6").removeAttr("style")).html(),$("#regresar6").click(function(){$(location).attr("href",base_url+"/perfil")})),-215==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito2").removeAttr("style")).html(),$("#regresar2").click(function(){$(location).attr("href",base_url+"/perfil")})),-20==data.rc&&($("#content-pass").children().remove(),$("#content-pass").append($("#sinExito7").removeAttr("style")).html(),$("#regresar7").click(function(){$(location).attr("href",base_url+"/perfil")}))})}}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(event,ui){$(".ui-dialog-titlebar-close",ui.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});