function dialogo(){$(".dialog").click(function(e){e.preventDefault(),$("#content-product").dialog({title:"Seleccion de Cuentas Origen",modal:"true",width:"940px",open:function(e,t){$(".ui-dialog-titlebar-close",t.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var t=$("#dashboard-donor");t.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var a=$("#filters-stack .option-set"),o=a.find("a");o.click(function(e){e.preventDefault();var a=$(this);if(a.hasClass("selected"))return!1;var o=a.parents(".option-set");o.find(".selected").removeClass("selected"),a.addClass("selected");var r={},n=o.attr("data-option-key"),d=a.attr("data-option-value");return d="false"!==d&&d,r[n]=d,"layoutMode"===n&&"function"==typeof changeLayoutMode?changeLayoutMode(a,r):t.isotope(r),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")})}function generar_info(e,t,a,o,r,n,d){$("#mens").addClass("disabled-button"),$("#filter-range-from").prop("disabled",!0),$("#filter-range-to").prop("disabled",!0),$("#empty-state > h2").text(""),$("#empty-state > p").text(""),$("#empty-state").show(),$("#dialog").show();var s=$("#reporte").attr("moneda"),c=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),i=JSON.stringify({tarjeta:e,idpersona:o,tipo:t,producto:a,fechaIni:r,fechaFin:n});i=CryptoJS.AES.encrypt(i,c,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/report/CallWsGastos",{request:i,cpo_name:c,plot:btoa(c)},function(e){switch($("#mens").removeClass("disabled-button"),$("#filter-range-from").prop("disabled",!1),$("#filter-range-to").prop("disabled",!1),$("#mens").prop("disabled",!1),$("#dialog").css("display","none"),data=JSON.parse(CryptoJS.AES.decrypt(e.code,e.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),data.rc){case 0:genreteResult(data,s,d);break;case-150:$("#empty-state > h2").text("No se encontraron registros"),$("#empty-state > p").text("Seleccione un rango de fecha a consultar.");break;case-9999:$("#empty-state > h2").text("Atención"),$("#empty-state > p").text("Combinación de caracteres no válida.");break;default:$(location).attr("href",base_url+"/users/error_gral")}})}function genreteResult(e,t,a){$("#download-boxes").show(),$("#results").show(),$("#empty-state").hide(),$("#grafico").prop("disabled",!1),$("#detalle").prop("disabled",!1).prop("checked",!0);var o={seriesDefaults:{labels:{template:"#= category #  #= kendo.format('{0:P}')#",position:"outsideEnd",visible:!1,background:"transparent",format:t+" {0}"}},seriesColors:["#1abc9c","#2ecc71","#3498db","#9b59b6","#f1c40f","#e67e22","#e74c3c","#16a085","#27ae60","#2980b9"],series:[{type:"pie",overlay:{gradient:"none"},data:[]}],legend:{visible:!0},categoryAxis:{categories:[]},tooltip:{visible:!0,template:"${category} - "+t+" ${value}"}},r={};$.each(e.listaGrafico[0].categorias,function(e,t){o.categoryAxis.categories.push(t.nombreCategoria)});var n=e;if($.each(n.listaGrafico[0].categorias,function(e,t){$.each(n.listaGrafico[0].series,function(a,n){r={},r.category=t.nombreCategoria,r.value=parseFloat(n.valores[e]),o.series[0].data.push(r)})}),$("#chart").kendoChart(o),"anual"==a)$("#report-annual").show(),$.each(e.listaGrupo,function(e,t){$.each(t.gastoMensual,function(e,t){"ENERO"==t.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"FEBRERO"==t.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"MARZO"==t.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"ABRIL"==t.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"MAYO"==t.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"JUNIO"==t.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"JULIO"==t.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"AGOSTO"==t.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"SEPTIEMBRE"==t.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"OCTUBRE"==t.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"NOVIEMBRE"==t.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"DICIEMBRE"==t.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(t.totalCategoria),th.attr("class","feed-monetary feed-category-"+(e+1)+"x")}),$.each(e.totalesAlMes,function(e,t){"ENERO"==t.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"FEBRERO"==t.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"MARZO"==t.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"ABRIL"==t.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"MAYO"==t.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"JUNIO"==t.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"JULIO"==t.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"AGOSTO"==t.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"SEPTIEMBRE"==t.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"OCTUBRE"==t.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"NOVIEMBRE"==t.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"DICIEMBRE"==t.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(e.totalGeneral),th.attr("class","feed-total");else{$("#report-monthly").show();var d=$("#tbody-datos-mes");d.empty();var s=$("#totales-mes");s.empty(),$.each(e.totalesPorDia,function(t,a){tr=$(document.createElement("tr")).appendTo(d),td=$(document.createElement("td")).appendTo(tr),td.html(a.fechaDia),td.attr("class","feed-headline"),$.each(e.listaGrupo,function(e,t){$.each(t.gastoDiario,function(e,t){a.fechaDia==t.fechaDia&&(td=$(document.createElement("td")).appendTo(tr),td.html(t.monto))})}),td=$(document.createElement("td")).appendTo(tr),td.html(a.monto),td.attr("class","feed-monetary")}),th=$(document.createElement("td")).appendTo(s),th.html("Totales"),th.attr("class","feed-total"),$.each(e.listaGrupo,function(e,t){th=$(document.createElement("td")).appendTo(s),th.attr("class","feed-monetary feed-category-"+(e+1)+"x"),th.html(t.totalCategoria)}),th=$(document.createElement("td")).appendTo(s),th.html(e.totalGeneral),th.attr("class","feed-total")}}function disableElements(){$("#filter-range-from").prop("disabled",!0),$("#filter-range-to").prop("disabled",!0),$("#grafico").prop("disabled",!0).prop("checked",!1),$("#detalle").prop("disabled",!0).prop("checked",!1),$("#mens").prop("disabled",!0),$("#results").hide(),$("#download-boxes").hide(),$("#chart").hide(),$("#report-monthly").hide(),$("#report-annual").hide(),$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("tbody td:not(.feed-headline, #tbody-datos-mes)").remove(),$("tfoot td:not(.feed-headline)").remove()}function validar_campos(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#fechas").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"filter-range-from":{required:!0,dpDate:!0},"filter-range-to":{required:!0,dpDate:!0}},messages:{"filter-range-from":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) ","filter-range-to":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) "}})}var fecha=new Date;fecha=fecha.getFullYear();var anio,fechaIni,fechaFin,tipoConsulta,reporte,imagen,tarjeta,marca,mascara,producto,empresa,cadena,nombre,tipo,i=0,skin=$("body").attr("data-app-skin");$(function(){$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$("#filter-range-to, #filter-range-from").on("focus",function(){$(this).removeClass("field-error").attr("placeholder","DD/MM/AAAA")}),dialogo(),$.datepicker.regional.es={closeText:"Cerrar",prevText:"Previo",nextText:"Próximo",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],monthStatus:"Ver otro mes",yearStatus:"Ver otro año",dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],dateFormat:"dd/mm/yy",firstDay:0,maxDate:0,initStatus:"Selecciona la fecha",isRTL:!1},$.datepicker.setDefaults($.datepicker.regional.es),$("#filter-range-from").datepicker({onSelect:function(e){$("#filter-range-to").datepicker("option","minDate",e)}}),$("#filter-range-to").datepicker({onSelect:function(e){$("#filter-range-from").datepicker("option","maxDate",e)}}),$(".dashboard-item").on("click",function(e){e.preventDefault(),imagen=$(this).find("img").attr("src"),tarjeta=$(this).attr("card"),marca=$(this).attr("marca"),mascara=$(this).attr("mascara"),producto=$(this).attr("producto1"),empresa=$(this).attr("empresa"),nombre=$(this).attr("nombre"),idexper=$(this).attr("idpersona"),tipo=$(this).attr("tipo"),id=$(this).attr("id"),prefix=$(this).attr("prefix"),$("#donor").children().remove(),disableElements();var t=$("#filter-range-from"),a=$("#filter-range-to");t.val(""),t.removeClass("field-success"),t.removeClass("field-error"),a.val(""),a.removeClass("field-success"),a.removeClass("field-error"),cadena='<div class="product-presentation">',cadena+='<img src="'+imagen+'" width="200" height="130" alt="" />',cadena+='<div class="product-network '+marca+'"></div>',cadena+='<input id="donor-cardnumber" name="donor-cardnumber" prefix="'+prefix+'" tarjeta="'+tarjeta+'" idexper="'+idexper+'" tipo="'+tipo+'" type="hidden" value="'+tarjeta+'" />',cadena+="</div>",cadena+='<div class="productoct-info-full">',cadena+='<p class="product-cardholder">'+nombre+' <span class="product-cardholder-id">'+id+" "+idexper+"</span></p>",cadena+='<p class="product-cardnumber">'+mascara+"</p>",cadena+='<p class="product-metadata">'+producto+"</p>",cadena+='<nav class="product-stack">',cadena+='<ul class="stack">',cadena+='<li class="stack-item dialog">',cadena+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit dialog"></span></a>',cadena+="</li>",cadena+="</ul>",cadena+="</nav>",cadena+="</div>",$("#donor").append(cadena),$("#content-product").dialog("close"),dialogo(),producto=$("#donor").find("#donor-cardnumber").attr("prefix");var o=new Date,r=o.getFullYear();fechaIni="01/01/"+r,fechaFin="31/12/"+r,tipoConsulta="0",generar_info(tarjeta,tipoConsulta,producto,idexper,fechaIni,fechaFin,"anual")}),$("#grafico").on("click",function(){$("#chart").show(),$("#results").hide(),$("#chart").children("svg").css("width","910px")}),$("#detalle").on("click",function(){$("#chart").hide(),$("#results").show()}),$("#mens").on("click",function(e){e.preventDefault();$("#fechas");var t=/^(0?[1-9]|[12][0-9]|3[01])\/(0?[1-9]|1[012])\/[0-9]{4}$/,a=$("#filter-range-from"),o=$("#filter-range-to"),r=!0;t.test(a.val())||(a.addClass("field-error"),a.attr("placeholder","Formato incorrecto"),r=!1),t.test(o.val())||(o.addClass("field-error"),o.attr("placeholder","Formato incorrecto"),r=!1),r&&(disableElements(),tipoConsulta="1",a=a.val(),o=o.val(),generar_info(tarjeta,tipoConsulta,producto,idexper,a,o,"mensual"))}),$("#export_pdf").click(function(e){if(e.preventDefault(),0==reporte)$("#report-detail").children().remove(),$("#chart").children().remove(),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',cadena+="</div>",$("#report-detail").append(cadena),$("#chart").append(cadena);else{$("#tarjeta_pdf").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona_pdf").val(idexper),$("#producto_pdf").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta_pdf").val(tipoConsulta),$("#fechaIni_pdf").val(fechaIni),$("#fechaFin_pdf").val(fechaFin),$("#idOperation").val("5");var t=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$("#form_pdf").append('<input type="hidden" name="cpo_name" value="'+t+'">'),$("#form_pdf").submit()}}),$("#export_excel").click(function(e){if(e.preventDefault(),0==reporte)$("#report-detail").children().remove(),$("#chart").children().remove(),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',cadena+="</div>",$("#report-detail").append(cadena),$("#chart").append(cadena);else{$("#tarjeta").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona").val(idexper),$("#producto").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta").val(tipoConsulta),$("#fechaIni").val(fechaIni),$("#fechaFin").val(fechaFin),$("#idOperation").val("5");var t=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$("#form").append('<input type="hidden" name="cpo_name" value="'+t+'">'),$("#form").submit()}}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(e,t){$(".ui-dialog-titlebar-close",t.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});