var fecha=new Date;fecha=fecha.getFullYear();var i=0,anio,fechaIni,fechaFin,tipoConsulta,producto,tipoConsulta,reporte;do{anio=parseInt(fecha)-i,$(".sub-stack").append('<li class="sub-stack-item"><a href="#" rel="subsection" >'+anio.toString()+"</a></li>"),i+=1}while(3!=i);$(document).ready(function(){$(".nodata-state").hide(),$("#dialog").css("display","none"),$("#download-boxes").hide(),$("#filter-range-from").prop("disabled",!0),$("#filter-range-to").prop("disabled",!0),$("#detalle").prop("disabled",!0),$("#grafico").prop("disabled",!0)}),$(function(){function a(){$(".dialog").click(function(a){a.preventDefault(),$("#content-product").dialog({title:"Seleccion de Cuentas Origen",modal:"true",width:"940px",open:function(a,b){$(".ui-dialog-titlebar-close",b.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var b=$("#dashboard-donor");b.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}}),$("#filters-stack .option-set").find("a").click(function(a){a.preventDefault();var c=$(this);if(c.hasClass("selected"))return!1;var d=c.parents(".option-set");d.find(".selected").removeClass("selected"),c.addClass("selected");var e={},f=d.attr("data-option-key"),g=c.attr("data-option-value");return g="false"!==g&&g,e[f]=g,"layoutMode"===f&&"function"==typeof changeLayoutMode?changeLayoutMode(c,e):b.isotope(e),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")})}function b(a,b,c,d,e,f,g){$("#dialog").show();var h=$("#reporte").attr("moneda");$.post(base_url+"/report/CallWsGastos",{tarjeta:a,idpersona:d,tipo:b,producto:c,fechaIni:e,fechaFin:f},function(a){if(-61==a.rc&&($(location).attr("href",base_url+"/users/error_gral"),$("#dialog").css("display","none")),0!=a.rc)-150==a.rc?($("#report-detail").children().remove(),$("#chart").children().remove(),$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#tabla_detalle").attr("style","display:none"),$("#dialog").css("display","none"),$("#empty-state").hide(),$('[data-result="noresult"]').show()):($("#report-detail").children().remove(),$("#chart").children().remove(),$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#tabla_detalle").attr("style","display:none"),cadena='<div id="empty-state" style="position: static;">',cadena+="<h2>No se encontraron movimientos</h2>",cadena+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',cadena+="</div>",$("#report-detail").append(cadena),$("#chart").append(cadena),$("#totales-mes td:not(.feed-headline)").append(cadena),$("#tbody-datos-mes").append(cadena),$("#dialog").css("display","none"),reporte=!1);else{$("#download-boxes").show(),$(".nodata-state").hide(),$("#dialog").css("display","none"),$("#chart").hide(),$("#results").show(),$("#empty-state").hide(),$("#grafico").prop("disabled",!1),$("#detalle").prop("disabled",!1),$("#tabla_detalle").removeAttr("style"),reporte=!0;var b={seriesDefaults:{labels:{template:"#= category #  #= kendo.format('{0:P}')#",position:"outsideEnd",visible:!1,background:"transparent",format:h+" {0}"}},seriesColors:["#1abc9c","#2ecc71","#3498db","#9b59b6","#f1c40f","#e67e22","#e74c3c","#16a085","#27ae60","#2980b9"],series:[{type:"pie",overlay:{gradient:"none"},data:[]}],legend:{visible:!0},categoryAxis:{categories:[]},tooltip:{visible:!0,template:"${category} - "+h+" ${value}"}},c={};$.each(a.listaGrafico[0].categorias,function(a,c){b.categoryAxis.categories.push(c.nombreCategoria)});var d=a;if($.each(d.listaGrafico[0].categorias,function(a,e){$.each(d.listaGrafico[0].series,function(d,f){c={},c.category=e.nombreCategoria,c.value=parseFloat(f.valores[a]),b.series[0].data.push(c)})}),$("#chart").kendoChart(b),"anual"==g)$("tbody td:not(.feed-headline, #tbody-datos-mes)").remove(),$("tfoot td:not(.feed-headline)").remove(),$.each(a.listaGrupo,function(a,b){$.each(b.gastoMensual,function(a,b){"ENERO"==b.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"FEBRERO"==b.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"MARZO"==b.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"ABRIL"==b.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"MAYO"==b.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"JUNIO"==b.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"JULIO"==b.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"AGOSTO"==b.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"SEPTIEMBRE"==b.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"OCTUBRE"==b.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"NOVIEMBRE"==b.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary")),"DICIEMBRE"==b.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-monetary"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(b.totalCategoria),th.attr("class","feed-monetary feed-category-"+(a+1)+"x")}),$.each(a.totalesAlMes,function(a,b){"ENERO"==b.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"FEBRERO"==b.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"MARZO"==b.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"ABRIL"==b.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"MAYO"==b.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"JUNIO"==b.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"JULIO"==b.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"AGOSTO"==b.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"SEPTIEMBRE"==b.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"OCTUBRE"==b.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"NOVIEMBRE"==b.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total")),"DICIEMBRE"==b.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(b.monto),td.attr("class","feed-total"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(a.totalGeneral),th.attr("class","feed-total");else{$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#dialog").css("display","none");var e=$("#tbody-datos-mes");e.empty();var f=$("#totales-mes");f.empty(),$.each(a.totalesPorDia,function(b,c){tr=$(document.createElement("tr")).appendTo(e),td=$(document.createElement("td")).appendTo(tr),td.html(c.fechaDia),td.attr("class","feed-headline"),$.each(a.listaGrupo,function(a,b){$.each(b.gastoDiario,function(a,b){c.fechaDia==b.fechaDia&&(td=$(document.createElement("td")).appendTo(tr),td.html(b.monto))})}),td=$(document.createElement("td")).appendTo(tr),td.html(c.monto),td.attr("class","feed-monetary")}),th=$(document.createElement("td")).appendTo(f),th.html("Totales"),th.attr("class","feed-total"),$.each(a.listaGrupo,function(a,b){th=$(document.createElement("td")).appendTo(f),th.attr("class","feed-monetary feed-category-"+(a+1)+"x"),th.html(b.totalCategoria)}),th=$(document.createElement("td")).appendTo(f),th.html(a.totalGeneral),th.attr("class","feed-total")}}})}function c(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#fechas").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"filter-range-from":{required:!0,dpDate:!0},"filter-range-to":{required:!0,dpDate:!0}},messages:{"filter-range-from":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) ","filter-range-to":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) "}})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$("#anio").hover(function(){$(".sub-stack").attr("style","display:block")},function(){$(".sub-stack").attr("style","display:none")}),a(),$.datepicker.regional.es={closeText:"Cerrar",prevText:"Previo",nextText:"Próximo",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],monthStatus:"Ver otro mes",yearStatus:"Ver otro año",dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],dateFormat:"dd/mm/yy",firstDay:0,initStatus:"Selecciona la fecha",isRTL:!1},$.datepicker.setDefaults($.datepicker.regional.es),$("#filter-range-from").datepicker({onSelect:function(a){$("#filter-range-to").datepicker("option","minDate",a)}}),$("#filter-range-to").datepicker({onSelect:function(a){$("#filter-range-from").datepicker("option","maxDate",a)}}),$(".dashboard-item").click(function(d){d.preventDefault();var e,f,g,h,i,k,l,m;e=$(this).find("img").attr("src"),f=$(this).attr("card"),g=$(this).attr("marca"),h=$(this).attr("mascara"),i=$(this).attr("producto1"),$(this).attr("empresa"),l=$(this).attr("nombre"),idexper=$(this).attr("idpersona"),m=$(this).attr("tipo"),id=$(this).attr("id"),prefix=$(this).attr("prefix"),$("#donor").children().remove();var n=$("#filter-range-from"),o=$("#filter-range-to");n.val(""),n.removeClass("field-success"),n.removeClass("field-error"),o.val(""),o.removeClass("field-success"),o.removeClass("field-error"),k='<div class="product-presentation">',k+='<img src="'+e+'" width="200" height="130" alt="" />',k+='<div class="product-network '+g+'"></div>',k+='<input id="donor-cardnumber" name="donor-cardnumber" prefix="'+prefix+'" tarjeta="'+f+'" idexper="'+idexper+'" tipo="'+m+'" type="hidden" value="'+f+'" />',k+="</div>",k+='<div class="productoct-info-full">',k+='<p class="product-cardholder">'+l+' <span class="product-cardholder-id">'+id+" "+idexper+"</span></p>",k+='<p class="product-cardnumber">'+h+"</p>",k+='<p class="product-metadata">'+i+"</p>",k+='<nav class="product-stack">',k+='<ul class="stack">',k+='<li class="stack-item dialog">',k+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit dialog"></span></a>',k+="</li>",k+="</ul>",k+="</nav>",k+="</div>",$("#donor").append(k),$("#content-product").dialog("close"),a(),$("#mens").removeClass("disabled-button"),i=$("#donor").find("#donor-cardnumber").attr("prefix");var p=new Date,q=p.getFullYear();fechaIni="01/01/"+q,fechaFin="31/12/"+q,tipoConsulta="0",b(f,tipoConsulta,i,idexper,fechaIni,fechaFin,"anual"),$("#filter-range-from").prop("disabled",!1),$("#filter-range-to").prop("disabled",!1),$(".nodata-state").show(),$(".content-anio").show(),$(".content-mes").hide(),$("#empty-state").hide(),$(".anual").click(function(){tipoConsulta="0",b(f,tipoConsulta,m,idexper,"anual"),$(".content-anio").show(),$(".content-mes").hide()}),c(),$("#mens").click(function(){$("#detalle").prop("checked",!0),$("#grafico").prop("disabled",!0),$("#dialog").show()}),$(".mensual").click(function(){$("#fechas").submit(),setTimeout(function(){$("#msg").fadeOut()},2e3);var a=$("#fechas");fechaIni=$("#filter-range-from").val(),fechaFin=$("#filter-range-to").val(),tipoConsulta="1",1==a.valid()&&(b(f,tipoConsulta,i,idexper,fechaIni,fechaFin,"mensual"),$(".content-mes").show(),$(".content-anio").hide())}),$("#export_pdf").click(function(a){a.preventDefault(),0==reporte?($("#report-detail").children().remove(),$("#chart").children().remove(),k='<div id="empty-state" style="position: static;">',k+="<h2>No se encontraron movimientos</h2>",k+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",k+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',k+="</div>",$("#report-detail").append(k),$("#chart").append(k)):($("#tarjeta_pdf").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona_pdf").val(idexper),$("#producto_pdf").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta_pdf").val(tipoConsulta),$("#fechaIni_pdf").val(fechaIni),$("#fechaFin_pdf").val(fechaFin),$("#form_pdf").submit())}),$("#export_excel").click(function(a){a.preventDefault(),0==reporte?($("#report-detail").children().remove(),$("#chart").children().remove(),k='<div id="empty-state" style="position: static;">',k+="<h2>No se encontraron movimientos</h2>",k+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",k+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',k+="</div>",$("#report-detail").append(k),$("#chart").append(k)):($("#tarjeta").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona").val(idexper),$("#producto").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta").val(tipoConsulta),$("#fechaIni").val(fechaIni),$("#fechaFin").val(fechaFin),$("#form").submit())})}),$("#grafico").click(function(){$("#chart").show(),$("#results").hide(),$("#empty-state").hide(),$("#chart").children("svg").css("width","910px")}),$("#detalle").click(function(){$("#chart").hide(),$("#results").show()}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(a,b){$(".ui-dialog-titlebar-close",b.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});