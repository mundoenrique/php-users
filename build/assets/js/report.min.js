var fecha=new Date;fecha=fecha.getFullYear();var anio,fechaIni,fechaFin,producto,tipoConsulta,reporte,skin,i=0;skin=$("body").attr("data-app-skin");do{anio=parseInt(fecha)-i,$(".sub-stack").append('<li class="sub-stack-item"><a href="#" rel="subsection" >'+anio.toString()+"</a></li>"),i+=1}while(3!=i);$(document).ready(function(){$(".nodata-state").hide(),$("#dialog").css("display","none"),$("#download-boxes").hide(),$("#filter-range-from").prop("disabled",!0),$("#filter-range-to").prop("disabled",!0),$("#detalle").prop("disabled",!0),$("#grafico").prop("disabled",!0)}),$(function(){function e(){$(".dialog").click(function(e){e.preventDefault(),$("#content-product").dialog({title:"Seleccion de Cuentas Origen",modal:"true",width:"940px",open:function(e,t){$(".ui-dialog-titlebar-close",t.dialog).hide()}}),$("#cerrar").click(function(){$("#content-product").dialog("close")});var t=$("#dashboard-donor");t.isotope({itemSelector:".dashboard-item",animationEngine:"jQuery",animationOptions:{duration:800,easing:"easeOutBack",queue:!0}});var a=$("#filters-stack .option-set"),o=a.find("a");o.click(function(e){e.preventDefault();var a=$(this);if(a.hasClass("selected"))return!1;var o=a.parents(".option-set");o.find(".selected").removeClass("selected"),a.addClass("selected");var r={},n=o.attr("data-option-key"),d=a.attr("data-option-value");return d="false"!==d&&d,r[n]=d,"layoutMode"===n&&"function"==typeof changeLayoutMode?changeLayoutMode(a,r):t.isotope(r),!1})}),$("li.stack-item a").click(function(){$(".stack").find(".current-stack-item").removeClass("current-stack-item"),$(this).parents("li").addClass("current-stack-item")})}function t(e,t,a,o,r,n,d){"pichincha"==skin&&($("[id='empty-state']").hide(),$("#dialog").css({"margin-top":"0px"})),$("#dialog").show();var i=$("#reporte").attr("moneda"),s=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1")),l=JSON.stringify({tarjeta:e,idpersona:o,tipo:t,producto:a,fechaIni:r,fechaFin:n});l=CryptoJS.AES.encrypt(l,s,{format:CryptoJSAesJson}).toString(),$.post(base_url+"/report/CallWsGastos",{request:l,cpo_name:s,plot:btoa(s)},function(e){data=JSON.parse(CryptoJS.AES.decrypt(e.code,e.plot,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8));var t="<h2>No se encontraron movimientos</h2>";if(t+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",-61==data.rc&&($(location).attr("href",base_url+"/users/error_gral"),$("#dialog").css("display","none")),0!=data.rc)-9999==data.rc&&($("#empty-state.nodata-state > h2").text("Atención"),$("#empty-state.nodata-state > p").text("Combinación de caracteres no válida.")),-150==data.rc?($("#report-detail").children().remove(),$("#chart").children().remove(),$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#tabla_detalle").attr("style","display:none"),$("#dialog").css("display","none"),$("#empty-state").hide(),$('[data-result="noresult"]').show()):($("#report-detail").children().remove(),$("#chart").children().remove(),$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#tabla_detalle").attr("style","display:none"),cadena='<div id="empty-state" style="position: static;">',cadena+=t,cadena+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',cadena+="</div>",$("#report-detail").append(cadena),$("#chart").append(cadena),$("#totales-mes td:not(.feed-headline)").append(cadena),$("#tbody-datos-mes").append(cadena),$("#dialog").css("display","none"),reporte=!1);else{$("#download-boxes").show(),$(".nodata-state").hide(),$("#dialog").css("display","none"),$("#chart").hide(),$("#results").show(),$("#empty-state").hide(),$("#grafico").prop("disabled",!1),$("#detalle").prop("disabled",!1),$("#tabla_detalle").removeAttr("style"),reporte=!0;var a={seriesDefaults:{labels:{template:"#= category #  #= kendo.format('{0:P}')#",position:"outsideEnd",visible:!1,background:"transparent",format:i+" {0}"}},seriesColors:["#1abc9c","#2ecc71","#3498db","#9b59b6","#f1c40f","#e67e22","#e74c3c","#16a085","#27ae60","#2980b9"],series:[{type:"pie",overlay:{gradient:"none"},data:[]}],legend:{visible:!0},categoryAxis:{categories:[]},tooltip:{visible:!0,template:"${category} - "+i+" ${value}"}},o={};$.each(data.listaGrafico[0].categorias,function(e,t){a.categoryAxis.categories.push(t.nombreCategoria)});var r=data;if($.each(r.listaGrafico[0].categorias,function(e,t){$.each(r.listaGrafico[0].series,function(r,n){o={},o.category=t.nombreCategoria,o.value=parseFloat(n.valores[e]),a.series[0].data.push(o)})}),$("#chart").kendoChart(a),"anual"==d)$("tbody td:not(.feed-headline, #tbody-datos-mes)").remove(),$("tfoot td:not(.feed-headline)").remove(),$.each(data.listaGrupo,function(e,t){$.each(t.gastoMensual,function(e,t){"ENERO"==t.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"FEBRERO"==t.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"MARZO"==t.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"ABRIL"==t.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"MAYO"==t.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"JUNIO"==t.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"JULIO"==t.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"AGOSTO"==t.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"SEPTIEMBRE"==t.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"OCTUBRE"==t.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"NOVIEMBRE"==t.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")),"DICIEMBRE"==t.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(t.totalCategoria),th.attr("class","feed-monetary feed-category-"+(e+1)+"x")}),$.each(data.totalesAlMes,function(e,t){"ENERO"==t.mes&&(tr=$("#enero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"FEBRERO"==t.mes&&(tr=$("#febrero"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"MARZO"==t.mes&&(tr=$("#marzo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"ABRIL"==t.mes&&(tr=$("#abril"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"MAYO"==t.mes&&(tr=$("#mayo"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"JUNIO"==t.mes&&(tr=$("#junio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"JULIO"==t.mes&&(tr=$("#julio"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"AGOSTO"==t.mes&&(tr=$("#agosto"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"SEPTIEMBRE"==t.mes&&(tr=$("#septiembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"OCTUBRE"==t.mes&&(tr=$("#octubre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"NOVIEMBRE"==t.mes&&(tr=$("#noviembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total")),"DICIEMBRE"==t.mes&&(tr=$("#diciembre"),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-total"))}),tr=$("#totales"),th=$(document.createElement("td")).appendTo(tr),th.html(data.totalGeneral),th.attr("class","feed-total");else{$("#tbody-datos-mes").children().remove(),$("#totales-mes td:not(.feed-headline)").remove(),$("#dialog").css("display","none");var n=$("#tbody-datos-mes");n.empty();var s=$("#totales-mes");s.empty(),$.each(data.totalesPorDia,function(e,t){tr=$(document.createElement("tr")).appendTo(n),td=$(document.createElement("td")).appendTo(tr),td.html(t.fechaDia),td.attr("class","feed-headline"),$.each(data.listaGrupo,function(e,a){$.each(a.gastoDiario,function(e,a){t.fechaDia==a.fechaDia&&(td=$(document.createElement("td")).appendTo(tr),td.html(a.monto))})}),td=$(document.createElement("td")).appendTo(tr),td.html(t.monto),td.attr("class","feed-monetary")}),th=$(document.createElement("td")).appendTo(s),th.html("Totales"),th.attr("class","feed-total"),$.each(data.listaGrupo,function(e,t){th=$(document.createElement("td")).appendTo(s),th.attr("class","feed-monetary feed-category-"+(e+1)+"x"),th.html(t.totalCategoria)}),th=$(document.createElement("td")).appendTo(s),th.html(data.totalGeneral),th.attr("class","feed-total")}}})}function a(){jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#fechas").validate({errorElement:"label",ignore:"",errorContainer:"#msg",errorClass:"field-error",validClass:"field-success",errorLabelContainer:"#msg",rules:{"filter-range-from":{required:!0,dpDate:!0},"filter-range-to":{required:!0,dpDate:!0}},messages:{"filter-range-from":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) ","filter-range-to":"El campo Fecha no posee el formato correcto (dd/mm/aaaa) "}})}$(".transfers").hover(function(){$(".submenu-transfer").attr("style","display:block")},function(){$(".submenu-transfer").attr("style","display:none")}),$(".user").hover(function(){$(".submenu-user").attr("style","display:block")},function(){$(".submenu-user").attr("style","display:none")}),$("#anio").hover(function(){$(".sub-stack").attr("style","display:block")},function(){$(".sub-stack").attr("style","display:none")}),e(),$.datepicker.regional.es={closeText:"Cerrar",prevText:"Previo",nextText:"Próximo",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],monthStatus:"Ver otro mes",yearStatus:"Ver otro año",dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],dateFormat:"dd/mm/yy",firstDay:0,initStatus:"Selecciona la fecha",isRTL:!1},$.datepicker.setDefaults($.datepicker.regional.es),$("#filter-range-from").datepicker({onSelect:function(e){$("#filter-range-to").datepicker("option","minDate",e)}}),$("#filter-range-to").datepicker({onSelect:function(e){$("#filter-range-from").datepicker("option","maxDate",e)}}),$(".dashboard-item").click(function(o){var r,n,d,i,s,l,c,p;o.preventDefault(),r=$(this).find("img").attr("src"),n=$(this).attr("card"),d=$(this).attr("marca"),i=$(this).attr("mascara"),s=$(this).attr("producto1"),$(this).attr("empresa"),c=$(this).attr("nombre"),idexper=$(this).attr("idpersona"),p=$(this).attr("tipo"),id=$(this).attr("id"),prefix=$(this).attr("prefix"),$("#donor").children().remove();var m=$("#filter-range-from"),u=$("#filter-range-to");m.val(""),m.removeClass("field-success"),m.removeClass("field-error"),u.val(""),u.removeClass("field-success"),u.removeClass("field-error"),l='<div class="product-presentation">',l+='<img src="'+r+'" width="200" height="130" alt="" />',l+='<div class="product-network '+d+'"></div>',l+='<input id="donor-cardnumber" name="donor-cardnumber" prefix="'+prefix+'" tarjeta="'+n+'" idexper="'+idexper+'" tipo="'+p+'" type="hidden" value="'+n+'" />',l+="</div>",l+='<div class="productoct-info-full">',l+='<p class="product-cardholder">'+c+' <span class="product-cardholder-id">'+id+" "+idexper+"</span></p>",l+='<p class="product-cardnumber">'+i+"</p>",l+='<p class="product-metadata">'+s+"</p>",l+='<nav class="product-stack">',l+='<ul class="stack">',l+='<li class="stack-item dialog">',l+='<a rel="section" title="Seleccionar otra cuenta"><span aria-hidden="true" class="icon-edit dialog"></span></a>',l+="</li>",l+="</ul>",l+="</nav>",l+="</div>",$("#donor").append(l),$("#content-product").dialog("close"),e(),$("#mens").removeClass("disabled-button"),s=$("#donor").find("#donor-cardnumber").attr("prefix");var f=new Date,h=f.getFullYear();fechaIni="01/01/"+h,fechaFin="31/12/"+h,tipoConsulta="0",t(n,tipoConsulta,s,idexper,fechaIni,fechaFin,"anual"),$("#filter-range-from").prop("disabled",!1),$("#filter-range-to").prop("disabled",!1),"pichincha"!=skin&&$(".nodata-state").show(),$(".content-anio").show(),$(".content-mes").hide(),"pichincha"!=skin&&$("#empty-state").hide(),$(".anual").click(function(){tipoConsulta="0",t(n,tipoConsulta,p,idexper,"anual"),$(".content-anio").show(),$(".content-mes").hide()}),a(),$("#mens").click(function(){$("#detalle").prop("checked",!0),$("#grafico").prop("disabled",!0),$("#dialog").show()}),$(".mensual").click(function(){var e=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$("#fechas").append('<input type="hidden" name="cpo_name" class="ignore" value="'+e+'">'),$("#fechas").submit(),setTimeout(function(){$("#msg").fadeOut()},2e3);var a=$("#fechas");fechaIni=$("#filter-range-from").val(),fechaFin=$("#filter-range-to").val(),tipoConsulta="1",1==a.valid()&&(t(n,tipoConsulta,s,idexper,fechaIni,fechaFin,"mensual"),$(".content-mes").show(),$(".content-anio").hide())}),$("#export_pdf").click(function(e){if(e.preventDefault(),0==reporte)$("#report-detail").children().remove(),$("#chart").children().remove(),l='<div id="empty-state" style="position: static;">',l+="<h2>No se encontraron movimientos</h2>",l+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",l+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',l+="</div>",$("#report-detail").append(l),$("#chart").append(l);else{$("#tarjeta_pdf").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona_pdf").val(idexper),$("#producto_pdf").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta_pdf").val(tipoConsulta),$("#fechaIni_pdf").val(fechaIni),$("#fechaFin_pdf").val(fechaFin),$("#idOperation").val("5");var t=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$("#form_pdf").append('<input type="hidden" name="cpo_name" value="'+t+'">'),$("#form_pdf").submit()}}),$("#export_excel").click(function(e){if(e.preventDefault(),0==reporte)$("#report-detail").children().remove(),$("#chart").children().remove(),l='<div id="empty-state" style="position: static;">',l+="<h2>No se encontraron movimientos</h2>",l+="<p>Vuelva a realizar la busqueda con un filtro distinto para obtener resultados.</p>",l+='<span aria-hidden="true" class="icon-cancel-sign" style="position: relative;right: -410px;"></span>',l+="</div>",$("#report-detail").append(l),$("#chart").append(l);else{$("#tarjeta").val($("#donor-cardnumber").attr("tarjeta")),$("#idpersona").val(idexper),$("#producto").val($("#donor-cardnumber").attr("prefix")),$("#tipoConsulta").val(tipoConsulta),$("#fechaIni").val(fechaIni),$("#fechaFin").val(fechaFin),$("#idOperation").val("5");var t=decodeURIComponent(document.cookie.replace(/(?:(?:^|.*;\s*)cpo_cook\s*\=\s*([^;]*).*$)|^.*$/,"$1"));$("#form").append('<input type="hidden" name="cpo_name" value="'+t+'">'),$("#form").submit()}})}),$("#grafico").click(function(){$("#chart").show(),$("#results").hide(),$("#empty-state").hide(),$("#chart").children("svg").css("width","910px")}),$("#detalle").click(function(){$("#chart").hide(),$("#results").show()}),$(".label-inline").on("click","a",function(){$("#dialog-tc").dialog({modal:"true",width:"940px",open:function(e,t){$(".ui-dialog-titlebar-close",t.dialog).hide()}}),$("#ok").click(function(){$("#dialog-tc").dialog("close")})})});